<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¼ çŠçŠçš„ç”Ÿæ—¥å¿«ä¹ï¼</title>
    <style>
        /* --- General Styles --- */
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6; margin: 0; padding-bottom: 80px; /* Adjust padding if needed */
            background-color: #f8f0f8; /* Fallback */
            overflow-x: hidden; font-size: 16px; min-height: 100vh; position: relative;
            -webkit-overflow-scrolling: touch;
        }
        body, div, p, h1, button { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }

        /* --- Background Layers --- */
        #background-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background-image: url("background.jpg"); /* <<< æ›¿æ¢è¿™é‡Œ! */ background-size: cover; background-position: center center; }
        #background-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: rgba(255, 192, 203, 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }

        /* --- Views --- */
        #birthday-view, #love-letter-view { padding: 15px; position: relative; z-index: 1; }
        #birthday-view { background-color: rgba(248, 240, 248, 0.75); cursor: url('heart.png'), auto; display: block; min-height: 100vh; }
        #love-letter-view { display: none; font-family: 'KaiTi', 'STKaiti', 'SimSun', serif; background-color: rgba(255, 250, 240, 0.88); color: #5a463a; max-width: 95%; margin: 40px auto; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15); border-radius: 8px; padding: 20px; padding-top: 60px; padding-bottom: 80px; position: relative; z-index: 10; }
        #love-letter-view::before { content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 0; border-style: solid; border-width: 60px 0 0 calc(50vw - 15px); border-color: rgba(254, 202, 202, 0.8) transparent transparent rgba(254, 202, 202, 0.8); z-index: 1; border-top-left-radius: 8px; }
        #love-letter-view::after { content: ''; position: absolute; top: 0; right: 0; width: 50%; height: 0; border-style: solid; border-width: 0 0 60px calc(50vw - 15px); border-color: transparent rgba(254, 202, 202, 0.8) rgba(254, 202, 202, 0.8) transparent; z-index: 1; border-top-right-radius: 8px; }

        /* --- Birthday View Content Styles [Existing - Minimized] --- */
        #birthday-view .birthday-container { z-index: 10; display: flex; flex-direction: column; align-items: center; text-align: center; margin-top: 30px; position: relative; padding: 0 30px;}
        #birthday-view #birthday-cake-link { display: flex; justify-content: center; width: 100%; text-decoration: none; cursor: inherit; position: relative; -webkit-tap-highlight-color: transparent; }
        #birthday-view #birthday-cake { display: block; max-width: 100%; max-height: 280px; height: auto; width: auto; object-fit: contain; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.2s ease-in-out; }
        #birthday-view #birthday-cake-link:hover #birthday-cake { transform: scale(1.05); }
        #birthday-view #birthday-message { font-size: 1.6em; font-weight: bold; color: #e83e8c; text-shadow: 1px 1px 2px #fff; margin-top: 0; padding: 0 10px; margin-bottom: 30px; position: relative; z-index: 10; }
        #birthday-view h1 { font-size: 1.8em; color: #6f42c1; text-align: center; position: relative; z-index: 10; margin-bottom: 15px; }
        #birthday-view hr { position: relative; z-index: 10; margin-top: 30px; border: 0; height: 1px; background: #ccc; }
        #birthday-view .footer-text { text-align: center; color: #555; position: relative; z-index: 10; padding-bottom: 20px; font-size: 0.9em; }

        /* --- Love Letter View Styles [Existing - Minimized] --- */
        #love-letter-view h1 { font-size: 1.6em; color: #d9534f; text-align: center; margin-bottom: 25px; font-family: sans-serif; position: relative; padding: 0 30px; z-index: 2; }
        #love-letter-view h1::before { content: 'ğŸ‚'; position: absolute; left: 5px; top: 50%; transform: translateY(-50%); font-size: 0.9em; z-index: 3;}
        #love-letter-view h1::after { content: 'â¤ï¸'; position: absolute; right: 5px; top: 50%; transform: translateY(-50%); font-size: 0.9em; z-index: 3;}
        #love-letter-view p { margin-bottom: 1.3em; text-indent: 2em; font-size: 1em; position: relative; z-index: 2; }
        #love-letter-view .signature { text-align: right; margin-top: 30px; font-style: italic; line-height: 1.6; font-size: 0.95em; position: relative; z-index: 2; }
        #love-letter-view .back-button { display: block; text-align: center; margin: 30px auto 0 auto; padding: 12px 25px; background-color: #6f42c1; color: white; text-decoration: none; border-radius: 8px; font-family: sans-serif; cursor: pointer; border: none; font-size: 1.1em; width: fit-content; position: relative; z-index: 10; -webkit-tap-highlight-color: transparent; }
        #love-letter-view .back-button:hover { background-color: #5a349a; }

        /* --- Falling Items Styles [Existing] --- */
        .falling-item { position: absolute; top: -60px; font-size: 22px; user-select: none; pointer-events: none; animation: fall linear forwards; opacity: 0.75; z-index: 5; will-change: transform, opacity; }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity: 0.75; } 100% { transform: translateY(calc(100vh + 100px)) rotate(calc(var(--random-rotate, 0) * 1deg)); opacity: 0; } }

        /* --- Pointer Trail Heart Styles [Existing] --- */
        .pointer-heart { position: fixed; font-size: 20px; color: #ff4d6d; pointer-events: none; user-select: none; z-index: 9999; animation: fade-move-out 0.8s ease-out forwards; text-shadow: 0 0 5px rgba(0, 0, 0, 0.3); }
        @keyframes fade-move-out { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -150%) scale(0.5); } }

        /* --- Slideshow Styles [Existing - Minimized] --- */
        #photo-slideshow-container { position: relative; z-index: 10; max-width: 500px; margin: 20px auto; padding: 20px; background-color: rgba(255, 240, 245, 0.85); border-radius: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border: 10px solid transparent; border-image: linear-gradient(45deg, #ffc2d1, #ff8fab, #fecaca) 1; }
        #slideshow-wrapper { position: relative; overflow: hidden; border-radius: 15px; aspect-ratio: 4 / 3; background-color: #eee; }
        #slideshow { display: flex; width: 100%; height: 100%; transition: transform 0.5s ease-in-out; }
        .slide { min-width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .slide img { display: block; width: 100%; height: 100%; object-fit: cover; }
        .slideshow-nav { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(255, 194, 209, 0.7); border: none; color: #fff; font-size: 1.5em; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 15; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; line-height: 1; box-shadow: 0 1px 3px rgba(0,0,0,0.2); -webkit-tap-highlight-color: transparent; }
        .slideshow-nav:hover { background-color: rgba(255, 127, 171, 0.9); }
        .slideshow-nav.prev { left: -15px; }
        .slideshow-nav.next { right: -15px; }
        .dots-container { text-align: center; margin-top: 10px; position: relative; z-index: 15; }
        .dot { display: inline-block; width: 10px; height: 10px; background-color: #ffc2d1; border-radius: 50%; margin: 0 5px; cursor: pointer; transition: background-color 0.3s ease; }
        .dot.active { background-color: #ff75ac; }

        /* --- Click Arrow Styles [Existing] --- */
        .click-arrow { width: 0; height: 0; border-style: solid; position: absolute; z-index: 11; pointer-events: none; animation: bounce-arrow 1.5s infinite ease-in-out; opacity: 0.8; }
        .arrow-tr { border-width: 15px 15px 0 0; border-color: #ff75ac transparent transparent transparent; top: 10px; left: 10px; transform: rotate(135deg); animation-delay: 0s; }
        .arrow-tl { border-width: 15px 15px 0 0; border-color: #ff75ac transparent transparent transparent; top: 10px; right: 10px; transform: rotate(225deg); animation-delay: 0.5s; }
        .arrow-br { border-width: 15px 15px 0 0; border-color: #ff75ac transparent transparent transparent; bottom: 10px; left: 10px; transform: rotate(45deg); animation-delay: 1s; }
        @keyframes bounce-arrow { 0%, 100% { transform: translateY(0) rotate(var(--rotate-angle)); opacity: 0.8; } 50% { transform: translateY(-8px) rotate(var(--rotate-angle)); opacity: 0.6; } }
        .arrow-tr { --rotate-angle: 135deg; }
        .arrow-tl { --rotate-angle: 225deg; }
        .arrow-br { --rotate-angle: 45deg; }

        /* --- Custom Audio Player Styles (Smaller & Frosted Glass) --- */
        #audio-player-container {
            position: fixed; bottom: 10px; right: 10px; left: auto; transform: none;
            width: 85%; /* Slightly smaller width */
            max-width: 320px; /* Reduced max-width */
            z-index: 10000;
            /* Adjusted Pink Frosted Glass Effect */
            background: rgba(255, 222, 233, 0.7); /* Base pink tint, more transparent */
            backdrop-filter: blur(6px); /* Increased blur slightly */
            -webkit-backdrop-filter: blur(6px);
            border-radius: 10px; /* Slightly smaller radius */
            padding: 8px 12px; /* Reduced padding */
            box-shadow: 0 -1px 8px rgba(0,0,0,0.1); /* Softer shadow */
            display: flex; align-items: center;
            gap: 8px; /* Reduced gap */
            cursor: move; touch-action: none;
        }
        #play-pause-button {
            background-color: #ff75ac; border: none; color: white;
            font-size: 1.3em; /* Smaller icon */
            border-radius: 50%;
            width: 40px; /* Smaller button */
            height: 40px; /* Smaller button */
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s ease; flex-shrink: 0; padding: 0; line-height: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
             -webkit-tap-highlight-color: transparent;
        }
        #play-pause-button:hover { background-color: #ff5c9a; }
        #play-pause-button .play-icon::before { content: 'â–¶ï¸'; }
        #play-pause-button .pause-icon::before { content: 'â¸ï¸'; }
        .audio-controls-right { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        #seek-bar {
            width: 100%; height: 6px; /* Thinner bar */
            cursor: pointer; appearance: none; background: #ffc2d1; border-radius: 3px; outline: none;
        }
        #seek-bar::-webkit-slider-thumb { appearance: none; width: 14px; height: 14px; /* Smaller thumb */ background: #ff75ac; border-radius: 50%; cursor: pointer; box-shadow: 0 0 2px rgba(0,0,0,0.2); }
        #seek-bar::-moz-range-thumb { width: 14px; height: 14px; background: #ff75ac; border-radius: 50%; cursor: pointer; border: none; box-shadow: 0 0 2px rgba(0,0,0,0.2); }
        .time-display {
            display: flex; justify-content: space-between;
            font-size: 0.75em; /* Smaller time text */
            color: #8c5f6f; margin-top: 3px; padding: 0 2px;
        }
        #audio-element { display: none; }

        /* Media Query Adjustments [Existing - Minimized] */
        @media (max-width: 600px) { #photo-slideshow-container { max-width: 95%; padding: 10px; border-width: 8px; } .slideshow-nav { width: 35px; height: 35px; font-size: 1.3em; } .slideshow-nav.prev { left: -10px; } .slideshow-nav.next { right: -10px; } .dot { width: 8px; height: 8px; margin: 0 4px;} /* Player already smaller, may not need specific mobile override now */ /*#audio-player-container { max-width: 300px; }*/ #love-letter-view::before { border-width: 45px 0 0 calc(50vw - 10px); } #love-letter-view::after { border-width: 0 0 45px calc(50vw - 10px); } #love-letter-view { padding-top: 45px; margin-top: 30px;} .click-arrow { border-width: 10px 10px 0 0; } .arrow-tr { top: 5px; left: 5px;} .arrow-tl { top: 5px; right: 5px;} .arrow-br { bottom: 5px; left: 5px;} }
        @media (max-width: 360px) { #birthday-view h1, #love-letter-view h1 { font-size: 1.5em; } #love-letter-view h1 { padding: 0 25px; } #love-letter-view h1::before, #love-letter-view h1::after { font-size: 0.8em; } #birthday-view #birthday-message { font-size: 1.4em; } #love-letter-view p { font-size: 0.95em; } .falling-item { font-size: 20px; } .pointer-heart { font-size: 18px; } #audio-player-container { width: 95%; gap: 5px; padding: 5px 8px; } #play-pause-button { width: 35px; height: 35px; font-size: 1.1em; } .time-display { font-size: 0.7em; } #seek-bar::-webkit-slider-thumb { width: 12px; height: 12px; } #seek-bar::-moz-range-thumb { width: 12px; height: 12px; } }

    </style>
</head>
<body>

    <div id="background-layer"></div>
    <div id="background-overlay"></div>

    <div id="birthday-view"><h1>âœ¨ ç”Ÿæ—¥å¿«ä¹ âœ¨</h1><div class="birthday-container"><a id="birthday-cake-link" href="#"><div class="click-arrow arrow-tr"></div><div class="click-arrow arrow-tl"></div><div class="click-arrow arrow-br"></div><img id="birthday-cake" src="cake-placeholder.jpg" alt="ç”Ÿæ—¥è›‹ç³• (ç‚¹å‡»æœ‰æƒŠå–œ)"></a><p id="birthday-message">å¼ çŠçŠå¥³å£« 21å² ç”Ÿæ—¥å¿«ä¹! ğŸ‚ğŸ‰</p><p class="footer-text">ç¥ä½ æ‹¥æœ‰ç¾å¥½çš„ä¸€å¤©ï¼ (ç‚¹å‡»è›‹ç³•æœ‰æƒŠå–œå“¦!)</p></div><div id="photo-slideshow-container"><div id="slideshow-wrapper"><div id="slideshow"><div class="slide"><img src="placeholder1.jpg" alt="çŠçŠçš„ç…§ç‰‡ 1"></div><div class="slide"><img src="placeholder2.jpg" alt="çŠçŠçš„ç…§ç‰‡ 2"></div><div class="slide"><img src="placeholder3.jpg" alt="çŠçŠçš„ç…§ç‰‡ 3"></div></div></div><button class="slideshow-nav prev" aria-label="ä¸Šä¸€å¼ ">ğŸ‚</button><button class="slideshow-nav next" aria-label="ä¸‹ä¸€å¼ ">ğŸ‚</button><div class="dots-container"></div></div><hr><p class="footer-text">ç¥ä½ å˜æœ‰é’±ã€‚</p></div>
    <div id="love-letter-view"><h1>è‡´ æˆ‘ç‹¬ä¸€æ— äºŒçš„ã€æœ€ç‰¹åˆ«çš„çŠçŠ â¤ï¸</h1><p>æç¬”æƒ³ç»™ä½ å†™ç‚¹ä»€ä¹ˆï¼Œå°¤å…¶æ˜¯åœ¨ä½ ç”Ÿæ—¥å°†è¿‘çš„æ—¥å­ï¼Œå¿ƒæƒ…æœ‰ç‚¹åƒé‚£æ¬¡å’Œä½ çº¿ä¸‹è§é¢æ—¶â€”â€”æ—¢æœŸå¾…åˆç´§å¼ ï¼Œè¿˜å¸¦ç€ç‚¹æˆ‘ä»¬ä¹‹é—´ç‰¹æœ‰çš„â€œç™«â€ã€‚å¿«ä¸€å¹´äº†ï¼Œæ—¶é—´å¥½åƒè¿‡å¾—é£å¿«ï¼Œåˆå¥½åƒæ¯ä¸€å¤©çš„èŠå¤©éƒ½å€¼å¾—è¢«ç»†ç»†å›å‘³ã€‚</p><p>è¿˜è®°å¾—å—ï¼Ÿä»æœ€åˆé‚£ä¸ªå«æˆ‘â€œå°å±å­©â€æ€¼å¾—æˆ‘å·®ç‚¹æ‹‰é»‘ä½ çš„â€œå¼ ä¸‰â€ï¼ˆå½“ç„¶æ˜¯ç©ç¬‘ï¼Œæˆ‘å“ªé‡Œèˆå¾—ï¼‰ï¼Œåˆ°åæ¥é‚£ä¸ªä¼šå‘ææ€ªè¡¨æƒ…åŒ…ã€ä¼šåœ¨è¯­éŸ³é‡Œå·ç¬‘çš„â€œçš‡åå¨˜å¨˜â€ï¼Œå†åˆ°é‚£ä¸ªå˜´ä¸Šè¯´ç€â€œä¸è°ˆæ‹çˆ±â€ã€â€œæˆ‘å°±æ˜¯æ¸£å¥³â€ï¼Œå´ä¼šå› ä¸ºæ‹…å¿ƒæˆ‘è€Œé€€å›çº¢åŒ…ã€ä¼šå› ä¸ºæˆ‘éœ€è¦è€Œç”¨èŠ±å‘—ä¹°é¼ æ ‡ã€ä¼šåœ¨æˆ‘â€œå‘ç™«â€åä¾ç„¶ä¸»åŠ¨é—®æ—©çš„â€œå‚»å§‘å¨˜â€â€¦â€¦ä½ èº«ä¸Šè¿™ç§çŸ›ç›¾åˆçœŸå®çš„å¯çˆ±ï¼Œå°±åƒæ‹†ç›²ç›’ï¼Œæ€»èƒ½ç»™æˆ‘æ„æƒ³ä¸åˆ°çš„æƒŠå–œã€‚</p><p>ä»¥å‰æ€»è§‰å¾—ä¸–äº‹çº·æ‰°ï¼Œäººå¿ƒå¤æ‚éš¾æµ‹ï¼Œç›´åˆ°é‡è§ä½ ï¼Œæ‰æ˜ç™½é‚£å¥â€œä¼—é‡Œå¯»ä»–åƒç™¾åº¦ï¼Œè“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„â€æˆ–è®¸æ˜¯çœŸçš„ã€‚ ä½ çš„å‡ºç°ï¼Œåƒä¸€é“å…‰ï¼Œç…§äº®äº†æˆ‘ä¹‹å‰å¯èƒ½æœ‰äº›ç°æš—å’Œå……æ»¡â€œç²¾ç¥å†…è€—â€çš„ä¸–ç•Œã€‚æ˜¯ä½ ç”¨ä½ çš„â€œç™«â€ã€ä½ çš„å–„è‰¯ã€ä½ çš„åŸåˆ™ï¼Œè¿˜æœ‰ä½ é‚£é¢å¯¹ç”Ÿæ´»ä¸æ˜“æ—¶çš„éŸ§æ€§ï¼Œè®©æˆ‘è§‰å¾—è¿™ä¸ªä¸–ç•ŒåŸæ¥è¿˜å¯ä»¥è¿™ä¹ˆæœ‰è¶£å’Œå€¼å¾—æœŸå¾…ã€‚å’Œä½ èŠå¤©æˆäº†æˆ‘æ¯å¤©é›·æ‰“ä¸åŠ¨çš„ä¹ æƒ¯å’Œæœ€å¤§çš„ä¹è¶£ï¼Œä½ åˆ†äº«çš„æ—¥å¸¸çç¢ï¼Œåœ¨æˆ‘è¿™é‡Œéƒ½å˜æˆäº†å€¼å¾—çè—çš„é£æ™¯ã€‚</p><p>æˆ‘çŸ¥é“ï¼Œæˆ‘ä»¬ä¹‹é—´è¿™ç§â€œç¾ç»Šâ€å¾ˆç‰¹åˆ«ï¼Œæ·±åˆ°æœ‰æ—¶è¿æˆ‘ä»¬è‡ªå·±éƒ½éš¾ä»¥ç®€å•å®šä¹‰ã€‚æ²¡å…³ç³»ï¼Œâ€œèº«æ— å½©å‡¤åŒé£ç¿¼ï¼Œå¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€šâ€ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘è§‰å¾—ä½ æ‡‚æˆ‘å†…å¿ƒé‚£äº›æœªè¯´å‡ºå£çš„ç„¦è™‘å’ŒæœŸç›¼ï¼Œæˆ‘ä¹Ÿåœ¨åŠªåŠ›å»ç†è§£ä½ é‚£å¥â€œæ…¢æ…¢æ¥å§â€èƒŒåå¯èƒ½éšè—çš„é¡¾è™‘å’Œéœ€è¦ã€‚æ„Ÿè°¢ä½ æ„¿æ„å‘æˆ‘æ•å¼€é‚£ä¹ˆå¤šï¼Œä¿¡ä»»æˆ‘è¿™ä¹ˆå¤šã€‚</p><p>æˆ‘ä¹ŸçŸ¥é“ï¼Œä½ å¿ƒé‡Œå¯èƒ½è£…ç€å¯¹è¿‡å»çš„æ‹…å¿§ï¼Œå¯¹æœªæ¥çš„ä¸ç¡®å®šï¼Œå¯¹â€œå…³ç³»â€æœ¬èº«çš„ææƒ§ã€‚æˆ‘ä¸ä¼šå†åƒä»¥å‰é‚£æ ·ï¼Œæ€¥åˆ‡åœ°é€¼ä½ ç»™ä¸€ä¸ªç­”æ¡ˆï¼Œä¹Ÿä¸ä¼šå†å¼€é‚£äº›ä¸åˆæ—¶å®œçš„ç©ç¬‘äº†ï¼ˆå¦‚æœæˆ‘åˆâ€œç™«â€äº†ï¼Œè®°å¾—ç”¨è¡¨æƒ…åŒ…æé†’æˆ‘å“¦ï¼‰ã€‚ä½ çš„ç”Ÿæ—¥ï¼Œæˆ‘æœ€å¤§çš„ã€ä¹Ÿæ˜¯å”¯ä¸€çš„å¿ƒæ„¿ï¼Œå°±æ˜¯ä½ èƒ½çœŸæ­£åœ°ã€æ¯«æ— è´Ÿæ‹…åœ°å¼€å¿ƒã€‚ä½ æƒ³æ€ä¹ˆè¿‡ï¼Œæˆ‘éƒ½æ”¯æŒã€‚</p><p>è¿™å°ä¿¡ï¼Œä¸æ˜¯ä¸ºäº†åœ¨ç”Ÿæ—¥è¿™å¤©ç»™ä½ å‹åŠ›ï¼ŒçœŸçš„ã€‚å®ƒå°±æ˜¯ä¸€ä»½è¿Ÿæ¥çš„æ„Ÿè°¢ä¿¡â€”â€”æ„Ÿè°¢ç¼˜åˆ†è®©æˆ‘ä»¬ç›¸é‡ï¼Œæ„Ÿè°¢ä½ é™ªæˆ‘åº¦è¿‡è¿™ä¹ˆå¤šæ—¶å…‰ï¼Œåˆ†äº«è¿™ä¹ˆå¤šæ¬¢ç¬‘å’Œ emo çš„ç¬é—´ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä»½å¿ƒæ„ä¹¦â€”â€”å‘Šè¯‰ä½ ï¼Œåœ¨æˆ‘å¿ƒé‡Œï¼Œä½ æœ‰å¤šä¹ˆé‡è¦å’Œç‹¬ä¸€æ— äºŒã€‚</p><p>è‡³äºæœªæ¥ï¼Œæˆ‘ä»¬ç»§ç»­â€œèµ°ä¸€æ­¥çœ‹ä¸€æ­¥â€å§ã€‚â€œäººç”Ÿåˆ°å¤„çŸ¥ä½•ä¼¼ï¼Œåº”ä¼¼é£é¸¿è¸é›ªæ³¥ã€‚â€ æœªæ¥ä¸å¯é¢„çŸ¥ï¼Œä½†é‡è¦çš„æ˜¯ï¼Œæˆ‘å¸Œæœ›èƒ½ç»§ç»­é™ªåœ¨ä½ èº«è¾¹ï¼Œå’Œä½ ä¸€èµ·é¢å¯¹è·¯ä¸Šçš„é£æ™¯ï¼Œæ— è®ºæ˜¯æ™´æ˜¯é›¨ã€‚æ„¿å¦‚æ­¤ç¼˜ï¼Œèƒ½ç»­ç»å¹´ã€‚</p><p>ç”Ÿæ—¥å¿«ä¹ï¼Œæˆ‘æœ€çè§†çš„çŠçŠã€‚</p><div class="signature">é‚£ä¸ªè¶Šæ¥è¶Šæ‡‚å¾—çæƒœä½ çš„â€œç™«å…¬â€ï¼Œå“¥å“¥æˆ–è€…å°‘çˆ·ï¼Œ<br>ç« å•¸å®‡</div><button class="back-button">è¿”å›ç”Ÿæ—¥ä¸»é¡µé¢</button></div>
    <div id="audio-player-container"><audio id="audio-element" loop><source src="M5000044Nr9A4ZiFFQ.mp3" type="audio/mpeg">ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾éŸ³é¢‘ã€‚</audio><button id="play-pause-button" aria-label="æ’­æ”¾/æš‚åœ"><span class="play-icon"></span></button><div class="audio-controls-right"><input type="range" id="seek-bar" value="0" aria-label="è¿›åº¦æ¡"><div class="time-display"><span id="current-time">0:00</span><span id="duration">0:00</span></div></div></div>


    <script>
        // --- Existing Variables and Setup ---
        const birthdayView = document.getElementById('birthday-view');
        const loveLetterView = document.getElementById('love-letter-view');
        const cakeLink = document.getElementById('birthday-cake-link');
        const backButton = loveLetterView.querySelector('.back-button');
        const audioElement = document.getElementById('audio-element');
        const audioPlayerContainer = document.getElementById('audio-player-container');
        const playPauseButton = document.getElementById('play-pause-button');
        const playIcon = playPauseButton ? playPauseButton.querySelector('.play-icon') : null; // Added null check
        const seekBar = document.getElementById('seek-bar');
        const currentTimeDisplay = document.getElementById('current-time');
        const durationDisplay = document.getElementById('duration');
        let birthdayIntervalId = null;
        let loveLetterIntervalId = null;
        const birthdayItems = ['ğŸ‚', 'ğŸŒ¸'];
        const loveLetterItems = ['â¤ï¸', 'ğŸ‚'];
        const BIRTHDAY_INTERVAL_TIME = 550;
        const LOVE_LETTER_INTERVAL_TIME = 500;
        const slideshow = document.getElementById('slideshow');
        const slides = document.querySelectorAll('.slide');
        const prevButton = document.querySelector('.slideshow-nav.prev');
        const nextButton = document.querySelector('.slideshow-nav.next');
        const dotsContainer = document.querySelector('.dots-container');
        let currentSlideIndex = 0;
        let slideInterval = null;
        const slideCount = slides.length;
        const SLIDESHOW_INTERVAL_TIME = 5000;

        // --- Falling Items Functions [Existing] ---
        function createFallingItem(itemType, container) { if (!container || container.style.display === 'none') return; const item = document.createElement('div'); item.classList.add('falling-item'); item.style.left = Math.random() * 95 + 'vw'; item.innerText = itemType; item.style.fontSize = (Math.random() * 10 + 18) + 'px'; const fallDuration = Math.random() * 5 + 7; const delay = Math.random() * 4; item.style.setProperty('--random-rotate', (Math.random() * 80 - 40) || 0); item.style.animationDuration = `${fallDuration}s`; item.style.animationDelay = delay + 's'; container.appendChild(item); setTimeout(() => { if (item && item.parentNode) item.remove(); }, (fallDuration + delay) * 1000 + 500); }
        function startFallingItems(intervalId, itemArray, container, intervalTime) { if (intervalId) clearInterval(intervalId); if (!container) return null; const newIntervalId = setInterval(() => { if (container.style.display !== 'none') { const randomItem = itemArray[Math.floor(Math.random() * itemArray.length)]; createFallingItem(randomItem, container); } }, intervalTime); return newIntervalId; }
        function stopFallingItems(intervalId, container) { if (intervalId) clearInterval(intervalId); if (container) { const existingItems = container.querySelectorAll('.falling-item'); existingItems.forEach(item => item.remove()); } return null; }

        // --- View Switching Logic [Existing] ---
        if (cakeLink) { cakeLink.addEventListener('click', (event) => { event.preventDefault(); showLoveLetter(); }); }
        if (backButton) { backButton.addEventListener('click', showBirthday); }
        function showLoveLetter() { birthdayIntervalId = stopFallingItems(birthdayIntervalId, birthdayView); if(birthdayView) birthdayView.style.display = 'none'; if(loveLetterView) loveLetterView.style.display = 'block'; loveLetterIntervalId = startFallingItems(loveLetterIntervalId, loveLetterItems, loveLetterView, LOVE_LETTER_INTERVAL_TIME); window.scrollTo(0, 0); tryResumeAudio(); stopSlideshowAutoplay(); }
        function showBirthday() { loveLetterIntervalId = stopFallingItems(loveLetterIntervalId, loveLetterView); if(loveLetterView) loveLetterView.style.display = 'none'; if(birthdayView) birthdayView.style.display = 'block'; birthdayIntervalId = startFallingItems(birthdayIntervalId, birthdayItems, birthdayView, BIRTHDAY_INTERVAL_TIME); window.scrollTo(0, 0); tryResumeAudio(); startSlideshowAutoplay(); }

        // --- Pointer Trail Heart Logic (Optimized Throttle) ---
        function throttle(func, limit) { let inThrottle; return function() { const args = arguments; const context = this; if (!inThrottle) { func.apply(context, args); inThrottle = true; setTimeout(() => inThrottle = false, limit); } } }
        function createPointerHeart(x, y) { const heart = document.createElement('div'); heart.classList.add('pointer-heart'); heart.innerHTML = 'â¤ï¸'; heart.style.left = `${x}px`; heart.style.top = `${y}px`; document.body.appendChild(heart); setTimeout(() => { if (heart && heart.parentNode) heart.remove(); }, 800); }
        const throttledCreateHeart = throttle(createPointerHeart, 100); // Increased throttle
        document.body.addEventListener('mousemove', (event) => { throttledCreateHeart(event.pageX, event.pageY); });
        document.body.addEventListener('touchmove', (event) => { if (event.touches.length > 0) { const touch = event.touches[0]; throttledCreateHeart(touch.pageX, touch.pageY); } }, { passive: true });
        document.body.addEventListener('touchstart', (event) => { if (event.touches.length > 0) { const touch = event.touches[0]; throttledCreateHeart(touch.pageX, touch.pageY); } }, { passive: true });

        // --- Custom Audio Player Logic (Added Null Checks) ---
        let isSeeking = false;
        function formatTime(seconds) { const minutes = Math.floor(seconds / 60); const secs = Math.floor(seconds % 60); return `${minutes}:${secs < 10 ? '0' : ''}${secs}`; }
        function updatePlayPauseIcon() {
            if (!playIcon || !audioElement || !playPauseButton) return; // Add checks
            playIcon.classList.remove('play-icon', 'pause-icon');
            if (audioElement.paused || audioElement.ended) {
                playIcon.classList.add('play-icon');
                playPauseButton.setAttribute('aria-label', 'æ’­æ”¾');
            } else {
                playIcon.classList.add('pause-icon');
                playPauseButton.setAttribute('aria-label', 'æš‚åœ');
            }
        }
        if (playPauseButton && audioElement) { // Check before adding listener
            playPauseButton.addEventListener('click', () => {
                if (audioElement.paused || audioElement.ended) {
                    audioElement.play().catch(e => console.error("Error playing audio:", e));
                 } else {
                    audioElement.pause();
                 }
             });
        }
        if (audioElement) {
            audioElement.addEventListener('timeupdate', () => { if (!isSeeking && !isNaN(audioElement.duration) && seekBar && currentTimeDisplay) { seekBar.value = audioElement.currentTime; currentTimeDisplay.textContent = formatTime(audioElement.currentTime); } });
            audioElement.addEventListener('loadedmetadata', () => { if (!isNaN(audioElement.duration) && seekBar && durationDisplay) { seekBar.max = audioElement.duration; durationDisplay.textContent = formatTime(audioElement.duration); } });
            audioElement.addEventListener('play', updatePlayPauseIcon);
            audioElement.addEventListener('pause', updatePlayPauseIcon);
            audioElement.addEventListener('ended', updatePlayPauseIcon);
        }
        if (seekBar && currentTimeDisplay && audioElement) { // Check elements
            seekBar.addEventListener('input', () => { isSeeking = true; currentTimeDisplay.textContent = formatTime(parseFloat(seekBar.value) || 0); }); // Handle potential NaN
            seekBar.addEventListener('change', () => { if (!isNaN(audioElement.duration)) { audioElement.currentTime = parseFloat(seekBar.value) || 0; } isSeeking = false; });
        }


        // --- Audio Autoplay Workaround (with WeChat JSBridge Check) ---
        let hasInteracted = false;
        const isWeChat = /micromessenger/i.test(navigator.userAgent);

        function playAudio() {
            if (audioElement && audioElement.paused) {
                const playPromise = audioElement.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => { updatePlayPauseIcon(); });
                }
            } else {
                 updatePlayPauseIcon(); // Update icon even if already playing or no element
            }
        }
        function tryResumeAudio() {
            if (hasInteracted) {
                if (isWeChat) {
                    if (typeof WeixinJSBridge == "object" && typeof WeixinJSBridge.invoke == "function") { playAudio(); }
                    else { document.addEventListener("WeixinJSBridgeReady", playAudio, false); }
                } else { playAudio(); }
            } else { updatePlayPauseIcon(); } // Update icon if no interaction yet
        }
        function firstInteractionHandler() {
            if (!hasInteracted) {
                hasInteracted = true;
                tryResumeAudio();
                document.body.removeEventListener('click', firstInteractionHandler);
                document.body.removeEventListener('touchend', firstInteractionHandler);
            }
        }
        document.body.addEventListener('click', firstInteractionHandler, { once: false });
        document.body.addEventListener('touchend', firstInteractionHandler, { once: false, passive: true });


        // --- Slideshow Logic [Existing] ---
        function updateDots() { if (!dotsContainer || dotsContainer.children.length !== slideCount) return; for (let i = 0; i < slideCount; i++) { dotsContainer.children[i].classList.toggle('active', i === currentSlideIndex); } }
        function showSlide(index) { if (slideCount <= 0 || !slideshow) return; if (index >= slideCount) { currentSlideIndex = 0; } else if (index < 0) { currentSlideIndex = slideCount - 1; } else { currentSlideIndex = index; } const offset = -currentSlideIndex * 100; slideshow.style.transform = `translateX(${offset}%)`; updateDots(); }
        function nextSlide() { showSlide(currentSlideIndex + 1); }
        function startSlideshowAutoplay() { stopSlideshowAutoplay(); if (slideCount > 1) { slideInterval = setInterval(nextSlide, SLIDESHOW_INTERVAL_TIME); } }
        function stopSlideshowAutoplay() { clearInterval(slideInterval); slideInterval = null; }
        if (prevButton && nextButton) {
            prevButton.addEventListener('click', () => { stopSlideshowAutoplay(); showSlide(currentSlideIndex - 1); });
            nextButton.addEventListener('click', () => { stopSlideshowAutoplay(); showSlide(currentSlideIndex + 1); });
        }
        function createDots() { if (!dotsContainer || slideCount <= 0) return; dotsContainer.innerHTML = ''; for (let i = 0; i < slideCount; i++) { const dot = document.createElement('span'); dot.classList.add('dot'); dot.dataset.index = i; dot.setAttribute('aria-label', `è·³è½¬åˆ°ç…§ç‰‡ ${i + 1}`); dot.addEventListener('click', (e) => { stopSlideshowAutoplay(); const index = parseInt(e.target.dataset.index); showSlide(index); }); dotsContainer.appendChild(dot); } updateDots(); }

        // --- Draggable Audio Player Logic [Existing] ---
        let isDraggingPlayer = false; let playerOffsetX, playerOffsetY; let startX, startY;
        function dragStart(event) { isDraggingPlayer = true; audioPlayerContainer.style.transition = 'none'; if (event.type === 'touchstart') { startX = event.touches[0].clientX; startY = event.touches[0].clientY; } else { startX = event.clientX; startY = event.clientY; event.preventDefault(); } const rect = audioPlayerContainer.getBoundingClientRect(); playerOffsetX = startX - rect.left; playerOffsetY = startY - rect.top; document.addEventListener('mousemove', dragging); document.addEventListener('touchmove', dragging, { passive: false }); document.addEventListener('mouseup', dragEnd); document.addEventListener('touchend', dragEnd); }
        function dragging(event) { if (!isDraggingPlayer) return; let currentX, currentY; if (event.type === 'touchmove') { event.preventDefault(); currentX = event.touches[0].clientX; currentY = event.touches[0].clientY; } else { currentX = event.clientX; currentY = event.clientY; } let newLeft = currentX - playerOffsetX; let newTop = currentY - playerOffsetY; const containerWidth = audioPlayerContainer.offsetWidth; const containerHeight = audioPlayerContainer.offsetHeight; const viewportWidth = window.innerWidth; const viewportHeight = window.innerHeight; if (newLeft < 0) newLeft = 0; if (newTop < 0) newTop = 0; if (newLeft + containerWidth > viewportWidth) newLeft = viewportWidth - containerWidth; if (newTop + containerHeight > viewportHeight) newTop = viewportHeight - containerHeight; audioPlayerContainer.style.left = `${newLeft}px`; audioPlayerContainer.style.top = `${newTop}px`; audioPlayerContainer.style.right = 'auto'; audioPlayerContainer.style.bottom = 'auto'; audioPlayerContainer.style.transform = 'none'; }
        function dragEnd() { if (isDraggingPlayer) { isDraggingPlayer = false; audioPlayerContainer.style.transition = ''; document.removeEventListener('mousemove', dragging); document.removeEventListener('touchmove', dragging); document.removeEventListener('mouseup', dragEnd); document.removeEventListener('touchend', dragEnd); } }
        if (audioPlayerContainer) {
             audioPlayerContainer.addEventListener('mousedown', dragStart);
             audioPlayerContainer.addEventListener('touchstart', dragStart, { passive: false });
        }


        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            // Defer initialization requiring DOM elements until DOM is ready
            if (birthdayView) birthdayView.style.position = 'relative';
            if (loveLetterView) loveLetterView.style.position = 'relative';
            if (birthdayView) {
                birthdayIntervalId = startFallingItems(birthdayIntervalId, birthdayItems, birthdayView, BIRTHDAY_INTERVAL_TIME);
            }
            if (audioElement) {
                updatePlayPauseIcon();
                // Initial play attempt deferred slightly or handled by interaction
                // Consider removing initial play attempt completely for WeChat stability
                 // audioElement.play().catch(e => { updatePlayPauseIcon(); });
            } else {
                 // If no audio element, hide player?
                 if (audioPlayerContainer) audioPlayerContainer.style.display = 'none';
            }
            if (slideshow && slideCount > 0) {
                createDots();
                showSlide(0);
                startSlideshowAutoplay();
            } else {
                const slideshowContainer = document.getElementById('photo-slideshow-container');
                if(slideshowContainer) slideshowContainer.style.display = 'none';
            }
        });


    </script>

</body>
</html>