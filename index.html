<!DOCTYPE html>
 <html lang="zh-CN">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
     <title>Âº†ÁèäÁèäÂ•≥Â£´ÔºåÁîüÊó•Âø´‰πêÔºÅ</title>

     <link rel="preload" href="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/pfsg.ttf" as="font" type="font/ttf" crossorigin>

     <style>
         /* --- Web Font Definition --- */
         @font-face {
             font-family: 'MyCustomLetterFont';
             src: url('https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/pfsg.ttf');
             font-weight: normal;
             font-style: normal;
             font-display: swap;
         }

         /* --- General Styles --- */
         *, *::before, *::after { box-sizing: border-box; }
         html { -webkit-tap-highlight-color: transparent; }
         body {
             font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", system-ui, sans-serif;
             line-height: 1.6; margin: 0;
             padding-bottom: 80px; /* Space for audio player */
             background-color: #f8f0f8; /* Fallback background */
             overflow-x: hidden; font-size: 16px; min-height: 100vh; position: relative; -webkit-overflow-scrolling: touch;
             /* Add padding for safe areas */
             padding-top: env(safe-area-inset-top, 0px);
             padding-left: env(safe-area-inset-left, 0px);
             padding-right: env(safe-area-inset-right, 0px);
             padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
         }
         body, div, p, h1, button, img, input { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }

         /* --- Background Layers --- */
         #background-layer {
             position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
             background-image: url("https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/background-placeholder.jpg");
             background-size: cover;
             background-position: center center; /* Center the background image */
         }
         #background-overlay {
             position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
             background-color: rgba(255, 255, 255, 0.4); /* Lighter, more transparent */
             backdrop-filter: blur(12px); /* Increased blur */
             -webkit-backdrop-filter: blur(12px);
         }
         @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
             #background-overlay {
                 background-color: rgba(248, 240, 248, 0.85); /* More opaque fallback */
             }
         }

         /* --- Views (Overlay) --- */
         .overlay-view {
             position: fixed; top: 0; left: 0; width: 100%; height: 100%;
             display: none; /* Hidden initially */
             flex-direction: column;
             align-items: center;
             justify-content: center;
             padding: 20px;
             text-align: center;
             background-color: rgba(245, 245, 245, 0.2);
             backdrop-filter: blur(15px);
             -webkit-backdrop-filter: blur(15px);
         }
          @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
             .overlay-view {
                 background-color: rgba(0, 0, 0, 0.75);
             }
         }

         #birthday-view, #love-letter-view {
              padding: 15px; position: relative; z-index: 1; display: none;
         }
         #birthday-view {
             display: block; /* Show birthday view initially */
             background-color: transparent;
             cursor: url('https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/Aero_arrow.cur') 16 16, auto;
             min-height: 100vh;
         }
         #love-letter-view {
             background-color: rgba(255, 250, 240, 0.92);
             color: #5a463a; max-width: 95%; margin: 40px auto;
             box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
             border-radius: 16px;
             padding: 20px; padding-top: 60px; padding-bottom: 80px; position: relative; z-index: 10;
         }
         #love-letter-view::before { content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 0; border-style: solid; border-width: 60px 0 0 calc(50vw - 15px); border-color: rgba(254, 202, 202, 0.8) transparent transparent rgba(254, 202, 202, 0.8); z-index: 1; border-top-left-radius: 16px; }
         #love-letter-view::after { content: ''; position: absolute; top: 0; right: 0; width: 50%; height: 0; border-style: solid; border-width: 0 0 60px calc(50vw - 15px); border-color: transparent rgba(254, 202, 202, 0.8) rgba(254, 202, 202, 0.8) transparent; z-index: 1; border-top-right-radius: 16px; }

         /* --- Birthday View Content Styles --- */
         #birthday-view .birthday-container { z-index: 10; display: flex; flex-direction: column; align-items: center; text-align: center; margin-top: 30px; position: relative; padding: 0 30px;}
         #birthday-view #birthday-cake-link { display: flex; justify-content: center; width: 100%; text-decoration: none; cursor: inherit; position: relative; -webkit-tap-highlight-color: transparent; }
         #birthday-view #birthday-cake { display: block; max-width: 100%; max-height: 280px; height: auto; width: auto; object-fit: contain; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); transition: transform 0.2s ease-in-out; }
         #birthday-view #birthday-cake-link:hover #birthday-cake { transform: scale(1.05); }
         #birthday-message { font-size: 1.4em; font-weight: bold; color: #e83e8c; text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.9); margin-top: 0; padding: 0 10px; margin-bottom: 30px; position: relative; z-index: 10; text-align: center; }
         #birthday-view h1 { font-size: 1.8em; color: #6f42c1; text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.7); text-align: center; position: relative; z-index: 10; margin-bottom: 15px; overflow: hidden; }
         #birthday-view h1::after { content: '‚ú®'; position: absolute; top: -5px; right: -10px; font-size: 0.8em; opacity: 0; animation: sparkle 2.5s infinite ease-in-out; animation-delay: 0.5s; z-index: 11; }
         @keyframes sparkle { 0%, 100% { opacity: 0; transform: scale(0.5) rotate(0deg); } 25%, 75% { opacity: 0.8; transform: scale(1) rotate(15deg); } 50% { opacity: 0.5; transform: scale(0.8) rotate(-10deg); } }
         #birthday-view hr { position: relative; z-index: 10; margin-top: 30px; border: 0; height: 1px; background: #ccc; }
         #birthday-view .footer-text { text-align: center; color: #333; text-shadow: 0 0 5px rgba(255,255,255,0.8); position: relative; z-index: 10; padding-bottom: 20px; font-size: 0.9em; }

         /* --- Love Letter View Styles --- */
         #love-letter-view h1 {
             font-size: 1.6em; color: #d9534f; text-align: center; margin-bottom: 25px;
             font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", system-ui, sans-serif;
             position: relative; padding: 0 30px; z-index: 2;
             display: inline-block; margin-right: 10px; margin-bottom: 15px; vertical-align: middle;
         }
         #love-letter-view h1::before { content: 'üéÇ'; position: absolute; left: 5px; top: 50%; transform: translateY(-50%); font-size: 0.9em; z-index: 3;}
         #love-letter-view h1::after { content: '‚ù§Ô∏è'; position: absolute; right: 5px; top: 50%; transform: translateY(-50%); font-size: 0.9em; z-index: 3;}
         #love-letter-view p { font-family: 'MyCustomLetterFont', 'KaiTi', 'STKaiti', 'SimSun', serif; margin-bottom: 1.3em; text-indent: 2em; font-size: 1em; position: relative; z-index: 2; overflow-wrap: break-word; word-wrap: break-word; transition: font-family 0.3s ease; }
         #love-letter-view .signature { font-family: 'MyCustomLetterFont', 'KaiTi', 'STKaiti', 'SimSun', serif; text-align: right; margin-top: 30px; font-style: italic; line-height: 1.6; font-size: 0.95em; position: relative; z-index: 2; word-break: break-word; transition: font-family 0.3s ease; }
         #love-letter-view.love-letter-default-font p,
         #love-letter-view.love-letter-default-font .signature { font-family: 'KaiTi', 'STKaiti', 'SimSun', serif; }

         /* --- Buttons --- */
         .styled-button {
             display: inline-block; margin: 8px; padding: 10px 20px; border: none; border-radius: 8px;
             cursor: pointer; font-size: 1em; font-weight: 500;
             font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", system-ui, sans-serif;
             -webkit-tap-highlight-color: transparent;
             transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
             text-decoration: none; color: white; text-align: center; line-height: 1.4;
             box-shadow: 0 2px 5px rgba(0,0,0,0.15);
         }
         .styled-button:hover { box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
         .styled-button:active { transform: scale(0.97); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
         .styled-button:disabled { background-color: #cccccc; cursor: not-allowed; box-shadow: none; }

         /* Specific Button Colors */
         #font-toggle-button, #back-from-game, #continue-game-button, #password-submit-button, #spin-button { background-color: #ff75ac; }
         #font-toggle-button:hover, #back-from-game:hover, #continue-game-button:hover, #password-submit-button:hover, #spin-button:hover { background-color: #ff5c9a; }
         #font-toggle-button:disabled:hover, #spin-button:disabled:hover { background-color: #cccccc; }

         #love-letter-view #font-toggle-button { display: inline-block; padding: 6px 12px; font-size: 0.85em; vertical-align: middle; margin-bottom: 15px; margin-top: 0; margin-left: 0; margin-right: 0; }

         .back-button, #back-from-slot-machine, #close-prize-dialog /* Updated ID */ { padding: 12px 25px; font-size: 1.1em; background-color: #6f42c1; }
         .back-button:hover, #back-from-slot-machine:hover, #close-prize-dialog:hover /* Updated ID */ { background-color: #5a349a; }

         #goto-game-button, #confirm-start-game, .show-slot-winnings-button { background-color: #ff9800; }
         #goto-game-button:hover, #confirm-start-game:hover, .show-slot-winnings-button:hover { background-color: #f57c00; }

         #redeem-early-button, #proceed-to-hongbao-game { background-color: #4CAF50; }
         #redeem-early-button:hover, #proceed-to-hongbao-game:hover { background-color: #45a049; }

         .love-letter-buttons { text-align: center; margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }

         .small-button { padding: 6px 12px; font-size: 0.9em; }

         /* --- Falling Items Styles --- */
         .falling-item { position: absolute; top: -60px; font-size: 22px; user-select: none; pointer-events: none; animation: fall linear forwards; opacity: 0.75; z-index: 5; will-change: transform, opacity; }
         @keyframes fall { 0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.75; } 100% { transform: translateY(calc(100vh + 100px)) rotate(calc(var(--random-rotate, 0) * 1deg)); opacity: 0; } }

         /* --- Pointer Trail Heart Styles --- */
         .pointer-heart { position: absolute; font-size: 18px; color: #ff4d6d; pointer-events: none; user-select: none; z-index: 9999; animation: fade-move-out-quick 0.6s ease-out forwards; text-shadow: 0 0 4px rgba(0, 0, 0, 0.2); }
         @keyframes fade-move-out-quick { 0% { opacity: 0.9; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -120%) scale(0.3); } }

         /* --- Slideshow Styles --- */
         #photo-slideshow-container { position: relative; z-index: 10; max-width: 500px; margin: 20px auto; padding: 15px; background-color: rgba(255, 255, 255, 0.8); border-radius: 16px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); border: none; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
         #slideshow-wrapper { position: relative; overflow: hidden; border-radius: 12px; aspect-ratio: 4 / 3; background-color: #eee; }
         #slideshow { display: flex; width: 100%; height: 100%; transition: transform 0.5s ease-in-out; }
         .slide { min-width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; overflow: hidden; }
         .slide img { display: block; width: 100%; height: 100%; object-fit: cover; }
         .slideshow-nav { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0, 0, 0, 0.3); border: none; color: #fff; font-size: 1.5em; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 15; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; line-height: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.2); -webkit-tap-highlight-color: transparent; }
         .slideshow-nav:hover { background-color: rgba(0, 0, 0, 0.5); }
         .slideshow-nav.prev { left: 10px; }
         .slideshow-nav.next { right: 10px; }
         .dots-container { text-align: center; margin-top: 15px; position: relative; z-index: 15; }
         .dot { display: inline-block; width: 8px; height: 8px; background-color: rgba(0, 0, 0, 0.2); border-radius: 50%; margin: 0 5px; cursor: pointer; transition: background-color 0.3s ease, transform 0.3s ease; }
         .dot.active { background-color: #ff75ac; transform: scale(1.3); }
         #slideshow-caption { text-align: center; margin-top: 15px; font-size: 0.95em; color: #555; padding: 8px; min-height: 1.5em; font-style: italic; background-color: rgba(255, 255, 255, 0.5); border-radius: 8px; }

         /* --- Custom Audio Player Styles --- */
         #audio-player-container {
             position: fixed; bottom: 10px; right: 10px; left: auto; transform: none; width: 85%; max-width: 320px; z-index: 10000;
             background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(10px) saturate(120%); -webkit-backdrop-filter: blur(10px) saturate(120%);
             border-radius: 16px; padding: 10px 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
             border: 1px solid rgba(255, 255, 255, 0.2); display: flex; align-items: center; gap: 10px; cursor: move; touch-action: none;
         }
         @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) { #audio-player-container { background-color: rgba(255, 222, 233, 0.9); } }
         #play-pause-button { background-color: #ff75ac; border: none; color: white; font-size: 1.3em; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; flex-shrink: 0; padding: 0; line-height: 1; box-shadow: 0 1px 3px rgba(0,0,0,0.15); -webkit-tap-highlight-color: transparent; }
         #play-pause-button:hover { background-color: #ff5c9a; }
         #play-pause-button .play-icon::before { content: '‚ñ∂Ô∏è'; }
         #play-pause-button .pause-icon::before { content: '‚è∏Ô∏è'; }
         .audio-controls-right { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
         #song-title { font-size: 0.8em; color: #555; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 3px; font-weight: 500; }
         #seek-bar { width: 100%; height: 6px; cursor: pointer; appearance: none; background: rgba(255, 194, 209, 0.5); border-radius: 3px; outline: none; }
         #seek-bar::-webkit-slider-thumb { appearance: none; width: 14px; height: 14px; background: #ff75ac; border-radius: 50%; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
         #seek-bar::-moz-range-thumb { width: 14px; height: 14px; background: #ff75ac; border-radius: 50%; cursor: pointer; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
         .time-display { display: flex; justify-content: space-between; font-size: 0.75em; color: #666; margin-top: 2px; padding: 0 2px; }
         #audio-element { display: none; }

         /* --- Cat Pendant Styles --- */
         #cat-pendant { position: fixed; top: 15px; left: 15px; width: 60px; height: 60px; z-index: 9998; cursor: move; overflow: visible; background-color: transparent; transition: transform 0.2s ease; -webkit-tap-highlight-color: transparent; touch-action: none; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
         #cat-pendant:hover { transform: scale(1.1); }
         #cat-pendant img { display: block; width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
         #cat-pendant.rolling { animation: cat-roll 0.7s linear; }
         @keyframes cat-roll { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
         #cat-dialog {
             position: absolute; top: 50%; left: 110%; transform: translateY(-50%); min-width: 180px; max-width: 220px; padding: 12px 18px; border-radius: 12px;
             background-color: rgba(255, 255, 255, 0.7); backdrop-filter: blur(8px) saturate(110%); -webkit-backdrop-filter: blur(8px) saturate(110%);
             box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 1px solid rgba(255, 255, 255, 0.25);
             color: #333; font-size: 0.9em; text-align: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-out, visibility 0s linear 0.3s; z-index: 1; pointer-events: none;
         }
         #cat-dialog::after { content: ''; position: absolute; top: 50%; right: 100%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; border-width: 8px 8px 8px 0; border-color: transparent rgba(255, 255, 255, 0.7) transparent transparent; }
         #cat-dialog.visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease-out, visibility 0s linear 0s; }
         @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) { #cat-dialog { background-color: rgba(255, 192, 203, 0.9); } #cat-dialog::after { border-color: transparent rgba(255, 192, 203, 0.9) transparent transparent; } }

         /* --- Warning Message Styles --- */
         #love-warning-message {
             position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 30px 45px;
             background-color: rgba(255, 105, 135, 0.3); color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.3);
             font-size: 1.6em; font-weight: bold; text-align: center; border-radius: 16px;
             box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2); z-index: 11000; display: none;
             backdrop-filter: blur(12px) saturate(130%); -webkit-backdrop-filter: blur(12px) saturate(130%);
             border: 1px solid rgba(255, 255, 255, 0.2); max-width: 90%;
         }
         @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) { #love-warning-message { background-color: rgba(229, 57, 53, 0.9); color: white; } }

         /* --- Shared Box Style for Modal Content --- */
         .modal-content-box {
             background-color: rgba(255, 255, 255, 0.85); padding: 25px 35px; border-radius: 16px;
             box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); color: #333; max-width: 90%;
             border: 1px solid rgba(255, 255, 255, 0.1); position: relative;
         }

         /* --- Game Start Warning Styles --- */
         #game-start-warning { z-index: 90; }
         #game-start-warning-box p { margin-bottom: 25px; font-size: 1.1em; line-height: 1.6; }

        /* --- Password Prompt Styles --- */
         #password-prompt-view { z-index: 95; }
         #password-prompt-box h2 { margin-top: 0; margin-bottom: 20px; font-size: 1.3em; color: #e83e8c; }
         #password-input {
             padding: 12px; margin-bottom: 20px; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px; font-size: 1.1em;
             width: 120px; text-align: center; background-color: rgba(255, 255, 255, 0.7); box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
             -moz-appearance: textfield; appearance: textfield;
         }
         #password-input:focus { outline: 2px solid #ffc2d1; outline-offset: 2px; border-color: rgba(0, 0, 0, 0.2); }
         #password-error-message { color: #d9534f; font-size: 0.95em; min-height: 1.3em; margin-top: 5px; }

         /* --- Game View Styles --- */
         #game-view {
             z-index: 100; padding-top: env(safe-area-inset-top, 20px); padding-bottom: env(safe-area-inset-bottom, 20px);
         }
         #game-info {
             padding: 12px 25px; margin-bottom: 20px; font-size: 1.1em; font-weight: 500;
             min-width: 280px; background-color: rgba(255, 255, 255, 0.9);
         }
         #game-info span { display: inline-block; margin: 0 8px; }
         #game-area {
             width: 100%; max-width: 600px; height: 65%; background-color: rgba(255, 255, 255, 0.15);
             border: 1px solid rgba(255, 255, 255, 0.3); position: relative; overflow: hidden;
             border-radius: 16px; margin-bottom: 20px; box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
         }
         .game-item {
             position: absolute; width: 50px; height: 70px; border-radius: 8px;
             cursor: pointer; top: -80px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold;
             box-shadow: 0 3px 8px rgba(0,0,0,0.25); animation: fall-game-item linear forwards; user-select: none; -webkit-user-select: none;
             text-shadow: 0 1px 1px rgba(0,0,0,0.2);
         }
         @keyframes fall-game-item { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(calc(100vh + 80px)) rotate(720deg); } }
         .hongbao { background-color: #e53935; border: 2px solid #ffeb3b; color: #ffeb3b; } .hongbao::before { content: 'Á¶è'; }
         .green-envelope { background-color: #4CAF50; border: 2px solid #C8E6C9; color: #C8E6C9; font-size: 28px; } .green-envelope::before { content: 'üíö'; }
         .mouse-item { background-color: #795548; border: 2px solid #A1887F; color: #A1887F; font-size: 30px; height: 55px; } .mouse-item::before { content: 'üêÄ'; }

         #game-result {
             margin-top: 20px; padding: 25px 35px; font-size: 1.2em; text-align: center;
             display: none; max-width: 90%; background-color: rgba(255, 255, 255, 0.9);
         }
         #game-result-text { margin-bottom: 25px; line-height: 1.5; }
         #game-result .prize-code { margin-top: 10px; font-weight: bold; color: #e53935; word-break: break-all; font-size: 1.1em; }
         #game-result-buttons { margin-top: 20px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
         #back-from-game { margin-top: 25px; }

         /* --- Slot Machine Styles --- */
         #slot-machine-view { z-index: 85; }
         .slot-machine-box h2 { margin-top: 0; margin-bottom: 20px; color: #ff75ac; font-size: 1.4em; }
         #slot-display-area { display: flex; justify-content: center; margin-bottom: 25px; gap: 15px; }
         .slot {
             display: inline-block; width: 60px; height: 80px; line-height: 80px; font-size: 40px; text-align: center;
             border: 2px solid #ffc2d1; border-radius: 10px; background-color: rgba(255, 255, 255, 0.8);
             box-shadow: inset 0 0 8px rgba(0,0,0,0.1); transition: transform 0.1s ease-out;
         }
         .slot.spinning { transform: scale(0.9); }
         #slot-result-message { min-height: 3em; margin-bottom: 20px; font-size: 1.1em; font-weight: 500; color: #6f42c1; padding: 0 10px; }
         #slot-buttons { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 20px; margin-bottom: 10px; }

         /* --- Slot Winnings Button --- */
         .show-slot-winnings-button { padding: 8px 15px; font-size: 0.9em; margin-top: 15px; }

         /* --- Êñ∞Â¢ûÔºöÂºπÂá∫ÂºèÂ•ñÂìÅÂØπËØùÊ°ÜÊ†∑Âºè --- */
         .popup-dialog {
             position: fixed; /* Âõ∫ÂÆöÂú®Â±èÂπï‰∏ä */
             top: 20px;       /* Ë∑ùÁ¶ªÈ°∂ÈÉ® 20px */
             right: 20px;      /* Ë∑ùÁ¶ªÂè≥‰æß 20px */
             z-index: 1000;   /* Á°Æ‰øùÂú®Ê∏∏ÊàèÂÖÉÁ¥†‰πã‰∏ä */
             max-width: 280px; /* ÊúÄÂ§ßÂÆΩÂ∫¶ */
             width: calc(100% - 40px); /* ÈÄÇÂ∫îÂ∞èÂ±èÂπï */
             display: none;   /* ÂàùÂßãÈöêËóè */
             opacity: 0;      /* ÂàùÂßãÈÄèÊòé */
             transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* ËøáÊ∏°ÊïàÊûú */
             transform: translateY(-10px); /* ÂàùÂßãÂêë‰∏äÂÅèÁßª‰∏ÄÁÇπ */
             pointer-events: none; /* ÈöêËóèÊó∂‰∏çÂèØ‰∫§‰∫í */
         }

         .popup-dialog.visible {
             display: block;
             opacity: 1;
             transform: translateY(0); /* ÊÅ¢Â§çÊ≠£Â∏∏‰ΩçÁΩÆ */
             pointer-events: auto; /* ÂèØËßÅÊó∂ÂèØ‰∫§‰∫í */
         }

         .popup-dialog-box {
             background-color: rgba(255, 255, 255, 0.7);
             backdrop-filter: blur(8px) saturate(110%);
             -webkit-backdrop-filter: blur(8px) saturate(110%);
             box-shadow: 0 4px 15px rgba(0,0,0,0.15);
             border: 1px solid rgba(255, 255, 255, 0.25);
             color: #333;
             border-radius: 12px;
             padding: 15px 20px; /* ÂÜÖËæπË∑ù */
             text-align: left; /* ÂÜÖÂÆπÂ∑¶ÂØπÈΩê */
         }

         @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
            .popup-dialog-box {
                background-color: rgba(255, 222, 233, 0.95); /* ‰∏çÊîØÊåÅÊØõÁéªÁíÉÁöÑÈôçÁ∫ßËÉåÊôØ */
            }
         }

         .popup-dialog-box h2 {
             margin-top: 0;
             margin-bottom: 10px;
             font-size: 1.1em;
             color: #e83e8c; /* Pink */
             text-align: center; /* Ê†áÈ¢òÂ±Ö‰∏≠ */
         }

         #prize-dialog-content ul {
             list-style: none; /* ÁßªÈô§ÂàóË°®ÈªòËÆ§Ê†∑Âºè */
             padding: 0;
             margin: 0 0 15px 0; /* ÂàóË°®‰∏ãÊñπÁïôÁôΩ */
             font-size: 0.95em;
             line-height: 1.5;
         }
         #prize-dialog-content li {
             margin-bottom: 5px; /* ÂàóË°®È°πÈó¥Ë∑ù */
         }

         #close-prize-dialog {
             display: block; /* ËÆ©ÊåâÈíÆÁã¨Âç†‰∏ÄË°å */
             margin: 0 auto; /* Â±Ö‰∏≠ÊåâÈíÆ */
             /* ‰ΩøÁî®Â∞èÊåâÈíÆÊ†∑Âºè */
         }

         /* --- ÁßªÈô§ÊóßÊ†∑Âºè (Êó†ÈúÄ‰øùÁïô) --- */


         /* Media Query Adjustments */
         @media (max-width: 600px) {
              .modal-content-box { padding: 20px 25px; }
              #love-warning-message { font-size: 1.3em; padding: 20px 30px; }
              #game-start-warning-box p { font-size: 1em; }
              #password-prompt-box h2 { font-size: 1.1em; }
              #password-input { padding: 10px; margin-bottom: 15px; width: 100px; }
              #game-info { font-size: 1em; min-width: 220px; padding: 10px 20px;}
              #game-result { font-size: 1.1em; padding: 20px 25px;}
              #photo-slideshow-container { max-width: 95%; padding: 10px; }
              .slideshow-nav { width: 35px; height: 35px; font-size: 1.3em; }
              .slideshow-nav.prev { left: 5px; } .slideshow-nav.next { right: 5px; }
              .dot { width: 8px; height: 8px; margin: 0 4px;}
              #audio-player-container { max-width: 280px; padding: 8px 12px; gap: 8px; border-radius: 12px;}
              #love-letter-view { padding-top: 45px; margin-top: 30px; border-radius: 12px; }
              #love-letter-view::before { border-width: 45px 0 0 calc(50vw - 10px); border-top-left-radius: 12px;}
              #love-letter-view::after { border-width: 0 0 45px calc(50vw - 10px); border-top-right-radius: 12px;}
              #cat-pendant { width: 50px; height: 50px; top: 10px; left: 10px; }
              #cat-dialog { font-size: 0.8em; min-width: 150px; left: 115%; padding: 10px 15px; border-radius: 10px;}
              #slideshow-caption { font-size: 0.9em;}
              #love-letter-view .signature { font-size: 0.9em; }
              .styled-button { font-size: 0.9em; padding: 10px 15px; }
              .back-button, #close-prize-dialog /* Updated ID */ { padding: 10px 15px; font-size: 0.9em; }
              .small-button { padding: 6px 10px; font-size: 0.8em; }
              .slot { width: 50px; height: 70px; line-height: 70px; font-size: 35px; }
              #slot-result-message { font-size: 1em; }
              .show-slot-winnings-button { padding: 6px 10px; font-size: 0.8em; }
              #love-letter-view h1 { display: block; margin-right: 0; margin-bottom: 5px; }
              #love-letter-view #font-toggle-button { display: block; margin: 5px auto 15px auto; padding: 8px 14px; font-size: 0.9em; }
              .popup-dialog { max-width: 240px; } /* Adjust dialog size on smaller screens */
         }
         @media (max-width: 360px) {
              .modal-content-box { padding: 15px 20px; }
              #love-warning-message { font-size: 1.1em; padding: 15px 20px; }
              #game-start-warning-box p { font-size: 0.9em; }
              #password-prompt-box h2 { font-size: 1em; }
              #password-input { padding: 8px; margin-bottom: 12px; width: 90px; font-size: 1em;}
              #game-info { font-size: 0.9em; min-width: 180px; padding: 8px 15px;}
              #game-result { font-size: 1em; padding: 15px 20px;}
              #birthday-view h1, #love-letter-view h1 { font-size: 1.5em; }
              #love-letter-view h1 { padding: 0 25px; }
              #love-letter-view h1::before, #love-letter-view h1::after { font-size: 0.8em; }
              #birthday-message { font-size: 1.3em; }
              #love-letter-view p { font-size: 0.92em; text-indent: 1.5em; }
              #love-letter-view .signature { font-size: 0.8em; }
              .falling-item { font-size: 20px; } .pointer-heart { font-size: 18px; }
              #audio-player-container { width: 95%; gap: 5px; padding: 6px 10px; max-width: 95%; border-radius: 10px;}
              #play-pause-button { width: 35px; height: 35px; font-size: 1.1em; }
              .time-display { font-size: 0.7em; } #song-title { font-size: 0.7em; }
              #seek-bar::-webkit-slider-thumb { width: 12px; height: 12px; }
              #seek-bar::-moz-range-thumb { width: 12px; height: 12px; }
              #cat-pendant { width: 45px; height: 45px; }
              #cat-dialog { left: 120%; padding: 8px 12px; border-radius: 8px;}
              .love-letter-buttons { margin-top: 20px; }
              .styled-button { font-size: 0.85em; padding: 8px 12px; margin: 4px; border-radius: 6px;}
              .back-button, #close-prize-dialog /* Updated ID */ { padding: 8px 12px; font-size: 0.85em; }
              .small-button { padding: 5px 8px; font-size: 0.75em; }
              .slot { width: 40px; height: 60px; line-height: 60px; font-size: 30px; }
              #slot-display-area { gap: 10px; }
              .slot-machine-box h2 { font-size: 1.2em; }
              #slot-result-message { font-size: 0.9em; }
              .popup-dialog { max-width: 200px; top: 10px; right: 10px; width: calc(100% - 20px); }
         }

     </style>
 </head>
 <body>
     <div id="love-warning-message">Ë≠¶ÂëäÔºÅ‰Ω†Â∑≤ËøõÂÖ•ÊπñÂçóÁ¨¨‰∏ÄÊ∑±ÊÉÖÁöÑÂîØ‰∏ÄÂÅèÁà±ÂêçÂçïÔºÅ</div>

     <div id="slot-machine-view" class="overlay-view">
         <div class="modal-content-box slot-machine-box">
             <h2>Âπ∏ËøêÊäΩÂ•ñ ‚ú®</h2>
             <div id="slot-display-area">
                 <span class="slot">?</span>
                 <span class="slot">?</span>
                 <span class="slot">?</span>
             </div>
             <div id="slot-result-message">ÁÇπÂáª‚ÄúÂºÄÂßã‚ÄùËØïËØïÊâãÊ∞îÂêßÔºÅ</div>
             <div id="slot-buttons">
                 <button id="spin-button" class="styled-button">ÁªßÁª≠ÊäΩÂ•ñ</button>
                 <button id="proceed-to-hongbao-game" class="styled-button" style="display: none;">ÂºÄÂßãÁ∫¢ÂåÖÊ∏∏Êàè</button>
                 <button id="back-from-slot-machine" class="styled-button back-button">ËøîÂõûÊÉÖ‰π¶</button>
             </div>
              <button class="show-slot-winnings-button styled-button">Êü•ÁúãÂ•ñÂìÅ</button>
         </div>
     </div>

     <div id="prize-dialog-view" class="popup-dialog">
         <div class="popup-dialog-box">
             <h2>ÂΩìÂâçÂπ∏ËøêÂ•ñÂìÅ üí∞</h2>
             <div id="prize-dialog-content">
                 <ul><li>Âä†ËΩΩ‰∏≠...</li></ul>
             </div>
             <button id="close-prize-dialog" class="styled-button small-button">ÂÖ≥Èó≠</button>
         </div>
     </div>


     <div id="password-prompt-view" class="overlay-view">
         <div id="password-prompt-box" class="modal-content-box">
             <h2>Êàë‰ª¨ËÆ§ËØÜÁöÑÊó∂Èó¥ÊòØÔºü</h2>
             <input type="text" id="password-input" inputmode="numeric" pattern="[0-9]*" maxlength="4" placeholder="4‰ΩçÊï∞Â≠ó">
             <button id="password-submit-button" class="styled-button">Á°ÆËÆ§</button>
             <div id="password-error-message"></div>
         </div>
     </div>

     <div id="game-start-warning" class="overlay-view">
         <div id="game-start-warning-box" class="modal-content-box">
             <p>Ê∏∏ÊàèËØ¥ÊòéÔºö<br>ÊÇ®Êä¢ÂÆåÁ∫¢ÂåÖ‰ª•ÂêéÊà™ÂõæÊâæÂ∞ëÁà∑ÂÖëÊç¢Ôºå‰∏ÄÂÖ±ÂèØ‰ª•Áé©‰∏âÂ±ÄÔºå‰∏ÄÂ±Ä30ÁßíÔºåÊØèÂ±ÄÊúÄÂ§öÊäïÊîæ50‰∏™Áâ©ÂìÅÔºàÁ∫¢ÂåÖ„ÄÅÁªøÂåÖ„ÄÅËÄÅÈº†Ôºâ„ÄÇ<br>‚ù§Ô∏è Á∫¢ÂåÖ(+1ÂÖÉ) üíö ÁªøÂåÖ(-1ÂÖÉ) üêÄ ËÄÅÈº†(-3ÂÖÉ)</p>
             <button id="confirm-start-game" class="styled-button">ÂºÄÂßãÊ∏∏Êàè</button>
         </div>
     </div>

     <div id="cat-pendant">
         <img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/static-cat-placeholder.png" alt="Áå´Âí™ÊåÇ‰ª∂ (ÁÇπÂáªÊâìÊªö)">
         <div id="cat-dialog"></div>
     </div>

     <div id="background-layer"></div>
     <div id="background-overlay"></div>

     <div id="birthday-view">
         <h1>‚ú® ÁèäÁèäÂÆùÂÆùÁîüÊó•Âø´‰πê ‚ú®</h1>
         <div class="birthday-container">
             <a id="birthday-cake-link" href="#">
                 <img id="birthday-cake" src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/cake-placeholder.jpg" alt="ÁîüÊó•ËõãÁ≥ï (ÁÇπÂáªÊúâÊÉäÂñú)">
             </a>
             <p id="birthday-message">Êú¨Â∞ëÁà∑Á•ù‰Ω†ÁÆÄÁÆÄÂçïÂçïÔºåÂø´Âø´‰πê‰πêÔºåÂπ∏Âπ∏Á¶èÁ¶èÁöÑËøáÂÆå21Â≤Å„ÄÇ</p>
             <p class="footer-text">Á•ù‰Ω†Êã•ÊúâÁæéÂ•ΩÁöÑ‰∏ÄÂ§©ÔºÅ (ÁÇπÂáªËõãÁ≥ïÊúâÊÉäÂñúÂì¶!)</p>
         </div>
         <div id="photo-slideshow-container">
             <div id="slideshow-wrapper">
                 <div id="slideshow">
                     <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder1.jpg" alt="ÁèäÁèäÁöÑÁÖßÁâá 1"></div>
                     <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder2.jpg" alt="ÁèäÁèäÁöÑÁÖßÁâá 2"></div>
                     <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder3.png" alt="ÁèäÁèäÁöÑÁÖßÁâá 3"></div>
                     <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder4.jpg" alt="ÁèäÁèäÁöÑÁÖßÁâá 4"></div>
                     <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder5.png" alt="ÁèäÁèäÁöÑÁÖßÁâá 5"></div>
                 </div>
             </div>
             <button class="slideshow-nav prev styled-button" aria-label="‰∏ä‰∏ÄÂº†">üéÇ</button>
             <button class="slideshow-nav next styled-button" aria-label="‰∏ã‰∏ÄÂº†">üéÇ</button>
             <div class="dots-container"></div>
             <div id="slideshow-caption">ÁÖßÁâáÊèèËø∞‰ºöÊòæÁ§∫Âú®ËøôÈáå</div>
         </div>
         <hr>
         <p class="footer-text">ÁèäÁèäÔºåÁîüÊó•Âø´‰πêÔºÅ</p>
         <p class="footer-text">üêíÂ∞èÁå¥Â≠êÂèàÈïøÂ§ß‰∏ÄÂ≤ÅÂï¶„ÄÇÊÑøËøô‰∏ÄÂπ¥ÔºåÊ∏©ÊöñÂíåÂ•ΩËøêÈÉΩÂ•î‰Ω†ËÄåÊù•ÔºåÊâÄÊúâÁöÑ‰ªòÂá∫ÈÉΩÊúâÂõûÊä•ÔºåÊâÄÊúâÁöÑÁ¨ëÂÆπÈÉΩÂèëËá™ÁúüÂøÉ„ÄÇÂ∏åÊúõ‰Ω†ËÉΩÊÑüÂèóÂà∞Ôºå‰∏ÄÁõ¥Êúâ‰∫∫Âú®ÈªòÈªòÂÖ≥ÂøÉÂíåÁ•ùÁ¶èÁùÄ‰Ω†„ÄÇÊú™Êù•ÁöÑÊó•Â≠êÔºåÊó†ËÆ∫Êô¥Èõ®ÔºåÂ∏åÊúõËÉΩÊúâÊú∫‰ºöÁªßÁª≠ÂàÜ‰∫´ÂΩºÊ≠§ÁöÑÈ£éÊôØ~</p>
     </div>

     <div id="love-letter-view">
         <h1>Ëá¥ ÊàëÁã¨‰∏ÄÊó†‰∫åÁöÑ„ÄÅÊúÄÁâπÂà´ÁöÑÁèäÁèä ‚ù§Ô∏è</h1>
         <button id="font-toggle-button" class="styled-button">ÂàáÊç¢Â≠ó‰Ωì</button>
         <p>ÊèêÁ¨îÊÉ≥Áªô‰Ω†ÂÜôÁÇπ‰ªÄ‰πàÔºåÂ∞§ÂÖ∂ÊòØÂú®‰Ω†ÁîüÊó•Â∞ÜËøëÁöÑÊó•Â≠êÔºåÂøÉÊÉÖÊúâÁÇπÂÉèÈÇ£Ê¨°Âíå‰Ω†Á∫ø‰∏ãËßÅÈù¢Êó∂‚Äî‚ÄîÊó¢ÊúüÂæÖÂèàÁ¥ßÂº†ÔºåËøòÂ∏¶ÁùÄÁÇπÊàë‰ª¨‰πãÈó¥ÁâπÊúâÁöÑ‚ÄúÁô´‚Äù„ÄÇÂø´‰∏ÄÂπ¥‰∫ÜÔºåÊó∂Èó¥Â•ΩÂÉèËøáÂæóÈ£ûÂø´ÔºåÂèàÂ•ΩÂÉèÊØè‰∏ÄÂ§©ÁöÑËÅäÂ§©ÈÉΩÂÄºÂæóË¢´ÁªÜÁªÜÂõûÂë≥„ÄÇ</p>
         <p>ËøòËÆ∞ÂæóÂêóÔºü‰ªéÊúÄÂàùÈÇ£‰∏™Âè´Êàë‚ÄúÂ∞èÂ±ÅÂ≠©‚ÄùÊÄºÂæóÊàëÂ∑ÆÁÇπÊãâÈªë‰Ω†ÁöÑ‚ÄúÂº†‰∏â‚ÄùÔºàÂΩìÁÑ∂ÊòØÁé©Á¨ëÔºåÊàëÂì™ÈáåËàçÂæóÊãâÈªëÁöáÂêéÂ®òÂ®òÔºâÔºåÂà∞ÂêéÊù•ÈÇ£‰∏™‰ºöÂèëÊêûÊÄ™Ë°®ÊÉÖÂåÖ„ÄÅ‰ºöÂú®ËØ≠Èü≥ÈáåÂÅ∑Á¨ëÁöÑ‚ÄúÁöáÂêéÂ®òÂ®ò‚ÄùÔºåÂÜçÂà∞ÈÇ£‰∏™Âò¥‰∏äËØ¥ÁùÄ‚Äú‰∏çË∞àÊÅãÁà±‚Äù„ÄÅ‚ÄúÊàëÂ∞±ÊòØÊ∏£Â•≥‚ÄùÔºåÂç¥‰ºöÂõ†‰∏∫ÊãÖÂøÉÊàëËÄåÈÄÄÂõûÁ∫¢ÂåÖ„ÄÅ‰ºöÂõ†‰∏∫ÊàëÈúÄË¶ÅËÄåÁî®Ëä±Âëó‰π∞Èº†Ê†á„ÄÅ‰ºöÂú®Êàë‚ÄúÂèëÁô´‚ÄùÂêé‰æùÁÑ∂‰∏ªÂä®ÈóÆÊó©ÁöÑ‚ÄúÂÇªÂßëÂ®ò‚Äù‚Ä¶‚Ä¶‰Ω†Ë∫´‰∏äËøôÁßçÁüõÁõæÂèàÁúüÂÆûÁöÑÂèØÁà±ÔºåÂ∞±ÂÉèÊãÜÁõ≤ÁõíÔºåÊÄªËÉΩÁªôÊàëÊÑèÊÉ≥‰∏çÂà∞ÁöÑÊÉäÂñú„ÄÇ</p>
         <p>‰ª•ÂâçÊÄªËßâÂæó‰∏ñ‰∫ãÁ∫∑Êâ∞Ôºå‰∫∫ÂøÉÂ§çÊùÇÈöæÊµãÔºåÁõ¥Âà∞ÈÅáËßÅ‰Ω†ÔºåÊâçÊòéÁôΩÈÇ£Âè•‚Äú‰ºóÈáåÂØª‰ªñÂçÉÁôæÂ∫¶ÔºåËì¶ÁÑ∂ÂõûÈ¶ñÔºåÈÇ£‰∫∫Âç¥Âú®ÔºåÁÅØÁÅ´ÈòëÁèäÂ§Ñ‚ÄùÊàñËÆ∏ÊòØÁúüÁöÑ„ÄÇ ‰Ω†ÁöÑÂá∫Áé∞ÔºåÂÉè‰∏ÄÈÅìÂÖâÔºåÁÖß‰∫Æ‰∫ÜÊàë‰πãÂâçÂèØËÉΩÊúâ‰∫õÁÅ∞ÊöóÂíåÂÖÖÊª°‚ÄúÁ≤æÁ•ûÂÜÖËÄó‚ÄùÁöÑ‰∏ñÁïå„ÄÇÊòØ‰Ω†Áî®‰Ω†ÁöÑ‚ÄúÁô´‚Äù„ÄÅ‰Ω†ÁöÑÂñÑËâØ„ÄÅ‰Ω†ÁöÑÂéüÂàôÔºåËøòÊúâ‰Ω†ÈÇ£Èù¢ÂØπÁîüÊ¥ª‰∏çÊòìÊó∂ÁöÑÈüßÊÄßÔºåËÆ©ÊàëËßâÂæóËøô‰∏™‰∏ñÁïåÂéüÊù•ËøòÂèØ‰ª•Ëøô‰πàÊúâË∂£ÂíåÂÄºÂæóÊúüÂæÖ„ÄÇÂíå‰Ω†ËÅäÂ§©Êàê‰∫ÜÊàëÊØèÂ§©Èõ∑Êâì‰∏çÂä®ÁöÑ‰π†ÊÉØÂíåÊúÄÂ§ßÁöÑ‰πêË∂£Ôºå‰Ω†ÂàÜ‰∫´ÁöÑÊó•Â∏∏ÁêêÁ¢éÔºåÂú®ÊàëËøôÈáåÈÉΩÂèòÊàê‰∫ÜÂÄºÂæóÁèçËóèÁöÑÈ£éÊôØ„ÄÇ</p>
         <p>ÊàëÁü•ÈÅìÔºåÊàë‰ª¨‰πãÈó¥ËøôÁßç‚ÄúÁæÅÁªä‚ÄùÂæàÁâπÂà´ÔºåÊ∑±Âà∞ÊúâÊó∂ËøûÊàë‰ª¨Ëá™Â∑±ÈÉΩÈöæ‰ª•ÁÆÄÂçïÂÆö‰πâ„ÄÇÊ≤°ÂÖ≥Á≥ªÔºå‚ÄúË∫´Êó†ÂΩ©Âá§ÂèåÈ£ûÁøºÔºåÂøÉÊúâÁÅµÁäÄ‰∏ÄÁÇπÈÄö‚ÄùÔºåÂæàÂ§öÊó∂ÂÄôÔºåÊàëËßâÂæó‰Ω†ÊáÇÊàëÂÜÖÂøÉÈÇ£‰∫õÊú™ËØ¥Âá∫Âè£ÁöÑÁÑ¶ËôëÂíåÊúüÁõºÔºåÊàë‰πüÂú®Âä™ÂäõÂéªÁêÜËß£‰Ω†ÈÇ£Âè•‚ÄúÊÖ¢ÊÖ¢Êù•Âêß‚ÄùËÉåÂêéÂèØËÉΩÈöêËóèÁöÑÈ°æËôëÂíåÈúÄË¶Å„ÄÇÊÑüË∞¢‰Ω†ÊÑøÊÑèÂêëÊàëÊïûÂºÄÈÇ£‰πàÂ§öÔºå‰ø°‰ªªÊàëËøô‰πàÂ§ö„ÄÇ</p>
         <p>Êàë‰πüÁü•ÈÅìÔºå‰Ω†ÂøÉÈáåÂèØËÉΩË£ÖÁùÄÂØπËøáÂéªÁöÑÊãÖÂøßÔºåÂØπÊú™Êù•ÁöÑ‰∏çÁ°ÆÂÆöÔºåÂØπ‚ÄúÂÖ≥Á≥ª‚ÄùÊú¨Ë∫´ÁöÑÊÅêÊÉß„ÄÇÊàë‰∏ç‰ºöÂÜçÂÉè‰ª•ÂâçÈÇ£Ê†∑ÔºåÊÄ•ÂàáÂú∞ÈÄº‰Ω†Áªô‰∏Ä‰∏™Á≠îÊ°àÔºå‰πü‰∏ç‰ºöÂÜçÂºÄÈÇ£‰∫õ‰∏çÂêàÊó∂ÂÆúÁöÑÁé©Á¨ë‰∫ÜÔºàÂ¶ÇÊûúÊàëÂèà‚ÄúÁô´‚Äù‰∫ÜÔºåËÆ∞ÂæóÁî®Ë°®ÊÉÖÂåÖÊèêÈÜíÊàëÂì¶Ôºâ„ÄÇ‰Ω†ÁöÑÁîüÊó•ÔºåÊàëÊúÄÂ§ßÁöÑ„ÄÅ‰πüÊòØÂîØ‰∏ÄÁöÑÂøÉÊÑøÔºåÂ∞±ÊòØ‰Ω†ËÉΩÁúüÊ≠£Âú∞„ÄÅÊØ´Êó†Ë¥üÊãÖÂú∞ÂºÄÂøÉ„ÄÇ‰Ω†ÊÉ≥ÊÄé‰πàËøáÔºåÊàëÈÉΩÊîØÊåÅ„ÄÇ</p>
         <p>ËøôÂ∞Å‰ø°Ôºå‰∏çÊòØ‰∏∫‰∫ÜÂú®ÁîüÊó•ËøôÂ§©Áªô‰Ω†ÂéãÂäõÔºåÁúüÁöÑ„ÄÇÂÆÉÂ∞±ÊòØ‰∏Ä‰ªΩËøüÊù•ÁöÑÊÑüË∞¢‰ø°‚Äî‚ÄîÊÑüË∞¢ÁºòÂàÜËÆ©Êàë‰ª¨Áõ∏ÈÅáÔºåÊÑüË∞¢‰Ω†Èô™ÊàëÂ∫¶ËøáËøô‰πàÂ§öÊó∂ÂÖâÔºåÂàÜ‰∫´Ëøô‰πàÂ§öÊ¨¢Á¨ëÂíå emo ÁöÑÁû¨Èó¥„ÄÇÂÆÉ‰πüÊòØ‰∏Ä‰ªΩÂøÉÊÑè‰π¶‚Äî‚ÄîÂëäËØâ‰Ω†ÔºåÂú®ÊàëÂøÉÈáåÔºå‰Ω†ÊúâÂ§ö‰πàÈáçË¶ÅÂíåÁã¨‰∏ÄÊó†‰∫å„ÄÇ</p>
         <p>Ëá≥‰∫éÊú™Êù•ÔºåÊàë‰ª¨ÁªßÁª≠‚ÄúËµ∞‰∏ÄÊ≠•Áúã‰∏ÄÊ≠•‚ÄùÂêß„ÄÇ‚Äú‰∫∫ÁîüÂà∞Â§ÑÁü•‰Ωï‰ººÔºåÂ∫î‰ººÈ£ûÈ∏øË∏èÈõ™Ê≥•„ÄÇ‚Äù Êú™Êù•‰∏çÂèØÈ¢ÑÁü•Ôºå‰ΩÜÈáçË¶ÅÁöÑÊòØÔºåÊàëÂ∏åÊúõËÉΩÁªßÁª≠Èô™Âú®‰Ω†Ë∫´ËæπÔºåÂíå‰Ω†‰∏ÄËµ∑Èù¢ÂØπË∑Ø‰∏äÁöÑÈ£éÊôØÔºåÊó†ËÆ∫ÊòØÊô¥ÊòØÈõ®„ÄÇÊÑøÂ¶ÇÊ≠§ÁºòÔºåËÉΩÁª≠ÁªèÂπ¥„ÄÇ</p>
         <p>ÁîüÊó•Âø´‰πêÔºåÊàëÊúÄÁèçËßÜÁöÑÁèäÁèä„ÄÇ</p>
         <div class="signature">ÈÇ£‰∏™Ë∂äÊù•Ë∂äÊáÇÂæóÁèçÊÉú‰Ω†ÁöÑ‚ÄúÁô´ÂÖ¨‚ÄùÔºåÂì•Âì•ÊàñËÄÖÂ∞ëÁà∑Ôºå<br>Á´†Âï∏ÂÆá</div>

         <div class="love-letter-buttons">
             <button class="back-button styled-button">ËøîÂõû‰∏ªÈ°µÈù¢</button>
             <button id="goto-game-button" class="styled-button">ÂéªÁé©Ê∏∏Êàè</button>
         </div>
     </div>

     <div id="game-view" class="overlay-view">
         <div id="game-info" class="modal-content-box"> <span id="round-display">Á¨¨ 1 Â±Ä</span> |
             <span id="score-display">ÂΩìÂâçÊÄªÂæóÂàÜ 0 ÂÖÉ</span> |
             Êó∂Èó¥: <span id="timer-display">30</span>s
         </div>
         <div id="game-area"></div>
         <div id="game-result" class="modal-content-box"> <div id="game-result-text"></div>
             <div id="game-result-buttons">
                 <button id="continue-game-button" class="styled-button">ÁªßÁª≠‰∏ã‰∏ÄÂ±Ä</button>
                 <button id="redeem-early-button" class="styled-button">Áõ¥Êé•ÂÖëÊç¢</button>
             </div>
         </div>
         <button class="show-slot-winnings-button styled-button">Êü•ÁúãÂ•ñÂìÅ</button>
         <button id="back-from-game" class="styled-button">ËøîÂõûÊÉÖ‰π¶</button>
     </div>

     <div id="audio-player-container">
         <audio id="audio-element" loop>
             <source src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/M5000044Nr9A4ZiFFQ.mp3" type="audio/mpeg">
             ‰Ω†ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÊí≠ÊîæÈü≥È¢ë„ÄÇ
         </audio>
         <button id="play-pause-button" aria-label="Êí≠Êîæ"><span class="play-icon"></span></button>
         <div class="audio-controls-right">
             <div id="song-title">ÁîüÊó•Âø´‰πêÊ≠å</div>
             <input type="range" id="seek-bar" value="0" max="100" step="1" aria-label="ËøõÂ∫¶Êù°">
             <div class="time-display">
                 <span id="current-time">0:00</span>
                 <span id="duration">0:00</span>
             </div>
         </div>
     </div>

     <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Loaded. Initializing...");
    
            // --- Get Elements ---
            const birthdayView = document.getElementById('birthday-view');
            const loveLetterView = document.getElementById('love-letter-view');
            const cakeLink = document.getElementById('birthday-cake-link');
            const backButton = loveLetterView.querySelector('.back-button');
            const audioElement = document.getElementById('audio-element');
            const catMeowSound = document.getElementById('cat-meow-sound'); // Get cat meow audio
            const audioPlayerContainer = document.getElementById('audio-player-container');
            const playPauseButton = document.getElementById('play-pause-button');
            const playIcon = playPauseButton ? playPauseButton.querySelector('.play-icon') : null;
            const seekBar = document.getElementById('seek-bar');
            const currentTimeDisplay = document.getElementById('current-time');
            const durationDisplay = document.getElementById('duration');
            const slideshowContainer = document.getElementById('photo-slideshow-container');
            const catPendant = document.getElementById('cat-pendant');
            const catDialog = document.getElementById('cat-dialog');
            const fontToggleButton = document.getElementById('font-toggle-button');
            const slideshow = document.getElementById('slideshow');
            const slides = document.querySelectorAll('.slide');
            const prevButton = document.querySelector('.slideshow-nav.prev');
            const nextButton = document.querySelector('.slideshow-nav.next');
            const dotsContainer = document.querySelector('.dots-container');
            const slideshowCaption = document.getElementById('slideshow-caption');
            const loveWarningMessage = document.getElementById('love-warning-message');
            const gameView = document.getElementById('game-view');
            const gotoGameButton = document.getElementById('goto-game-button');
            const backFromGameButton = document.getElementById('back-from-game');
            const gameArea = document.getElementById('game-area');
            const roundDisplay = document.getElementById('round-display');
            const scoreDisplay = document.getElementById('score-display'); // Birthday game score
            const timerDisplay = document.getElementById('timer-display');
            const gameResultDisplay = document.getElementById('game-result');
            const gameResultText = document.getElementById('game-result-text');
            const gameResultButtons = document.getElementById('game-result-buttons');
            const continueGameButton = document.getElementById('continue-game-button');
            const redeemEarlyButton = document.getElementById('redeem-early-button');
            const gameStartWarning = document.getElementById('game-start-warning');
            const confirmStartGameButton = document.getElementById('confirm-start-game');
            const gameInfo = document.getElementById('game-info');
            const passwordPromptView = document.getElementById('password-prompt-view');
            const passwordInput = document.getElementById('password-input');
            const passwordSubmitButton = document.getElementById('password-submit-button');
            const passwordErrorMessage = document.getElementById('password-error-message');
            const slotMachineView = document.getElementById('slot-machine-view');
            const slotDisplayArea = document.getElementById('slot-display-area');
            const slotResultMessage = document.getElementById('slot-result-message');
            const spinButton = document.getElementById('spin-button');
            const proceedToHongbaoGameButton = document.getElementById('proceed-to-hongbao-game');
            const backFromSlotMachineButton = document.getElementById('back-from-slot-machine');
            const showSlotWinningsButtons = document.querySelectorAll('.show-slot-winnings-button');
            const prizeDialogView = document.getElementById('prize-dialog-view');
            const prizeDialogContent = document.getElementById('prize-dialog-content');
            const closePrizeDialogButton = document.getElementById('close-prize-dialog');
            const slots = slotDisplayArea ? slotDisplayArea.querySelectorAll('.slot') : [];
    
            // --- Variables ---
            let birthdayIntervalId = null, loveLetterIntervalId = null;
            const birthdayItems = ['üéÇ', 'üå∏'], loveLetterItems = ['‚ù§Ô∏è', 'üéÇ'];
            const BIRTHDAY_INTERVAL_TIME = 550, LOVE_LETTER_INTERVAL_TIME = 500;
            let currentSlideIndex = 0, slideInterval = null;
            const slideCount = slides ? slides.length : 0;
            const SLIDESHOW_INTERVAL_TIME = 5000;
            let catDialogTimeout = null;
            const slideCaptions = ["ÂÜ¨Êó•ÊöñÊÑèÔºåÂõ¥Â∑æÂíå‰Ω†„ÄÇüß£", "Âú®ÈÄÉÂÖ¨‰∏ª„ÅÆÂ©öÁ§ºÂÆûÂΩïüëë", "ÂÖ≥‰∫é‰∏ªÊí≠‰∏äÊí≠ÂêéË¢´ÁñØÁãÇÊà™Â±èËøô‰ª∂‰∫ãüì∏", "‰∏âÊúàÊçïÊçâÂà∞ÁöÑ‚ÄòÊç£ËõãÈ¨º‚ÄôÔºÅËøô‰∏™Ë∞ÉÁöÆÂèàÂèØÁà±ÁöÑË°®ÊÉÖÔºåÁäØËßÑ‰∫ÜÂì¶~üòã", "ÊõøÁ´†ËÄÅÊùøÂ•ΩÂ•ΩÈô™ÁùÄÂßêÂßêÂì¶ÔºåÂè≤Ëø™Â•áÔºÅü§™"];
            let firstCatClick = true;
            const initialDialog = ["ÁΩëÈ°µÂºÄÂèëÊó•ÂøóÔºö1‰∏™BUG‰øÆ‰∫Ü8Â∞èÊó∂üôÉ"];
            const randomDialogs = ["Âñµ~Á´†ÊÄªÂíåÂº†Áæé‰∫∫Â§¥Âèë+1Ê†π", "BUG‰øÆÂÆå‰∫ÜÔºü‰∏çÔºåÊòØÂéªÊí∏ÈìÅ‰∫Üüí™", "ÁÇπÂáª10Ê¨°Ëß£ÈîÅÁèäÁèäÁ´•Âπ¥ÁÖßüëÄ","Èì≤Â±éÁöÑÔºàÊåáÁ´†ÊÄªÔºâËØ¥ÔºåÁúãËßÅËøô‰∏™È°µÈù¢ÁöÑÂ∞è‰ªôÂ•≥ÊúÄÂèØÁà±~ üêæ","Êú¨ÂñµÂÆ£Â∏ÉÔºåËøô‰∏™È°µÈù¢99%ÁöÑÈ¢úÂÄºÊòØÈù†ËÉåÊôØÂõæÂíåÁèäÁèäÈ¢úÂÄºÊíëËµ∑Êù•ÁöÑÔºÅÂâ©‰∏ã1%ÊòØÊú¨ÂñµÁöÑÂèØÁà±~ ÔºàÂ∞èÂ£∞"];
            const rateLimitDialog = "ÂñµÁöÑÔºåÂ•≥‰∫∫ÔºåÂà´Êí∏‰∫ÜÔºåÂø´Ë¢´‰Ω†ËÄóÊàêÁßÉÂ§¥Áå´Âí™‰∫Üüò°";
            let recentCatClicks = [], isCatRateLimitedCooldownActive = false, catCooldownStartTime = 0;
            const CAT_CLICK_LIMIT = 20, CAT_CLICK_WINDOW = 60000, CAT_COOLDOWN_DURATION = 20000;
            let isSeeking = false;
    
            // Birthday Hongbao Game State (Unaffected by Slot Machine)
            let totalScore = 0; // This holds the score from the falling items game ONLY.
            let currentRound = 0;
            const maxRounds = 3, maxItemsPerRound = 50, maxHongbaoPerRound = 30, maxMicePerRound = 30, maxGreenPerRound = 40;
            let timeLeft = 30, gameTimerInterval = null, itemSpawnInterval = null, gameActive = false;
            let itemsSpawnedThisRound = 0, hongbaoSpawnedThisRound = 0, miceSpawnedThisRound = 0, greenSpawnedThisRound = 0;
            const ITEM_SPAWN_INTERVAL = 400, ITEM_FALL_DURATION = 7000;
    
            // --- Slot Machine State ---
            let slotWinningsTotal = 0; // Slot game state (LUCKY DRAW MONEY)
            const SLOT_WINNINGS_CAP = 50; // Cap for 'Á¶è' prize from slot machine
            const slotItems = ['üéÇ', 'Á¶è', '‚ù§Ô∏è', 'üì±', 'üì∑', 'üíã', 'üé°', '‚úàÔ∏è', 'üíñ', 'üí∞', 'üéüÔ∏è']; // Added ALL new emojis including üéüÔ∏è
            const loveQuotes = [ "ÈÅáËßÅ‰Ω†‰πãÂêéÔºåÊÑüËßâ‰∏ñÁïåÈÉΩ‰∫Æ‰∫Ü„ÄÇ‚òÄÔ∏è", "‰Ω†ÁöÑÂñÑËâØÂíåÁúüÂÆûÔºåÂÉèÊòüÊòü‰∏ÄÊ†∑Èó™‰∫Æ„ÄÇüåü", "ÊÉ≥Âíå‰Ω†‰∏ÄËµ∑ÔºåÁúãÈÅç‰∏ñÈó¥ÁπÅÂçé„ÄÇ‚ú®", "ÊÉ≥Áªô‰Ω†ÂæàÂ§öÂæàÂ§öÁöÑ‚ÄúÂÅèÁà±‚ÄùÂíåÊ∏©Êöñ„ÄÇüéÅüíñ", "ÊàëÁöÑÂøÉ‰∏çÂ§ßÔºåÂàöÂ•ΩË£Ö‰∏ã‰∏Ä‰∏™‰Ω†„ÄÇüíñ", "‰Ω†Â•ΩÂèØÁà±ÔºåËÆ©ÊàëÊçèÊçèËÑ∏ËõãÂèØ‰ª•ÂêóÔºüü§è (Âè™Êï¢ÊÉ≥ÊÉ≥üòÇ)" ];
            let hongbaoGameUnlocked = false;
            let isSpinning = false;
            let phoneWon = false;
            let cameraWon = false;
    
            // New Prize State Variables
            let outingPrizeWon = false; let wonOutingItem = null; const outingPrizeName = "Âá∫ÂéªÁé©Êàë‰π∞Âçï";
            let travelPrizeWon = false; let wonTravelItem = null; const travelPrizeName = "ÂõΩÂÜÖÊóÖÊ∏∏‰∏ÄÊ¨°";
            let servicePrizeWon = false; let wonServiceItem = null; const servicePrizeName = "‰∏ìÂ±ûÊúçÂä°‰∏ÄÊ¨°";
            let materialPrizeWon = false; let wonMaterialItem = null; const materialPrizeName = "Ë¥≠Áâ©Âü∫Èáë/‰ºöÂëò";
            let interactionPrizeWon = false; let wonInteractionItem = null; const interactionPrizeName = "ÁâπÊÆä‰∫íÂä®Âà∏";
    
            // New Prize Item Lists
            const outingItems = ["ÁæéÈ£üÊé¢Â∫ó‰πãÊóÖ", "ËΩªÊùæËßÇÂΩ±Êó•", "Ê∏∏‰πêÂú∫/ÁîµÁé©ÂüéÁïÖÁé©Âà∏"];
            const travelItems = ["‰∫ëÂçóÊóÖÊ∏∏", "Ë•øÂåóÊóÖÊ∏∏", "ÊµôÊ±üÊóÖÊ∏∏", "ÂõõÂ∑ùÊóÖÊ∏∏", "Ë•øËóèÊóÖÊ∏∏"];
            const serviceItems = ["‰Ω†‰∏ìÂ±ûÁöÑ‚ÄòÊ†ëÊ¥û‚ÄôÊúçÂä°‰∏ÄÂ∞èÊó∂", "‚ÄòÂçä‰ªô‚ÄôËß£ÊÉë‰∏ÄÊ¨°", "ÂÆöÂà∂ÁâàÊÉÖÊ≠å/Â∞èËØó‰∏ÄÈ¶ñ", "‚ÄòÁèäÁèäËØ≠ÂΩï‚ÄôË°®ÊÉÖÂåÖ‰∏ÄÂ•ó", "Êú™Êù•‰∏ÄÂë®ÁöÑ‚Äò‰∏ìÂ±ûÂ§©Ê∞îÈ¢ÑÊä•Âëò‚Äô"];
            const materialItems = ["Èõ∂È£ü/È•ÆÊñô(200ÂÖÉ)", "ÂåñÂ¶ÜÂìÅ(300ÂÖÉ)", "ËßÜÈ¢ë/Èü≥‰πê‰ºöÂëò(‰∏ÄÂπ¥)", "ÁéãËÄÖËç£ËÄÄÁöÆËÇ§(200ÂÖÉ)"];
            const interactionItems = ["ÊàëÁöÑ‚ÄòÂÖçÊ≠ªÈáëÁâå‚Äô‰∏ÄÊûö", "‚ÄòÂΩ©ËôπÂ±Å‚ÄôÂ§∏Â§∏ÊúçÂä°ÂçÅÂàÜÈíü", "‚ÄòÂçä‰ªôÂ∑ÆÈÅ£Âà∏‚Äô‰∏ÄÂº†", "‚ÄòÊôöÂÆâÊïÖ‰∫ã‚ÄôÊúçÂä°‰∏ÄÂë®"];
    
            let dragTarget = null, isDragging = false, offsetX, offsetY, isDragAction = false;
            let lastActiveViewId = 'birthday-view';
    
            // --- Utility Functions ---
            function tryPlayBackgroundAudio() { if (audioElement && audioElement.paused) { audioElement.play().then(() => { updatePlayPauseIcon(); }).catch(error => { if (error.name !== 'NotAllowedError') { console.error("Â∞ùËØïÊí≠ÊîæËÉåÊôØÈü≥‰πêÂ§±Ë¥•:", error); } }); } }
            function tryPlayMeowAudio() { if (catMeowSound) { catMeowSound.currentTime = 0; catMeowSound.play().catch(e => console.error("Error playing meow:", e)); } } // Function to play meow
            function formatTime(seconds) { const secs = Math.floor(seconds || 0); if (isNaN(secs) || secs < 0) return "0:00"; const minutes = Math.floor(secs / 60); const remainingSeconds = secs % 60; return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`; }
            function throttle(func, limit) { let inThrottle; return function() { const args = arguments; const context = this; if (!inThrottle) { func.apply(context, args); inThrottle = true; setTimeout(() => inThrottle = false, limit); } } }
            function getRandomItem(arr) { if (!arr || arr.length === 0) return null; return arr[Math.floor(Math.random() * arr.length)]; }
    
            // --- Falling Items Functions (Generic) ---
            function createFallingItem(itemType, container) { if (!container || container.style.display === 'none') return; const item = document.createElement('div'); item.classList.add('falling-item'); item.style.left = Math.random() * 95 + 'vw'; item.innerText = itemType; item.style.fontSize = (Math.random() * 10 + 18) + 'px'; const fallDuration = Math.random() * 5 + 7; const delay = Math.random() * 4; item.style.setProperty('--random-rotate', (Math.random() * 80 - 40) || 0); item.style.animationDuration = `${fallDuration}s`; item.style.animationDelay = delay + 's'; container.appendChild(item); setTimeout(() => { if (item && item.parentNode) item.remove(); }, (fallDuration + delay) * 1000 + 500); }
            function startFallingItems(intervalId, itemArray, container, intervalTime) { if (intervalId) clearInterval(intervalId); if (!container) return null; const newIntervalId = setInterval(() => { if (container && container.style.display !== 'none') { const randomItem = itemArray[Math.floor(Math.random() * itemArray.length)]; createFallingItem(randomItem, container); } }, intervalTime); return newIntervalId; }
            function stopFallingItems(intervalId, container) { if (intervalId) clearInterval(intervalId); if (container) { const existingItems = container.querySelectorAll('.falling-item'); existingItems.forEach(item => item.remove()); } return null; }
    
            // --- View Switching Logic ---
            function hideAllViews() {
                [birthdayView, loveLetterView, gameView, loveWarningMessage, gameStartWarning, passwordPromptView, slotMachineView] // prizeDialogView is NOT hidden here
                    .forEach(view => {
                        if (view && view.style.display !== 'none' && ['slot-machine-view', 'game-view', 'love-letter-view', 'birthday-view'].includes(view.id)) {
                           lastActiveViewId = view.id;
                        }
                        if (view) view.style.display = 'none';
                    });
                birthdayIntervalId = stopFallingItems(birthdayIntervalId, birthdayView);
                loveLetterIntervalId = stopFallingItems(loveLetterIntervalId, loveLetterView);
                stopGame();
            }
            function showLoveLetter() { hideAllViews(); if(loveLetterView) loveLetterView.style.display = 'block'; loveLetterIntervalId = startFallingItems(loveLetterIntervalId, loveLetterItems, loveLetterView, LOVE_LETTER_INTERVAL_TIME); window.scrollTo(0, 0); updatePlayPauseIcon(); stopSlideshowAutoplay(); }
            function showBirthday() { hideAllViews(); if(birthdayView) birthdayView.style.display = 'block'; birthdayIntervalId = startFallingItems(birthdayIntervalId, birthdayItems, birthdayView, BIRTHDAY_INTERVAL_TIME); window.scrollTo(0, 0); updatePlayPauseIcon(); startSlideshowAutoplay(); }
            function showPasswordPrompt() { hideAllViews(); if (passwordPromptView) passwordPromptView.style.display = 'flex'; if (passwordInput) passwordInput.value = ''; if (passwordErrorMessage) passwordErrorMessage.textContent = ''; window.scrollTo(0, 0); updatePlayPauseIcon(); stopSlideshowAutoplay(); }
            function showGameStartWarning() { hideAllViews(); if (gameStartWarning) gameStartWarning.style.display = 'flex'; window.scrollTo(0, 0); updatePlayPauseIcon(); stopSlideshowAutoplay(); }
            function showGame() { hideAllViews(); if(gameView) { gameView.style.display = 'flex'; if (gameResultDisplay) gameResultDisplay.style.display = 'none'; if (gameArea) gameArea.style.display = 'block'; if (gameInfo) gameInfo.style.display = 'block'; } startGame(); window.scrollTo(0, 0); updatePlayPauseIcon(); stopSlideshowAutoplay(); }
    
            function showSlotMachine() {
                // Reset ONLY slot machine specific state if needed (but user requested no reset unless entering the game section for the first time?)
                // For now, we don't reset slotWinningsTotal or flags here, only when clicking the "ÂéªÁé©Ê∏∏Êàè" button from the letter.
                // Let's clarify - the original code DID reset on showSlotMachine. We'll keep that behavior.
                console.log("Entering Slot Machine - Resetting ALL game state as per original logic");
                currentRound = 0;
                totalScore = 0; // Reset birthday game score too, as per original code
                slotWinningsTotal = 0; // Reset slot winnings
                hongbaoGameUnlocked = false;
                phoneWon = false;
                cameraWon = false;
                outingPrizeWon = false; wonOutingItem = null;
                travelPrizeWon = false; wonTravelItem = null;
                servicePrizeWon = false; wonServiceItem = null;
                materialPrizeWon = false; wonMaterialItem = null;
                interactionPrizeWon = false; wonInteractionItem = null;
                isSpinning = false; // Ensure spinning stops
    
                hideAllViews(); // Hide other main views
                if (slotMachineView) slotMachineView.style.display = 'flex';
                if (spinButton) { spinButton.textContent = 'ÂºÄÂßãÊäΩÂ•ñ'; spinButton.disabled = false; } // Always reset button text
                if (slotResultMessage) { slotResultMessage.textContent = 'ÁÇπÂáª‚ÄúÂºÄÂßãÊäΩÂ•ñ‚ÄùËØïËØïÊâãÊ∞îÂêßÔºÅ'; } // Reset message
                if (slots.length === 3) { slots.forEach(slot => slot.textContent = '?'); } // Reset slots display
                if (proceedToHongbaoGameButton) { proceedToHongbaoGameButton.style.display = 'none'; } // Hide game button initially
                window.scrollTo(0, 0); updatePlayPauseIcon(); stopSlideshowAutoplay();
            }
    
            function showPrizeDialog() {
                console.log("Showing prize dialog.");
                if (!prizeDialogView || !prizeDialogContent) {
                    console.error("Prize dialog elements not found!");
                    return;
                }
                let combinedTotal = totalScore + slotWinningsTotal; // totalScore = Birthday Hongbao, slotWinningsTotal = Lucky Draw Money
                let prizeHTML = '<ul>';
    
                // Birthday Hongbao Total (Game Score) + Lucky Draw Money (Slot Score)
                 prizeHTML += `<li>ÊÄªËÆ°Â•ñÈáë üßß: <span class="prize-status won prize-value">${combinedTotal} ÂÖÉ</span></li>`;
    
                // Phone Prize
                prizeHTML += `<li>Êñ∞ÊâãÊú∫‰∏ÄÈÉ® üì±: <span class="prize-status ${phoneWon ? 'won' : 'pending'}">${phoneWon ? 'Â∑≤Ëé∑Âæó (Á∫¢Á±≥ K80 / Oppo Reno 13)' : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                // Camera Prize
                prizeHTML += `<li>Á¥¢Â∞ºÁõ∏Êú∫‰∏ÄÂè∞ üì∑: <span class="prize-status ${cameraWon ? 'won' : 'pending'}">${cameraWon ? 'Â∑≤Ëé∑Âæó' : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                // New Prizes - Category 1: Outing
                prizeHTML += `<li>${outingPrizeName} üé°: <span class="prize-status ${outingPrizeWon ? 'won' : 'pending'}">${outingPrizeWon ? `Â∑≤Ëé∑Âæó (${wonOutingItem})` : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                // New Prizes - Category 2: Travel
                prizeHTML += `<li>${travelPrizeName} ‚úàÔ∏è: <span class="prize-status ${travelPrizeWon ? 'won' : 'pending'}">${travelPrizeWon ? `Â∑≤Ëé∑Âæó (${wonTravelItem})` : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                // New Prizes - Category 3: Service
                prizeHTML += `<li>${servicePrizeName} üíñ: <span class="prize-status ${servicePrizeWon ? 'won' : 'pending'}">${servicePrizeWon ? `Â∑≤Ëé∑Âæó (${wonServiceItem})` : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                // New Prizes - Category 4: Material
                prizeHTML += `<li>${materialPrizeName} üí∞: <span class="prize-status ${materialPrizeWon ? 'won' : 'pending'}">${materialPrizeWon ? `Â∑≤Ëé∑Âæó (${wonMaterialItem})` : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                 // New Prizes - Category 5: Interaction
                prizeHTML += `<li>${interactionPrizeName} üéüÔ∏è: <span class="prize-status ${interactionPrizeWon ? 'won' : 'pending'}">${interactionPrizeWon ? `Â∑≤Ëé∑Âæó (${wonInteractionItem})` : 'ÂæÖËµ¢Âèñ'}</span></li>`;
    
                // Hongbao Game Unlock Status
                prizeHTML += `<li>Á∫¢ÂåÖÈõ®Ê∏∏Êàè üéÇ: <span class="prize-status ${hongbaoGameUnlocked ? 'unlocked' : 'pending'}">${hongbaoGameUnlocked ? 'Â∑≤Ëß£ÈîÅ' : 'ÂæÖËß£ÈîÅ'}</span></li>`;
    
                // Other potential outcomes (no status needed)
                prizeHTML += `<li>ÊÉÖËØù ‚ù§Ô∏è: (ÂèØËÉΩÊäΩ‰∏≠)</li>`;
                prizeHTML += `<li>È£ûÂêª üíã: (ÂèØËÉΩÊäΩ‰∏≠)</li>`;
    
                prizeHTML += '</ul>';
    
                prizeDialogContent.innerHTML = prizeHTML;
                prizeDialogView.classList.add('visible');
            }
    
            function hidePrizeDialog() {
                 console.log("Hiding prize dialog.");
                if (!prizeDialogView) {
                    console.error("Prize dialog view element not found!");
                    return;
                }
                prizeDialogView.classList.remove('visible');
            }
    
            // Removed: function showPrizeInfoAlert() { ... } // Alert is removed
    
            // --- Password Check Logic ---
            if (passwordSubmitButton && passwordInput && passwordErrorMessage) { passwordSubmitButton.addEventListener('click', () => { const enteredPassword = passwordInput.value.trim(); if (enteredPassword === "0610") { showGameStartWarning(); } else { passwordErrorMessage.textContent = '‰∏çÂØπÂì¶ÔºåÂÜçÊÉ≥ÊÉ≥ÔºÅÊèêÁ§∫Ôºö4‰ΩçÊï∞Â≠ó'; passwordInput.value = ''; passwordInput.focus(); } }); passwordInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') { event.preventDefault(); passwordSubmitButton.click(); } }); }
    
            // --- Pointer Trail Heart Logic ---
            function createPointerHeart(x, y) { if (!document.body) return; const heart = document.createElement('div'); heart.classList.add('pointer-heart'); heart.innerHTML = '‚ù§Ô∏è'; heart.style.left = `${x}px`; heart.style.top = `${y}px`; document.body.appendChild(heart); setTimeout(() => { if (heart && heart.parentNode) { heart.remove(); } }, 600); }
            const throttledCreateHeart = throttle(createPointerHeart, 100); document.body.addEventListener('mousemove', (event) => { throttledCreateHeart(event.pageX, event.pageY); }); document.body.addEventListener('touchmove', (event) => { if (event.touches.length > 0) { const touch = event.touches[0]; throttledCreateHeart(touch.pageX, touch.pageY); } }, { passive: true }); document.body.addEventListener('touchstart', (event) => { if (event.touches.length > 0) { const touch = event.touches[0]; throttledCreateHeart(touch.pageX, touch.pageY); } }, { passive: true });
    
            // --- Custom Audio Player Logic ---
            function updatePlayPauseIcon() { if (!playIcon || !audioElement || !playPauseButton) return; playIcon.classList.remove('play-icon', 'pause-icon'); if (audioElement.paused || audioElement.ended) { playIcon.classList.add('play-icon'); playPauseButton.setAttribute('aria-label', 'Êí≠Êîæ'); } else { playIcon.classList.add('pause-icon'); playPauseButton.setAttribute('aria-label', 'ÊöÇÂÅú'); } }
            if (playPauseButton && audioElement) { playPauseButton.addEventListener('click', () => { if (isDragAction) return; if (audioElement.paused || audioElement.ended) { audioElement.play().catch(e => console.error("Error playing audio:", e)); } else { audioElement.pause(); } }); }
            if (audioElement) { audioElement.addEventListener('timeupdate', () => { if (!isSeeking && !isNaN(audioElement.duration) && seekBar && currentTimeDisplay) { try { if(seekBar) seekBar.value = audioElement.currentTime; if(currentTimeDisplay) currentTimeDisplay.textContent = formatTime(audioElement.currentTime); } catch (e) { console.error("Error updating time:", e) } } }); audioElement.addEventListener('loadedmetadata', () => { if (!isNaN(audioElement.duration) && seekBar && durationDisplay) { try { if(seekBar) seekBar.max = audioElement.duration; if(durationDisplay) durationDisplay.textContent = formatTime(audioElement.duration); updatePlayPauseIcon(); } catch (e) { console.error("Error on loadedmetadata:", e) } } else { if(seekBar) seekBar.max = 0; if(durationDisplay) durationDisplay.textContent = "0:00"; } }); audioElement.addEventListener('play', updatePlayPauseIcon); audioElement.addEventListener('pause', updatePlayPauseIcon); audioElement.addEventListener('ended', updatePlayPauseIcon); }
            if (seekBar && currentTimeDisplay && audioElement) { seekBar.addEventListener('input', () => { isSeeking = true; try { if(currentTimeDisplay) currentTimeDisplay.textContent = formatTime(parseFloat(seekBar.value) || 0); } catch (e) { console.error("Error updating seek bar display:", e) } }); seekBar.addEventListener('change', () => { if (!isNaN(audioElement.duration)) { try { audioElement.currentTime = parseFloat(seekBar.value) || 0; } catch (e) { console.error("Error setting audio time:", e) } } isSeeking = false; if (!isSeeking && !isNaN(audioElement.duration) && currentTimeDisplay) { currentTimeDisplay.textContent = formatTime(audioElement.currentTime); } }); }
    
            // --- Slideshow Logic ---
            function updateDots() { if (!dotsContainer || !slides || dotsContainer.children.length !== slideCount) return; for (let i = 0; i < slideCount; i++) { if(dotsContainer.children[i]) dotsContainer.children[i].classList.toggle('active', i === currentSlideIndex); } }
            function showSlide(index) { if (slideCount <= 0 || !slideshow) return; currentSlideIndex = (index + slideCount) % slideCount; const offset = -currentSlideIndex * 100; slideshow.style.transform = `translateX(${offset}%)`; updateDots(); if (slideshowCaption && slideCaptions.length > currentSlideIndex) { slideshowCaption.textContent = slideCaptions[currentSlideIndex]; } else if (slideshowCaption) { slideshowCaption.textContent = ''; } }
            function nextSlide() { showSlide(currentSlideIndex + 1); } function startSlideshowAutoplay() { stopSlideshowAutoplay(); if (slideCount > 1) { slideInterval = setInterval(nextSlide, SLIDESHOW_INTERVAL_TIME); } } function stopSlideshowAutoplay() { clearInterval(slideInterval); slideInterval = null; } if (prevButton && nextButton) { prevButton.addEventListener('click', () => { if (isDragAction) return; stopSlideshowAutoplay(); showSlide(currentSlideIndex - 1); }); nextButton.addEventListener('click', () => { if (isDragAction) return; stopSlideshowAutoplay(); showSlide(currentSlideIndex + 1); }); } function createDots() { if (!dotsContainer || slideCount <= 0) return; dotsContainer.innerHTML = ''; for (let i = 0; i < slideCount; i++) { const dot = document.createElement('span'); dot.classList.add('dot'); dot.dataset.index = i; dot.setAttribute('aria-label', `Ë∑≥ËΩ¨Âà∞ÁÖßÁâá ${i + 1}`); dot.addEventListener('click', (e) => { if (isDragAction) return; stopSlideshowAutoplay(); const index = parseInt(e.target.dataset.index); showSlide(index); }); dotsContainer.appendChild(dot); } updateDots(); } if (slideshowContainer) { slideshowContainer.addEventListener('click', (event) => { if (isDragAction) return; if (!event.target.closest('.slideshow-nav') && !event.target.closest('.dot')) { console.log("Slideshow area clicked (audio trigger removed)."); } }); }
    
            // --- Draggable Elements Logic ---
            function makeDraggable(element) { if (!element) return; element.style.cursor = 'move'; element.addEventListener('dragstart', (e) => e.preventDefault()); element.style.touchAction = 'none'; let startX, startY, elementStartX, elementStartY, pointerId = null, dragThreshold = 5; function getPointerCoords(event) { let touch = null; if (event.touches && event.touches.length > 0) { for (let i = 0; i < event.touches.length; i++) { if (event.touches[i].identifier === pointerId) { touch = event.touches[i]; break; } } if (!touch) touch = event.touches[0]; } else if (event.changedTouches && event.changedTouches.length > 0) { for (let i = 0; i < event.changedTouches.length; i++) { if (event.changedTouches[i].identifier === pointerId) { touch = event.changedTouches[i]; break; } } if (!touch) touch = event.changedTouches[0]; } if (touch) return { x: touch.clientX, y: touch.clientY }; if (event.clientX !== undefined) return { x: event.clientX, y: event.clientY }; return null; } function dragStartHandler(event) { if (event.target !== element && event.target.closest('button, input, a, select, textarea')) { return; } if ((event.type === 'mousedown' && event.button !== 0) || (event.touches && event.touches.length > 1)) { return; } const coords = getPointerCoords(event); if (!coords) return; isDragging = false; isDragAction = false; dragTarget = element; dragTarget.style.transition = 'none'; startX = coords.x; startY = coords.y; const rect = dragTarget.getBoundingClientRect(); elementStartX = rect.left; elementStartY = rect.top; const computedStyle = getComputedStyle(dragTarget); if (computedStyle.position !== 'fixed' && computedStyle.position !== 'absolute') { console.warn("Draggable element is not positioned (fixed/absolute). Dragging might be unexpected.", dragTarget); dragTarget.style.position = 'fixed'; } if (!dragTarget.style.left || dragTarget.style.left === 'auto') { dragTarget.style.left = `${elementStartX}px`; } if (!dragTarget.style.top || dragTarget.style.top === 'auto') { dragTarget.style.top = `${elementStartY}px`; } dragTarget.style.right = 'auto'; dragTarget.style.bottom = 'auto'; dragTarget.style.transform = 'none'; if (event.type === 'mousedown') { pointerId = -1; document.addEventListener('mousemove', draggingHandler); document.addEventListener('mouseup', dragEndHandler); } else if (event.type === 'touchstart') { pointerId = event.touches[0].identifier; document.addEventListener('touchmove', draggingHandler, { passive: false }); document.addEventListener('touchend', dragEndHandler); document.addEventListener('touchcancel', dragEndHandler); } document.body.style.userSelect = 'none'; document.body.style.webkitUserSelect = 'none'; document.body.style.msUserSelect = 'none'; } function draggingHandler(event) { if (!dragTarget) return; const coords = getPointerCoords(event); if (!coords) { dragEndHandler(event); return; } let currentX = coords.x; let currentY = coords.y; const deltaX = currentX - startX; const deltaY = currentY - startY; if (!isDragging && (Math.abs(deltaX) > dragThreshold || Math.abs(deltaY) > dragThreshold)) { isDragging = true; isDragAction = true; } if (isDragging) { if (event.cancelable && event.type === 'touchmove') { event.preventDefault(); } let newLeft = elementStartX + deltaX; let newTop = elementStartY + deltaY; const parentWidth = window.innerWidth; const parentHeight = window.innerHeight; const elemWidth = dragTarget.offsetWidth; const elemHeight = dragTarget.offsetHeight; newLeft = Math.max(0, Math.min(newLeft, parentWidth - elemWidth)); newTop = Math.max(0, Math.min(newTop, parentHeight - elemHeight)); dragTarget.style.left = `${newLeft}px`; dragTarget.style.top = `${newTop}px`; } } function dragEndHandler(event) { if (!dragTarget) return; let endPointerMatch = false; if (event.type === 'mouseup' && pointerId === -1) { endPointerMatch = true; } else if ((event.type === 'touchend' || event.type === 'touchcancel') && event.changedTouches) { for (let i = 0; i < event.changedTouches.length; i++) { if (event.changedTouches[i].identifier === pointerId) { endPointerMatch = true; break; } } } if (!endPointerMatch && event.type !== 'touchcancel' && event.type !== 'mouseup') { return; } if (pointerId === -1) { document.removeEventListener('mousemove', draggingHandler); document.removeEventListener('mouseup', dragEndHandler); } else { document.removeEventListener('touchmove', draggingHandler); document.removeEventListener('touchend', dragEndHandler); document.removeEventListener('touchcancel', dragEndHandler); } dragTarget.style.transition = ''; document.body.style.userSelect = ''; document.body.style.webkitUserSelect = ''; document.body.style.msUserSelect = ''; if (isDragAction) { const finalRect = dragTarget.getBoundingClientRect(); const finalPosToSave = { x: finalRect.left, y: finalRect.top }; if (element.id === 'audio-player-container') { try { localStorage.setItem('audioPlayerPos', JSON.stringify(finalPosToSave)); } catch (e) { console.error("Failed to save player position:", e); } } else if (element.id === 'cat-pendant') { try { localStorage.setItem('catPosition', JSON.stringify(finalPosToSave)); } catch (e) { console.error("Failed to save cat position:", e); } } } isDragging = false; pointerId = null; dragTarget = null; setTimeout(() => { isDragAction = false; }, 0); } element.addEventListener('mousedown', dragStartHandler); element.addEventListener('touchstart', dragStartHandler, { passive: true }); }
            if (audioPlayerContainer) { const savedPlayerPos = localStorage.getItem('audioPlayerPos'); if (savedPlayerPos) { try { const pos = JSON.parse(savedPlayerPos); if(pos && typeof pos.x === 'number' && typeof pos.y === 'number'){ audioPlayerContainer.style.left = `${pos.x}px`; audioPlayerContainer.style.top = `${pos.y}px`; audioPlayerContainer.style.right = 'auto'; audioPlayerContainer.style.bottom = 'auto'; audioPlayerContainer.style.transform = 'none'; } } catch(e){ console.error("Failed to load player position:", e); } } makeDraggable(audioPlayerContainer); }
            if (catPendant) { const savedCatPos = localStorage.getItem('catPosition'); if (savedCatPos) { try { const pos = JSON.parse(savedCatPos); if(pos && typeof pos.x === 'number' && typeof pos.y === 'number'){ catPendant.style.left = `${pos.x}px`; catPendant.style.top = `${pos.y}px`; catPendant.style.right = 'auto'; catPendant.style.bottom = 'auto'; catPendant.style.transform = 'none'; } } catch(e){ console.error("Failed to load cat position:", e); } } makeDraggable(catPendant); }
    
            // --- Cat Pendant Logic (Updated for Meow) ---
            if (catPendant && catDialog) {
                catPendant.addEventListener('click', () => {
                    if (isDragAction) { console.log("Cat click ignored due to drag."); return; }
                    try {
                        const now = Date.now();
                        let dialogText = "";
                        let canShowDialog = false;
                        let playAnimation = false; // Animation is separate from sound now
    
                        if (isCatRateLimitedCooldownActive) {
                            if (now - catCooldownStartTime >= CAT_COOLDOWN_DURATION) {
                                isCatRateLimitedCooldownActive = false; catCooldownStartTime = 0; console.log("Cat cooldown ended.");
                            } else {
                                dialogText = rateLimitDialog; canShowDialog = true; playAnimation = false;
                            }
                        }
    
                        if (!isCatRateLimitedCooldownActive) {
                            tryPlayMeowAudio(); // Play meow sound regardless of dialog/rate limit
                            recentCatClicks = recentCatClicks.filter(timestamp => now - timestamp < CAT_CLICK_WINDOW);
                            recentCatClicks.push(now);
                            let isRateLimited = recentCatClicks.length >= CAT_CLICK_LIMIT;
    
                            if (isRateLimited) {
                                dialogText = rateLimitDialog; canShowDialog = true; playAnimation = false;
                                isCatRateLimitedCooldownActive = true; catCooldownStartTime = now; console.log("Cat rate limit cooldown started.");
                            } else {
                                 // Only show dialog text for non-rate-limited clicks
                                if (firstCatClick) {
                                    dialogText = initialDialog[0]; firstCatClick = false;
                                } else {
                                    const randomIndex = Math.floor(Math.random() * randomDialogs.length);
                                    dialogText = randomDialogs[randomIndex];
                                }
                                canShowDialog = true;
                                playAnimation = true; // Still play animation for non-rate-limited clicks
                            }
                        }
    
                        // Show Dialog logic
                        if (canShowDialog && catDialog) {
                            catDialog.textContent = dialogText;
                            clearTimeout(catDialogTimeout);
                            catDialog.classList.remove('visible');
                            void catDialog.offsetWidth; // Force reflow
                            catDialog.classList.add('visible');
                            catDialogTimeout = setTimeout(() => { if(catDialog) catDialog.classList.remove('visible'); }, 4000);
                        } else if (!catDialog) {
                            console.error("Cat dialog element not found!");
                        }
    
                        // Play Animation logic (only if not rate limited)
                        if (playAnimation && !catPendant.classList.contains('rolling')) {
                            const currentLeft = catPendant.style.left; const currentTop = catPendant.style.top;
                            catPendant.classList.add('rolling');
                            catPendant.addEventListener('animationend', () => {
                                if(catPendant) { catPendant.classList.remove('rolling'); catPendant.style.left = currentLeft; catPendant.style.top = currentTop; catPendant.style.transform = 'none'; }
                            }, { once: true });
                        }
    
                    } catch (error) {
                        console.error("Error in cat pendant click handler:", error);
                        if (catPendant) catPendant.classList.remove('rolling');
                        if (catDialog) catDialog.classList.remove('visible');
                        clearTimeout(catDialogTimeout);
                    }
                });
                 const catImg = catPendant.querySelector('img');
                 if(catImg) { catImg.onerror = () => { if (catPendant) catPendant.style.display = 'none'; }; }
                 else { if (catPendant) catPendant.style.display = 'none'; }
            } else {
                 if (catPendant) catPendant.style.display = 'none';
            }
    
            // --- Font Toggle Logic ---
            if (fontToggleButton && loveLetterView) { fontToggleButton.addEventListener('click', () => { if (isDragAction) return; loveLetterView.classList.toggle('love-letter-default-font'); }); }
    
            // --- Slot Machine Game Logic (Updated) ---
            function getRandomLoveQuote() { if (loveQuotes.length === 0) return "‰Ω†Â∞±ÊòØÊàëÊúÄÂ•ΩÁöÑÊÉÖËØù„ÄÇ"; return loveQuotes[Math.floor(Math.random() * loveQuotes.length)]; }
    
            function spinSlots() {
                if (isSpinning || !slots || slots.length !== 3 || !slotResultMessage) return;
    
                isSpinning = true;
                if (spinButton) spinButton.disabled = true;
                if (slotResultMessage) slotResultMessage.textContent = "ËΩ¨Âä®‰∏≠...";
    
                let spinCycles = 0;
                const maxCycles = 15; // Adjust for desired spin duration
                const spinInterval = setInterval(() => {
                    slots.forEach(slot => {
                        slot.textContent = slotItems[Math.floor(Math.random() * slotItems.length)];
                        slot.classList.add('spinning');
                        setTimeout(() => slot.classList.remove('spinning'), 50);
                    });
                    spinCycles++;
                    if (spinCycles >= maxCycles) {
                        clearInterval(spinInterval);
                        displaySlotResult(); // Pass control to result determination
                    }
                }, 80); // Adjust interval for spin speed
            }
    
            function displaySlotResult() {
                if (!slots || slots.length !== 3 || !slotResultMessage) {
                    isSpinning = false; if (spinButton) spinButton.disabled = false; return;
                }
    
                let rand = Math.random() * 100; // Use percentage for easier comparison
                let outcomeType = 'Mixed';
                let resultItems = [];
                let message = "";
    
                // Define probability thresholds (cumulative)
                const prob_Phone = 0.05;         // 0.05%
                const prob_Camera = 0.1;        // 0.1%
                const prob_Fu = 20.0;           // 20%
                const prob_Hearts = 20.0;       // 20%
                const prob_Cakes = 15.0;        // 15%
                const prob_Outing = 5.0;        // 5%
                const prob_Travel = 5.0;        // 5%
                const prob_Service = 5.0;       // 5%
                const prob_Material = 5.0;      // 5%
                const prob_Interaction = 5.0;   // 5%
                // Kiss probability is the remainder: 100 - (sum of above) = 19.85%
    
                let cumulativeProb = 0;
    
                // Determine outcome based on probabilities, checking limits first
                cumulativeProb += prob_Phone;
                if (!phoneWon && rand < cumulativeProb) { outcomeType = '3_Phones'; }
                else {
                    cumulativeProb += prob_Camera;
                    if (!cameraWon && rand < cumulativeProb) { outcomeType = '3_Cameras'; }
                    else {
                        cumulativeProb += prob_Fu;
                        if (slotWinningsTotal < SLOT_WINNINGS_CAP && rand < cumulativeProb) { outcomeType = '3_Fu'; }
                        else {
                            cumulativeProb += prob_Hearts;
                            if (rand < cumulativeProb) { outcomeType = '3_Hearts'; }
                             else {
                                 cumulativeProb += prob_Cakes;
                                 // Allow unlocking even if already unlocked, message changes
                                 if (rand < cumulativeProb) { outcomeType = '3_Cakes'; }
                                else {
                                    cumulativeProb += prob_Outing;
                                    if (!outingPrizeWon && rand < cumulativeProb) { outcomeType = 'Outing_Prize'; }
                                    else {
                                        cumulativeProb += prob_Travel;
                                        if (!travelPrizeWon && rand < cumulativeProb) { outcomeType = 'Travel_Prize'; }
                                        else {
                                            cumulativeProb += prob_Service;
                                            if (!servicePrizeWon && rand < cumulativeProb) { outcomeType = 'Service_Prize'; }
                                            else {
                                                cumulativeProb += prob_Material;
                                                if (!materialPrizeWon && rand < cumulativeProb) { outcomeType = 'Material_Prize'; }
                                                else {
                                                     cumulativeProb += prob_Interaction;
                                                     if (!interactionPrizeWon && rand < cumulativeProb) { outcomeType = 'Interaction_Prize'; }
                                                     else {
                                                          // Remainder is Kiss or forced replacement
                                                          let forceLoveQuote = false;
                                                          if (rand < cumulativeProb) { // Hit a limited prize that was already won
                                                              if (outcomeType === 'Mixed') { // Ensure it wasn't already set to Mixed
                                                                 // Check which category was hit but already won
                                                                 let tempRand = rand;
                                                                 if(tempRand >= (cumulativeProb - prob_Interaction) && interactionPrizeWon) forceLoveQuote = true;
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material) && materialPrizeWon) forceLoveQuote = true;
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material - prob_Service) && servicePrizeWon) forceLoveQuote = true;
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material - prob_Service - prob_Travel) && travelPrizeWon) forceLoveQuote = true;
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material - prob_Service - prob_Travel - prob_Outing) && outingPrizeWon) forceLoveQuote = true;
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material - prob_Service - prob_Travel - prob_Outing - prob_Cakes - prob_Hearts) && slotWinningsTotal >= SLOT_WINNINGS_CAP ) forceLoveQuote = true; // Fu cap
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material - prob_Service - prob_Travel - prob_Outing - prob_Cakes - prob_Hearts - prob_Fu - prob_Camera) && cameraWon) forceLoveQuote = true;
                                                                 else if(tempRand >= (cumulativeProb - prob_Interaction - prob_Material - prob_Service - prob_Travel - prob_Outing - prob_Cakes - prob_Hearts - prob_Fu - prob_Camera - prob_Phone) && phoneWon) forceLoveQuote = true;
    
                                                              }
                                                          }
    
                                                          if(forceLoveQuote) {
                                                             console.log("Forcing Love Quote due to win limit.");
                                                             outcomeType = '3_Hearts';
                                                          } else {
                                                             outcomeType = '3_Kisses'; // Default to kiss if nothing else hit
                                                          }
                                                     }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
    
    
                // Handle outcome
                switch (outcomeType) {
                    case '3_Phones':
                        resultItems = ['üì±', 'üì±', 'üì±'];
                        phoneWon = true;
                        let phoneModel = Math.random() < 0.5 ? "Á∫¢Á±≥ K80" : "Oppo Reno 13";
                        message = `Â§©ÂëêÔºÅË∂ÖÁ∫ßÂ§ßÂ•ñÔºÅüì±üì±üì± Ëµ¢Âæó‰∏ÄÈÉ®Êñ∞ÊâãÊú∫ (${phoneModel})ÔºÅ`;
                        break;
                    case '3_Cameras':
                        resultItems = ['üì∑', 'üì∑', 'üì∑'];
                        cameraWon = true;
                        message = "Èöæ‰ª•ÁΩÆ‰ø°ÔºÅË∂ÖÁ∫ßÂ§ßÂ•ñÔºÅüì∑üì∑üì∑ Ëµ¢Âæó‰∏ÄÂè∞Á¥¢Â∞ºÁõ∏Êú∫ÔºÅ";
                        break;
                    case '3_Fu':
                        resultItems = ['Á¶è', 'Á¶è', 'Á¶è'];
                        let winningsToAdd = 10; // Example amount per win
                        let actualWinnings = Math.min(winningsToAdd, SLOT_WINNINGS_CAP - slotWinningsTotal);
                        if (actualWinnings > 0) {
                            slotWinningsTotal += actualWinnings;
                            message = `Â§™Ê£í‰∫ÜÔºÅÁ¶èÁ¶èÁ¶èÔºÅËé∑Âæó ${actualWinnings} ÂÖÉÂπ∏ËøêÂ•ñÈáëÔºÅüí∞ (ÂΩìÂâçÁ¥ØËÆ°: ${slotWinningsTotal}ÂÖÉ)`;
                        } else {
                            // If cap was already reached before this spin, outcome would be 3_Hearts
                            // This case means they hit the cap exactly with this win or were already capped.
                            message = `Âπ∏ËøêÂ•ñÈáëÂ∑≤Ëææ‰∏äÈôê(${SLOT_WINNINGS_CAP}ÂÖÉ)ÔºÅÊú¨Ê¨°ËΩ¨‰∏∫ÊÉÖËØù‚ù§Ô∏è`;
                             outcomeType = '3_Hearts'; // Force outcome change
                             resultItems = ['‚ù§Ô∏è', '‚ù§Ô∏è', '‚ù§Ô∏è'];
                             message = `üíñüíñüíñ ${getRandomLoveQuote()}`; // Re-set message
                        }
                        break;
                    case '3_Hearts':
                        resultItems = ['‚ù§Ô∏è', '‚ù§Ô∏è', '‚ù§Ô∏è'];
                        message = `üíñüíñüíñ ${getRandomLoveQuote()}`;
                        break;
                    case '3_Cakes':
                        resultItems = ['üéÇ', 'üéÇ', 'üéÇ'];
                        if (!hongbaoGameUnlocked) {
                            message = "ÊÅ≠ÂñúÔºÅüéÇüéÇüéÇ Ëß£ÈîÅÁ∫¢ÂåÖÈõ®Ê∏∏ÊàèÔºÅ";
                            hongbaoGameUnlocked = true;
                            if (proceedToHongbaoGameButton) proceedToHongbaoGameButton.style.display = 'inline-block';
                        } else {
                            message = "Á∫¢ÂåÖÈõ®Ê∏∏ÊàèÂ∑≤Ëß£ÈîÅÔºÅÂèØ‰ª•ÁªßÁª≠ÊäΩÂ•ñÊàñÂºÄÂßãÊ∏∏Êàè„ÄÇ";
                        }
                        break;
                     case 'Outing_Prize':
                         resultItems = ['üé°','üé°','üé°'];
                         outingPrizeWon = true;
                         wonOutingItem = getRandomItem(outingItems);
                         message = `ÊÅ≠ÂñúÔºÅüé°üé°üé° Ëµ¢ÂæóÁâπÊÆäÂ•ñÂä±: ${wonOutingItem}ÔºÅ`;
                         break;
                     case 'Travel_Prize':
                         resultItems = ['‚úàÔ∏è','‚úàÔ∏è','‚úàÔ∏è'];
                         travelPrizeWon = true;
                         wonTravelItem = getRandomItem(travelItems);
                         message = `ÊÅ≠ÂñúÔºÅ‚úàÔ∏è‚úàÔ∏è‚úàÔ∏è Ëµ¢ÂæóÁâπÊÆäÂ•ñÂä±: ${wonTravelItem}ÔºÅ`;
                         break;
                     case 'Service_Prize':
                         resultItems = ['üíñ','üíñ','üíñ'];
                         servicePrizeWon = true;
                         wonServiceItem = getRandomItem(serviceItems);
                         message = `ÊÅ≠ÂñúÔºÅüíñüíñüíñ Ëµ¢ÂæóÁâπÊÆäÂ•ñÂä±: ${wonServiceItem}ÔºÅ`;
                         break;
                     case 'Material_Prize':
                         resultItems = ['üí∞','üí∞','üí∞'];
                         materialPrizeWon = true;
                         wonMaterialItem = getRandomItem(materialItems);
                         message = `ÊÅ≠ÂñúÔºÅüí∞üí∞üí∞ Ëµ¢ÂæóÁâπÊÆäÂ•ñÂä±: ${wonMaterialItem}ÔºÅ`;
                         break;
                     case 'Interaction_Prize':
                         resultItems = ['üéüÔ∏è','üéüÔ∏è','üéüÔ∏è'];
                         interactionPrizeWon = true;
                         wonInteractionItem = getRandomItem(interactionItems);
                         message = `ÊÅ≠ÂñúÔºÅüéüÔ∏èüéüÔ∏èüéüÔ∏è Ëµ¢ÂæóÁâπÊÆäÂ•ñÂä±: ${wonInteractionItem}ÔºÅ`;
                         break;
                    case '3_Kisses':
                        resultItems = ['üíã', 'üíã', 'üíã'];
                        message = "ÈÄÅÂßêÂßê‰∏Ä‰∏™Êù•Ëá™Â∞ëÁà∑ÁöÑÈ£ûÂêª~ üíã";
                        break;
                    case 'Mixed':
                    default: // Also handles cases where a limited prize was hit but already won (logic defaults to Mixed here)
                        // Ensure the generated mixed result is not actually a winning combo that was skipped due to limits
                        do {
                           resultItems = [
                               slotItems[Math.floor(Math.random() * slotItems.length)],
                               slotItems[Math.floor(Math.random() * slotItems.length)],
                               slotItems[Math.floor(Math.random() * slotItems.length)]
                           ];
                         } while (
                             (resultItems[0] === resultItems[1] && resultItems[1] === resultItems[2]) // Avoid natural triples
                         );
                        message = "ÂìéÂëÄÔºåÂ∑Æ‰∏ÄÁÇπÁÇπÔºÅÂÜçÊù•‰∏ÄÊ¨°ÂêßÔºÅ";
                        break;
                }
    
                slots.forEach((slot, index) => { slot.textContent = resultItems[index]; });
                slotResultMessage.textContent = message;
    
                isSpinning = false;
                if (spinButton) spinButton.disabled = false;
                // Update prize dialog immediately if it's visible
                 if (prizeDialogView && prizeDialogView.classList.contains('visible')) {
                     showPrizeDialog();
                 }
            }
    
    
            // --- Falling Items Game Logic (BIRTHDAY HONGBAO - Unaffected by Slot Limits) ---
            function startGame() {
                console.log("Starting falling game (Birthday Hongbao)...");
                if (!gameArea || !scoreDisplay || !timerDisplay || !gameResultDisplay || !roundDisplay || !gameInfo) { console.error("Critical game elements not found at startGame!"); return; }
    
                currentRound++; console.log(`Starting Round ${currentRound}`); if (currentRound > maxRounds) { console.log("Max rounds reached, showing final result."); showFinalResult(); return; }
                stopGame(); // Stop previous round processes
                itemsSpawnedThisRound = 0; hongbaoSpawnedThisRound = 0; miceSpawnedThisRound = 0; greenSpawnedThisRound = 0; timeLeft = 30; gameActive = true;
                try { if(roundDisplay) roundDisplay.textContent = `Á¨¨ ${currentRound} / ${maxRounds} Â±Ä`; if(scoreDisplay) scoreDisplay.textContent = `ÂΩìÂâçÁîüÊó•Á∫¢ÂåÖ ${totalScore} ÂÖÉ`; /* Updated Text */ if(timerDisplay) timerDisplay.textContent = timeLeft; if(gameResultDisplay) gameResultDisplay.style.display = 'none'; if(gameArea) gameArea.style.display = 'block'; if(gameInfo) gameInfo.style.display = 'block'; } catch(e) { console.error("Error resetting display:", e); }
                try { if (gameTimerInterval) clearInterval(gameTimerInterval); gameTimerInterval = setInterval(() => { if (!gameActive) { clearInterval(gameTimerInterval); return; } timeLeft--; if (timerDisplay) timerDisplay.textContent = timeLeft; if (timeLeft <= 0) { gameOver(); } }, 1000); } catch(e) { console.error("Error starting timer:", e); gameActive = false; return; }
                try { if (itemSpawnInterval) clearInterval(itemSpawnInterval); itemSpawnInterval = setInterval(spawnRandomItem, ITEM_SPAWN_INTERVAL); } catch(e) { console.error("Error starting item spawn:", e); stopGame(); return; }
                try { if (gameArea) gameArea.removeEventListener('click', handleGameAreaClick); if (gameArea) gameArea.addEventListener('click', handleGameAreaClick); } catch(e) { console.error("Error adding click listener:", e); stopGame(); return; }
                console.log(`Round ${currentRound} started successfully.`);
            }
    
            function stopGame() { console.log("Stopping falling game elements..."); gameActive = false; try { clearInterval(gameTimerInterval); clearInterval(itemSpawnInterval); } catch(e) { console.error("Error clearing intervals:", e); } gameTimerInterval = null; itemSpawnInterval = null; try { if(gameArea) { gameArea.removeEventListener('click', handleGameAreaClick); const remainingItems = gameArea.querySelectorAll('.game-item'); remainingItems.forEach(item => { const tid = item.dataset.removalTimeoutId; if(tid) clearTimeout(parseInt(tid)); item.remove(); }); } } catch(e) { console.error("Error cleaning up game area:", e); } console.log("Falling game elements stopped."); }
            function spawnRandomItem() { if (!gameArea || !gameActive || itemsSpawnedThisRound >= maxItemsPerRound) { if (itemsSpawnedThisRound >= maxItemsPerRound) { console.log(`Max total items (${maxItemsPerRound}) reached for round ${currentRound}.`); } return; } const rand = Math.random(); let itemType = null; let canSpawn = false; if (rand < 0.333) { itemType = 'hongbao'; } else if (rand < 0.666) { itemType = 'mouse'; } else { itemType = 'green'; } switch (itemType) { case 'hongbao': if (hongbaoSpawnedThisRound < maxHongbaoPerRound) { canSpawn = true; hongbaoSpawnedThisRound++; } break; case 'mouse': if (miceSpawnedThisRound < maxMicePerRound) { canSpawn = true; miceSpawnedThisRound++; } break; case 'green': if (greenSpawnedThisRound < maxGreenPerRound) { canSpawn = true; greenSpawnedThisRound++; } break; } if (canSpawn && itemType) { itemsSpawnedThisRound++; switch (itemType) { case 'hongbao': createHongbao(); break; case 'mouse': createMouse(); break; case 'green': createGreenEnvelope(); break; } } else if (!canSpawn && itemType) { } }
            function createGameItem(className, content) { if (!gameArea || !gameActive) return; try { const item = document.createElement('div'); item.classList.add('game-item', className); if (content) item.innerHTML = content; const gameAreaWidth = gameArea.offsetWidth; const itemWidth = 50; item.style.left = Math.max(0, Math.random() * (gameAreaWidth - itemWidth)) + 'px'; const durationVariation = Math.random() * 1000 - 500; const actualDuration = Math.max(3000, ITEM_FALL_DURATION + durationVariation); item.style.animationDuration = actualDuration / 1000 + 's'; gameArea.appendChild(item); const removalTimeout = setTimeout(() => { if (item.parentNode) { item.remove(); } }, actualDuration + 200); item.dataset.removalTimeoutId = removalTimeout; } catch(e) { console.error(`Error creating ${className}:`, e); } }
            function createHongbao() { createGameItem('hongbao'); } function createGreenEnvelope() { createGameItem('green-envelope'); } function createMouse() { createGameItem('mouse-item'); }
            function handleGameAreaClick(event) { if (!gameActive || !event.target) return; const clickedItem = event.target.closest('.game-item'); if (!clickedItem) return; try { let scoreChange = 0; if (clickedItem.classList.contains('hongbao')) { scoreChange = 1; } else if (clickedItem.classList.contains('green-envelope')) { scoreChange = -1; } else if (clickedItem.classList.contains('mouse-item')) { scoreChange = -3; } if (scoreChange !== 0) { totalScore += scoreChange; // Only update Birthday Hongbao total
                if (scoreDisplay) scoreDisplay.textContent = `ÂΩìÂâçÁîüÊó•Á∫¢ÂåÖ ${totalScore} ÂÖÉ`; /* Update display on click */ } const removalTimeoutId = clickedItem.dataset.removalTimeoutId; if (removalTimeoutId) { clearTimeout(parseInt(removalTimeoutId)); } clickedItem.remove(); } catch(e) { console.error("Error handling game item click:", e); } }
            function gameOver() { console.log(`Falling Game Round ${currentRound} Over. Birthday Score: ${totalScore}`); stopGame(); if (currentRound >= maxRounds) { showFinalResult(); } else { showEndOfRoundOptions(); } }
            function showEndOfRoundOptions() { if (!gameResultDisplay || !gameResultText || !gameResultButtons || !gameArea || !gameInfo) return; console.log("Showing end of round options."); if (gameArea) gameArea.style.display = 'none'; if (gameInfo) gameInfo.style.display = 'none'; gameResultText.textContent = `Á¨¨ ${currentRound} Â±ÄÁªìÊùüÔºÅÂΩìÂâçÁîüÊó•Á∫¢ÂåÖÔºö${totalScore} ÂÖÉ`; gameResultButtons.style.display = 'flex'; gameResultDisplay.style.display = 'block'; }
    
            function showFinalResult() {
                if (!gameResultDisplay || !gameResultText || !gameResultButtons) return;
                console.log("Showing final combined result.");
                stopGame(); // Ensure birthday game is stopped
    
                // Ensure only the result view is visible within the game overlay
                hideAllViews(); // Hide other main views first
                if (gameView) gameView.style.display = 'flex'; // Show the game overlay container
                if (gameArea) gameArea.style.display = 'none'; // Hide game area
                if (gameInfo) gameInfo.style.display = 'none'; // Hide round info
    
                let combinedTotal = totalScore + slotWinningsTotal; // Combine scores for final display
                gameResultText.innerHTML = `Ê∏∏ÊàèÁªìÊùüÔºÅ<br>ÁîüÊó•Á∫¢ÂåÖÂæóÂàÜ ${totalScore} ÂÖÉ + Âπ∏ËøêÂ•ñÈáë ${slotWinningsTotal} ÂÖÉ = <br>ÊÄªËÆ° <span class="prize-code">${combinedTotal}</span> ÂÖÉÔºÅ<br>ËØ∑Êà™ÂõæÊâæÂì•Âì•ÂÖëÊç¢Â•ñÂä±ÔºÅ`;
                gameResultButtons.style.display = 'none'; // Hide continue/redeem buttons
                gameResultDisplay.style.display = 'block'; // Show final result box
                window.scrollTo(0, 0);
            }
    
            // --- Event Listeners ---
            if (cakeLink) { if (typeof showLoveLetter === 'function' && typeof tryPlayBackgroundAudio === 'function') { cakeLink.addEventListener('click', (event) => { try { event.preventDefault(); if (isDragAction) { console.log("Cake click ignored due to drag action."); return; } console.log("Cake clicked, attempting to show love letter..."); if (loveWarningMessage) { loveWarningMessage.style.display = 'block'; setTimeout(() => { if (loveWarningMessage) loveWarningMessage.style.display = 'none'; showLoveLetter(); tryPlayBackgroundAudio(); }, 2500); } else { showLoveLetter(); tryPlayBackgroundAudio(); } } catch(err) { console.error("Error in cake click listener:", err); } }); } else { console.error("showLoveLetter or tryPlayBackgroundAudio function not defined when setting cake listener."); } } else { console.error("Birthday cake link element (#birthday-cake-link) not found!"); }
            if (backButton) { backButton.addEventListener('click', showBirthday); }
            if (gotoGameButton) { gotoGameButton.addEventListener('click', showSlotMachine); } // Resets state and shows slot machine
            if (spinButton) { spinButton.addEventListener('click', spinSlots); }
            if (proceedToHongbaoGameButton) { proceedToHongbaoGameButton.addEventListener('click', showPasswordPrompt); } // Leads to birthday game
            if (backFromSlotMachineButton) { backFromSlotMachineButton.addEventListener('click', showLoveLetter); }
            if (confirmStartGameButton) { confirmStartGameButton.addEventListener('click', showGame); } // Starts birthday game
            if (backFromGameButton) { backFromGameButton.addEventListener('click', showLoveLetter); } // Back from birthday game
            if (continueGameButton) { continueGameButton.addEventListener('click', showGame); } // Next round of birthday game
            if (redeemEarlyButton) { redeemEarlyButton.addEventListener('click', showFinalResult); } // End birthday game early
    
             // Updated: Event listeners for new prize dialog
             if (showSlotWinningsButtons.length > 0) {
                 showSlotWinningsButtons.forEach(button => {
                     button.addEventListener('click', showPrizeDialog);
                 });
             } else {
                 console.log("Show winnings buttons not found.");
             }
             if (closePrizeDialogButton) {
                 closePrizeDialogButton.addEventListener('click', hidePrizeDialog);
             } else {
                 console.log("Close prize dialog button not found.");
             }
    
    
            // --- Initial Setup ---
            try {
                 // Initialize variables on first load
                 totalScore = 0; currentRound = 0; slotWinningsTotal = 0;
                 hongbaoGameUnlocked = false; lastActiveViewId = 'birthday-view';
                 phoneWon = false; cameraWon = false;
                 outingPrizeWon = false; wonOutingItem = null;
                 travelPrizeWon = false; wonTravelItem = null;
                 servicePrizeWon = false; wonServiceItem = null;
                 materialPrizeWon = false; wonMaterialItem = null;
                 interactionPrizeWon = false; wonInteractionItem = null;
                 isSpinning = false;
    
                 hideAllViews(); // Initial hide
                 if (birthdayView) {
                     birthdayView.style.display = 'block'; // Show initial view
                     lastActiveViewId = 'birthday-view'; // Set initial last view
                     birthdayIntervalId = startFallingItems(birthdayIntervalId, birthdayItems, birthdayView, BIRTHDAY_INTERVAL_TIME);
                 } else { console.error("Birthday view not found!"); }
    
                 // Setup Audio Player
                  if (audioElement && playPauseButton && seekBar && currentTimeDisplay && durationDisplay && playIcon) {
                      if (!isNaN(audioElement.duration) && audioElement.duration > 0) {
                          seekBar.max = audioElement.duration; durationDisplay.textContent = formatTime(audioElement.duration); currentTimeDisplay.textContent = formatTime(0);
                      } else {
                          audioElement.onloadedmetadata = () => {
                              if (!isNaN(audioElement.duration)) { seekBar.max = audioElement.duration; durationDisplay.textContent = formatTime(audioElement.duration); }
                              else { seekBar.max = 100; durationDisplay.textContent = "0:00"; }
                          };
                          seekBar.max = 100; durationDisplay.textContent = "0:00"; currentTimeDisplay.textContent = "0:00";
                      }
                      updatePlayPauseIcon();
                  } else { if (audioPlayerContainer) audioPlayerContainer.style.display = 'none'; console.error("Audio player elements missing."); }
    
                  // Setup Slideshow
                  if (slideshow && slideCount > 0 && dotsContainer && prevButton && nextButton && slideshowCaption) {
                       createDots(); showSlide(0); startSlideshowAutoplay();
                  } else { if (slideshowContainer) slideshowContainer.style.display = 'none'; console.error("Slideshow elements missing."); }
    
                 console.log("Initial setup complete.");
             } catch (error) {
                 console.error("Error during initial setup:", error);
             }
    
        }); // End of DOMContentLoaded listener
     </script>
 </body>
 </html>