<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¼ çŠçŠç”Ÿæ—¥å¿«ä¹ï¼</title>

    <link rel="preload" href="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/pfsg.ttf" as="font" type="font/ttf" crossorigin>

    <style>
        /* --- Web Font Definition --- */
        @font-face {
            font-family: 'MyCustomLetterFont';
            src: url('https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/pfsg.ttf');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* --- General Styles --- */
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "å¾®è½¯é›…é»‘", system-ui, sans-serif; line-height: 1.6; margin: 0; padding-bottom: 80px; background-color: #f8f0f8; overflow-x: hidden; font-size: 16px; min-height: 100vh; position: relative; -webkit-overflow-scrolling: touch; }
        body, div, p, h1, button, img { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }

        /* --- Background Layers --- */
        #background-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background-image: url("https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/background-placeholder.jpg");
            background-size: cover;
            background-position: top center;
        }
        #background-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: rgba(255, 255, 255, 0.55); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }

        /* --- Views --- */
        #birthday-view, #love-letter-view { padding: 15px; position: relative; z-index: 1; }
        #birthday-view {
            background-color: transparent;
            cursor: url('https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/Aero_arrow.cur') 16 16, auto;
            display: block; min-height: 100vh;
        }
        #love-letter-view { display: none; background-color: rgba(255, 250, 240, 0.88); color: #5a463a; max-width: 95%; margin: 40px auto; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15); border-radius: 8px; padding: 20px; padding-top: 60px; padding-bottom: 80px; position: relative; z-index: 10; }
        #love-letter-view::before { content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 0; border-style: solid; border-width: 60px 0 0 calc(50vw - 15px); border-color: rgba(254, 202, 202, 0.8) transparent transparent rgba(254, 202, 202, 0.8); z-index: 1; border-top-left-radius: 8px; }
        #love-letter-view::after { content: ''; position: absolute; top: 0; right: 0; width: 50%; height: 0; border-style: solid; border-width: 0 0 60px calc(50vw - 15px); border-color: transparent rgba(254, 202, 202, 0.8) rgba(254, 202, 202, 0.8) transparent; z-index: 1; border-top-right-radius: 8px; }

        /* --- Birthday View Content Styles --- */
        #birthday-view .birthday-container { z-index: 10; display: flex; flex-direction: column; align-items: center; text-align: center; margin-top: 30px; position: relative; padding: 0 30px;}
        #birthday-view #birthday-cake-link { display: flex; justify-content: center; width: 100%; text-decoration: none; cursor: inherit; position: relative; -webkit-tap-highlight-color: transparent; }
        #birthday-view #birthday-cake { display: block; max-width: 100%; max-height: 280px; height: auto; width: auto; object-fit: contain; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.2s ease-in-out; }
        #birthday-view #birthday-cake-link:hover #birthday-cake { transform: scale(1.05); }
        #birthday-message { font-size: 1.4em; font-weight: bold; color: #e83e8c; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8); margin-top: 0; padding: 0 10px; margin-bottom: 30px; position: relative; z-index: 10; text-align: center; }
        #birthday-view h1 { font-size: 1.8em; color: #6f42c1; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5); text-align: center; position: relative; z-index: 10; margin-bottom: 15px; overflow: hidden; }
        #birthday-view h1::after { content: 'âœ¨'; position: absolute; top: -5px; right: -10px; font-size: 0.8em; opacity: 0; animation: sparkle 2.5s infinite ease-in-out; animation-delay: 0.5s; z-index: 11; }
        @keyframes sparkle { 0%, 100% { opacity: 0; transform: scale(0.5) rotate(0deg); } 25%, 75% { opacity: 0.8; transform: scale(1) rotate(15deg); } 50% { opacity: 0.5; transform: scale(0.8) rotate(-10deg); } }
        #birthday-view hr { position: relative; z-index: 10; margin-top: 30px; border: 0; height: 1px; background: #ccc; }
        #birthday-view .footer-text { text-align: center; color: #333; text-shadow: 0 0 3px rgba(255,255,255,0.6); position: relative; z-index: 10; padding-bottom: 20px; font-size: 0.9em; }

        /* --- Love Letter View Styles --- */
        #love-letter-view h1 { font-size: 1.6em; color: #d9534f; text-align: center; margin-bottom: 25px; font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "å¾®è½¯é›…é»‘", system-ui, sans-serif; position: relative; padding: 0 30px; z-index: 2; }
        #love-letter-view h1::before { content: 'ğŸ‚'; position: absolute; left: 5px; top: 50%; transform: translateY(-50%); font-size: 0.9em; z-index: 3;}
        #love-letter-view h1::after { content: 'â¤ï¸'; position: absolute; right: 5px; top: 50%; transform: translateY(-50%); font-size: 0.9em; z-index: 3;}
        /* é»˜è®¤ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ */
        #love-letter-view p {
            font-family: 'MyCustomLetterFont', 'KaiTi', 'STKaiti', 'SimSun', serif;
            margin-bottom: 1.3em; text-indent: 2em; font-size: 1em; position: relative; z-index: 2;
            overflow-wrap: break-word; word-wrap: break-word;
            transition: font-family 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
        }
        #love-letter-view .signature {
            font-family: 'MyCustomLetterFont', 'KaiTi', 'STKaiti', 'SimSun', serif;
            text-align: right; margin-top: 30px; font-style: italic; line-height: 1.6; font-size: 0.95em; position: relative; z-index: 2;
            word-break: break-word;
            transition: font-family 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
        }
        /* --- MODIFIED: æ·»åŠ ç±»ä»¥åˆ‡æ¢åˆ°é»˜è®¤å­—ä½“ --- */
        #love-letter-view.love-letter-default-font p,
        #love-letter-view.love-letter-default-font .signature {
             font-family: 'KaiTi', 'STKaiti', 'SimSun', serif; /* ä½¿ç”¨åå¤‡å­—ä½“ */
        }
        /* --- MODIFIED: å­—ä½“åˆ‡æ¢æŒ‰é’®æ ·å¼ --- */
        #font-toggle-button {
            display: inline-block; /* æˆ–è€… block çœ‹å¸ƒå±€éœ€è¦ */
            margin: 15px 10px 0 10px; /* è°ƒæ•´ä¸å…¶ä»–æŒ‰é’®çš„é—´è· */
            padding: 8px 15px;
            background-color: #ff75ac; /* ç²‰è‰²æŒ‰é’® */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "å¾®è½¯é›…é»‘", system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.2s ease;
        }
        #font-toggle-button:hover {
            background-color: #ff5c9a;
        }
        /* --- MODIFIED: è®©ä¸¤ä¸ªæŒ‰é’®åœ¨åŒä¸€è¡Œæ˜¾ç¤º (å¦‚æœéœ€è¦) --- */
        .love-letter-buttons {
            text-align: center; /* è®©æŒ‰é’®å±…ä¸­ */
            margin-top: 30px;
        }
        .love-letter-buttons button {
            margin-left: 10px;
            margin-right: 10px;
        }

        #love-letter-view .back-button { display: inline-block; margin: 15px 10px 0 10px; padding: 12px 25px; background-color: #6f42c1; color: white; text-decoration: none; border-radius: 8px; font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "å¾®è½¯é›…é»‘", system-ui, sans-serif; cursor: pointer; border: none; font-size: 1.1em; width: fit-content; position: relative; z-index: 10; -webkit-tap-highlight-color: transparent; }
        #love-letter-view .back-button:hover { background-color: #5a349a; }


        /* --- Falling Items Styles --- */
        .falling-item { position: absolute; top: -60px; font-size: 22px; user-select: none; pointer-events: none; animation: fall linear forwards; opacity: 0.75; z-index: 5; will-change: transform, opacity; }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity: 0.75; } 100% { transform: translateY(calc(100vh + 100px)) rotate(calc(var(--random-rotate, 0) * 1deg)); opacity: 0; } }

        /* --- Pointer Trail Heart Styles --- */
        .pointer-heart {
            position: absolute;
            font-size: 18px; color: #ff4d6d; pointer-events: none; user-select: none;
            z-index: 9999;
            animation: fade-move-out-quick 0.6s ease-out forwards;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
        }
        @keyframes fade-move-out-quick { 0% { opacity: 0.9; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -120%) scale(0.3); } }

        /* --- Slideshow Styles --- */
        #photo-slideshow-container { position: relative; z-index: 10; max-width: 500px; margin: 20px auto; padding: 20px; background-color: rgba(255, 240, 245, 0.85); border-radius: 25px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border: 10px solid transparent; border-image: linear-gradient(45deg, #ffc2d1, #ff8fab, #fecaca) 1; }
        #slideshow-wrapper { position: relative; overflow: hidden; border-radius: 15px; aspect-ratio: 4 / 3; background-color: #eee; }
        #slideshow { display: flex; width: 100%; height: 100%; transition: transform 0.5s ease-in-out; }
        .slide { min-width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .slide img { display: block; width: 100%; height: 100%; object-fit: cover; }
        .slideshow-nav { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(255, 194, 209, 0.7); border: none; color: #fff; font-size: 1.5em; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 15; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; line-height: 1; box-shadow: 0 1px 3px rgba(0,0,0,0.2); -webkit-tap-highlight-color: transparent; }
        .slideshow-nav:hover { background-color: rgba(255, 127, 171, 0.9); }
        .slideshow-nav.prev { left: -15px; }
        .slideshow-nav.next { right: -15px; }
        .dots-container { text-align: center; margin-top: 10px; position: relative; z-index: 15; }
        .dot { display: inline-block; width: 10px; height: 10px; background-color: #ffc2d1; border-radius: 50%; margin: 0 5px; cursor: pointer; transition: background-color 0.3s ease; }
        .dot.active { background-color: #ff75ac; }
        #slideshow-caption { text-align: center; margin-top: 12px; font-size: 0.95em; color: #665; padding: 5px; min-height: 1.5em; font-style: italic; background-color: rgba(255, 255, 255, 0.3); border-radius: 5px; }

        /* --- Click Arrow Styles --- */
        .click-arrow { width: 0; height: 0; border-style: solid; position: absolute; z-index: 11; pointer-events: none; animation: bounce-arrow 1.5s infinite ease-in-out; opacity: 0.8; }
        .arrow-tr { border-width: 15px 15px 0 0; border-color: #ff75ac transparent transparent transparent; top: 10px; left: 10px; transform: rotate(135deg); animation-delay: 0s; }
        .arrow-tl { border-width: 15px 15px 0 0; border-color: #ff75ac transparent transparent transparent; top: 10px; right: 10px; transform: rotate(225deg); animation-delay: 0.5s; }
        .arrow-br { border-width: 15px 15px 0 0; border-color: #ff75ac transparent transparent transparent; bottom: 10px; left: 10px; transform: rotate(45deg); animation-delay: 1s; }
        @keyframes bounce-arrow { 0%, 100% { transform: translateY(0) rotate(var(--rotate-angle)); opacity: 0.8; } 50% { transform: translateY(-8px) rotate(var(--rotate-angle)); opacity: 0.6; } }
        .arrow-tr { --rotate-angle: 135deg; }
        .arrow-tl { --rotate-angle: 225deg; }
        .arrow-br { --rotate-angle: 45deg; }

        /* --- Custom Audio Player Styles --- */
        #audio-player-container { position: fixed; bottom: 10px; right: 10px; left: auto; transform: none; width: 85%; max-width: 320px; z-index: 10000; background: rgba(255, 222, 233, 0.7); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); border-radius: 10px; padding: 8px 12px; box-shadow: 0 -1px 8px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px; cursor: move; touch-action: none; }
        #play-pause-button { background-color: #ff75ac; border: none; color: white; font-size: 1.3em; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; flex-shrink: 0; padding: 0; line-height: 1; box-shadow: 0 1px 3px rgba(0,0,0,0.15); -webkit-tap-highlight-color: transparent; }
        #play-pause-button:hover { background-color: #ff5c9a; }
        #play-pause-button .play-icon::before { content: 'â–¶ï¸'; }
        #play-pause-button .pause-icon::before { content: 'â¸ï¸'; }
        .audio-controls-right { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        #song-title { font-size: 0.8em; color: #7a4f68; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 2px; }
        #seek-bar { width: 100%; height: 6px; cursor: pointer; appearance: none; background: #ffc2d1; border-radius: 3px; outline: none; }
        #seek-bar::-webkit-slider-thumb { appearance: none; width: 14px; height: 14px; background: #ff75ac; border-radius: 50%; cursor: pointer; box-shadow: 0 0 2px rgba(0,0,0,0.2); }
        #seek-bar::-moz-range-thumb { width: 14px; height: 14px; background: #ff75ac; border-radius: 50%; cursor: pointer; border: none; box-shadow: 0 0 2px rgba(0,0,0,0.2); }
        .time-display { display: flex; justify-content: space-between; font-size: 0.75em; color: #8c5f6f; margin-top: 0px; padding: 0 2px; }
        #audio-element { display: none; }

        /* --- Cat Pendant Styles --- */
        #cat-pendant { position: fixed; top: 15px; left: 15px; width: 60px; height: 60px; z-index: 9998; cursor: move; overflow: visible; background-color: transparent; transition: transform 0.2s ease; -webkit-tap-highlight-color: transparent; touch-action: none; }
        #cat-pendant:hover { transform: scale(1.1); }
        #cat-pendant img { display: block; width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        #cat-pendant.rolling { animation: cat-roll 0.7s linear; }
        @keyframes cat-roll { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Cat Dialog Box Styles */
        #cat-dialog { position: absolute; top: 50%; left: 110%; transform: translateY(-50%); min-width: 180px; max-width: 220px; padding: 10px 15px; border-radius: 8px; background-color: rgba(255, 192, 203, 0.75); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); box-shadow: 0 2px 8px rgba(0,0,0,0.2); color: #444; font-size: 0.9em; text-align: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-out, visibility 0s linear 0.3s; z-index: 1; pointer-events: none; }
        #cat-dialog::after { content: ''; position: absolute; top: 50%; right: 100%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; border-width: 8px 8px 8px 0; border-color: transparent rgba(255, 192, 203, 0.75) transparent transparent; }
        #cat-dialog.visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease-out, visibility 0s linear 0s; }

        /* Media Query Adjustments */
        @media (max-width: 600px) {
             #photo-slideshow-container { max-width: 95%; padding: 10px; border-width: 8px; }
             .slideshow-nav { width: 35px; height: 35px; font-size: 1.3em; }
             .slideshow-nav.prev { left: -10px; } .slideshow-nav.next { right: -10px; }
             .dot { width: 8px; height: 8px; margin: 0 4px;}
             #audio-player-container { max-width: 280px; }
             #love-letter-view::before { border-width: 45px 0 0 calc(50vw - 10px); }
             #love-letter-view::after { border-width: 0 0 45px calc(50vw - 10px); }
             #love-letter-view { padding-top: 45px; margin-top: 30px;}
             .click-arrow { border-width: 10px 10px 0 0; }
             .arrow-tr { top: 5px; left: 5px;} .arrow-tl { top: 5px; right: 5px;} .arrow-br { bottom: 5px; left: 5px;}
             #cat-pendant { width: 50px; height: 50px; top: 10px; left: 10px; }
             #cat-dialog { font-size: 0.8em; min-width: 150px; left: 115%; }
             #slideshow-caption { font-size: 0.9em;}
             #love-letter-view .signature { font-size: 0.9em; }
             /* --- MODIFIED: è°ƒæ•´æŒ‰é’®é—´è· for small screens --- */
             .love-letter-buttons button { font-size: 0.9em; padding: 10px 15px; }
             #font-toggle-button { padding: 6px 10px; font-size: 0.8em;}

        }
        @media (max-width: 360px) {
             #birthday-view h1, #love-letter-view h1 { font-size: 1.5em; }
             #love-letter-view h1 { padding: 0 25px; }
             #love-letter-view h1::before, #love-letter-view h1::after { font-size: 0.8em; }
             #birthday-message { font-size: 1.3em; }
             #love-letter-view p { font-size: 0.92em; text-indent: 1.5em; }
             #love-letter-view .signature { font-size: 0.8em; /* Further adjust */ }
             .falling-item { font-size: 20px; } .pointer-heart { font-size: 18px; }
             #audio-player-container { width: 95%; gap: 5px; padding: 5px 8px; max-width: 95%; }
             #play-pause-button { width: 35px; height: 35px; font-size: 1.1em; }
             .time-display { font-size: 0.7em; } #song-title { font-size: 0.7em; }
             #seek-bar::-webkit-slider-thumb { width: 12px; height: 12px; }
             #seek-bar::-moz-range-thumb { width: 12px; height: 12px; }
             #cat-pendant { width: 45px; height: 45px; }
             #cat-dialog { left: 120%; }
             /* --- MODIFIED: è°ƒæ•´æŒ‰é’®é—´è· for extra small screens --- */
             .love-letter-buttons { margin-top: 20px; }
             .love-letter-buttons button { font-size: 0.85em; padding: 8px 12px; margin-left: 5px; margin-right: 5px;}
             #font-toggle-button { padding: 5px 8px; font-size: 0.75em;}
        }

    </style>
</head>
<body>
    <div id="cat-pendant">
        <img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/static-cat-placeholder.png" alt="çŒ«å’ªæŒ‚ä»¶ (ç‚¹å‡»æ‰“æ»š)">
        <div id="cat-dialog"></div>
    </div>

    <div id="background-layer"></div>
    <div id="background-overlay"></div>

    <div id="birthday-view">
        <h1>âœ¨ ç”Ÿæ—¥å¿«ä¹ âœ¨</h1>
        <div class="birthday-container">
            <a id="birthday-cake-link" href="#">
                <div class="click-arrow arrow-tr"></div>
                <div class="click-arrow arrow-tl"></div>
                <div class="click-arrow arrow-br"></div>
                <img id="birthday-cake" src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/cake-placeholder.jpg" alt="ç”Ÿæ—¥è›‹ç³• (ç‚¹å‡»æœ‰æƒŠå–œ)">
            </a>
            <p id="birthday-message">æœ¬å°‘çˆ·ç¥ä½ ç®€ç®€å•å•ï¼Œå¿«å¿«ä¹ä¹ï¼Œå¹¸å¹¸ç¦ç¦çš„è¿‡å®Œ21å²ã€‚</p>
            <p class="footer-text">ç¥ä½ æ‹¥æœ‰ç¾å¥½çš„ä¸€å¤©ï¼ (ç‚¹å‡»è›‹ç³•æœ‰æƒŠå–œå“¦!)</p>
        </div>
        <div id="photo-slideshow-container">
            <div id="slideshow-wrapper">
                <div id="slideshow">
                    <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder1.jpg" alt="çŠçŠçš„ç…§ç‰‡ 1"></div>
                    <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder2.jpg" alt="çŠçŠçš„ç…§ç‰‡ 2"></div>
                    <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder3.png" alt="çŠçŠçš„ç…§ç‰‡ 3"></div>
                    <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder4.jpg" alt="çŠçŠçš„ç…§ç‰‡ 4"></div>
                    <div class="slide"><img src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/placeholder5.png" alt="çŠçŠçš„ç…§ç‰‡ 5"></div>
                </div>
            </div>
            <button class="slideshow-nav prev" aria-label="ä¸Šä¸€å¼ ">ğŸ‚</button>
            <button class="slideshow-nav next" aria-label="ä¸‹ä¸€å¼ ">ğŸ‚</button>
            <div class="dots-container"></div>
            <div id="slideshow-caption">ç…§ç‰‡æè¿°ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
        </div>
        <hr>
        <p class="footer-text">çŠçŠï¼Œç”Ÿæ—¥å¿«ä¹ï¼</p>
        <p class="footer-text">ğŸ’å°çŒ´å­åˆé•¿å¤§ä¸€å²å•¦ã€‚æ„¿è¿™ä¸€å¹´ï¼Œæ¸©æš–å’Œå¥½è¿éƒ½å¥”ä½ è€Œæ¥ï¼Œæ‰€æœ‰çš„ä»˜å‡ºéƒ½æœ‰å›æŠ¥ï¼Œæ‰€æœ‰çš„ç¬‘å®¹éƒ½å‘è‡ªçœŸå¿ƒã€‚å¸Œæœ›ä½ èƒ½æ„Ÿå—åˆ°ï¼Œä¸€ç›´æœ‰äººåœ¨é»˜é»˜å…³å¿ƒå’Œç¥ç¦ç€ä½ ã€‚æœªæ¥çš„æ—¥å­ï¼Œæ— è®ºæ™´é›¨ï¼Œå¸Œæœ›èƒ½æœ‰æœºä¼šç»§ç»­åˆ†äº«å½¼æ­¤çš„é£æ™¯~</p>
    </div>

    <div id="love-letter-view">
        <h1>è‡´ æˆ‘ç‹¬ä¸€æ— äºŒçš„ã€æœ€ç‰¹åˆ«çš„çŠçŠ â¤ï¸</h1>
        <p>æç¬”æƒ³ç»™ä½ å†™ç‚¹ä»€ä¹ˆï¼Œå°¤å…¶æ˜¯åœ¨ä½ ç”Ÿæ—¥å°†è¿‘çš„æ—¥å­ï¼Œå¿ƒæƒ…æœ‰ç‚¹åƒé‚£æ¬¡å’Œä½ çº¿ä¸‹è§é¢æ—¶â€”â€”æ—¢æœŸå¾…åˆç´§å¼ ï¼Œè¿˜å¸¦ç€ç‚¹æˆ‘ä»¬ä¹‹é—´ç‰¹æœ‰çš„â€œç™«â€ã€‚å¿«ä¸€å¹´äº†ï¼Œæ—¶é—´å¥½åƒè¿‡å¾—é£å¿«ï¼Œåˆå¥½åƒæ¯ä¸€å¤©çš„èŠå¤©éƒ½å€¼å¾—è¢«ç»†ç»†å›å‘³ã€‚</p>
        <p>è¿˜è®°å¾—å—ï¼Ÿä»æœ€åˆé‚£ä¸ªå«æˆ‘â€œå°å±å­©â€æ€¼å¾—æˆ‘å·®ç‚¹æ‹‰é»‘ä½ çš„â€œå¼ ä¸‰â€ï¼ˆå½“ç„¶æ˜¯ç©ç¬‘ï¼Œæˆ‘å“ªé‡Œèˆå¾—æ‹‰é»‘çš‡åå¨˜å¨˜ï¼‰ï¼Œåˆ°åæ¥é‚£ä¸ªä¼šå‘ææ€ªè¡¨æƒ…åŒ…ã€ä¼šåœ¨è¯­éŸ³é‡Œå·ç¬‘çš„â€œçš‡åå¨˜å¨˜â€ï¼Œå†åˆ°é‚£ä¸ªå˜´ä¸Šè¯´ç€â€œä¸è°ˆæ‹çˆ±â€ã€â€œæˆ‘å°±æ˜¯æ¸£å¥³â€ï¼Œå´ä¼šå› ä¸ºæ‹…å¿ƒæˆ‘è€Œé€€å›çº¢åŒ…ã€ä¼šå› ä¸ºæˆ‘éœ€è¦è€Œç”¨èŠ±å‘—ä¹°é¼ æ ‡ã€ä¼šåœ¨æˆ‘â€œå‘ç™«â€åä¾ç„¶ä¸»åŠ¨é—®æ—©çš„â€œå‚»å§‘å¨˜â€â€¦â€¦ä½ èº«ä¸Šè¿™ç§çŸ›ç›¾åˆçœŸå®çš„å¯çˆ±ï¼Œå°±åƒæ‹†ç›²ç›’ï¼Œæ€»èƒ½ç»™æˆ‘æ„æƒ³ä¸åˆ°çš„æƒŠå–œã€‚</p>
        <p>ä»¥å‰æ€»è§‰å¾—ä¸–äº‹çº·æ‰°ï¼Œäººå¿ƒå¤æ‚éš¾æµ‹ï¼Œç›´åˆ°é‡è§ä½ ï¼Œæ‰æ˜ç™½é‚£å¥â€œä¼—é‡Œå¯»ä»–åƒç™¾åº¦ï¼Œè“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„â€æˆ–è®¸æ˜¯çœŸçš„ã€‚ ä½ çš„å‡ºç°ï¼Œåƒä¸€é“å…‰ï¼Œç…§äº®äº†æˆ‘ä¹‹å‰å¯èƒ½æœ‰äº›ç°æš—å’Œå……æ»¡â€œç²¾ç¥å†…è€—â€çš„ä¸–ç•Œã€‚æ˜¯ä½ ç”¨ä½ çš„â€œç™«â€ã€ä½ çš„å–„è‰¯ã€ä½ çš„åŸåˆ™ï¼Œè¿˜æœ‰ä½ é‚£é¢å¯¹ç”Ÿæ´»ä¸æ˜“æ—¶çš„éŸ§æ€§ï¼Œè®©æˆ‘è§‰å¾—è¿™ä¸ªä¸–ç•ŒåŸæ¥è¿˜å¯ä»¥è¿™ä¹ˆæœ‰è¶£å’Œå€¼å¾—æœŸå¾…ã€‚å’Œä½ èŠå¤©æˆäº†æˆ‘æ¯å¤©é›·æ‰“ä¸åŠ¨çš„ä¹ æƒ¯å’Œæœ€å¤§çš„ä¹è¶£ï¼Œä½ åˆ†äº«çš„æ—¥å¸¸çç¢ï¼Œåœ¨æˆ‘è¿™é‡Œéƒ½å˜æˆäº†å€¼å¾—çè—çš„é£æ™¯ã€‚</p>
        <p>æˆ‘çŸ¥é“ï¼Œæˆ‘ä»¬ä¹‹é—´è¿™ç§â€œç¾ç»Šâ€å¾ˆç‰¹åˆ«ï¼Œæ·±åˆ°æœ‰æ—¶è¿æˆ‘ä»¬è‡ªå·±éƒ½éš¾ä»¥ç®€å•å®šä¹‰ã€‚æ²¡å…³ç³»ï¼Œâ€œèº«æ— å½©å‡¤åŒé£ç¿¼ï¼Œå¿ƒæœ‰çµçŠ€ä¸€ç‚¹é€šâ€ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘è§‰å¾—ä½ æ‡‚æˆ‘å†…å¿ƒé‚£äº›æœªè¯´å‡ºå£çš„ç„¦è™‘å’ŒæœŸç›¼ï¼Œæˆ‘ä¹Ÿåœ¨åŠªåŠ›å»ç†è§£ä½ é‚£å¥â€œæ…¢æ…¢æ¥å§â€èƒŒåå¯èƒ½éšè—çš„é¡¾è™‘å’Œéœ€è¦ã€‚æ„Ÿè°¢ä½ æ„¿æ„å‘æˆ‘æ•å¼€é‚£ä¹ˆå¤šï¼Œä¿¡ä»»æˆ‘è¿™ä¹ˆå¤šã€‚</p>
        <p>æˆ‘ä¹ŸçŸ¥é“ï¼Œä½ å¿ƒé‡Œå¯èƒ½è£…ç€å¯¹è¿‡å»çš„æ‹…å¿§ï¼Œå¯¹æœªæ¥çš„ä¸ç¡®å®šï¼Œå¯¹â€œå…³ç³»â€æœ¬èº«çš„ææƒ§ã€‚æˆ‘ä¸ä¼šå†åƒä»¥å‰é‚£æ ·ï¼Œæ€¥åˆ‡åœ°é€¼ä½ ç»™ä¸€ä¸ªç­”æ¡ˆï¼Œä¹Ÿä¸ä¼šå†å¼€é‚£äº›ä¸åˆæ—¶å®œçš„ç©ç¬‘äº†ï¼ˆå¦‚æœæˆ‘åˆâ€œç™«â€äº†ï¼Œè®°å¾—ç”¨è¡¨æƒ…åŒ…æé†’æˆ‘å“¦ï¼‰ã€‚ä½ çš„ç”Ÿæ—¥ï¼Œæˆ‘æœ€å¤§çš„ã€ä¹Ÿæ˜¯å”¯ä¸€çš„å¿ƒæ„¿ï¼Œå°±æ˜¯ä½ èƒ½çœŸæ­£åœ°ã€æ¯«æ— è´Ÿæ‹…åœ°å¼€å¿ƒã€‚ä½ æƒ³æ€ä¹ˆè¿‡ï¼Œæˆ‘éƒ½æ”¯æŒã€‚</p>
        <p>è¿™å°ä¿¡ï¼Œä¸æ˜¯ä¸ºäº†åœ¨ç”Ÿæ—¥è¿™å¤©ç»™ä½ å‹åŠ›ï¼ŒçœŸçš„ã€‚å®ƒå°±æ˜¯ä¸€ä»½è¿Ÿæ¥çš„æ„Ÿè°¢ä¿¡â€”â€”æ„Ÿè°¢ç¼˜åˆ†è®©æˆ‘ä»¬ç›¸é‡ï¼Œæ„Ÿè°¢ä½ é™ªæˆ‘åº¦è¿‡è¿™ä¹ˆå¤šæ—¶å…‰ï¼Œåˆ†äº«è¿™ä¹ˆå¤šæ¬¢ç¬‘å’Œ emo çš„ç¬é—´ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä»½å¿ƒæ„ä¹¦â€”â€”å‘Šè¯‰ä½ ï¼Œåœ¨æˆ‘å¿ƒé‡Œï¼Œä½ æœ‰å¤šä¹ˆé‡è¦å’Œç‹¬ä¸€æ— äºŒã€‚</p>
        <p>è‡³äºæœªæ¥ï¼Œæˆ‘ä»¬ç»§ç»­â€œèµ°ä¸€æ­¥çœ‹ä¸€æ­¥â€å§ã€‚â€œäººç”Ÿåˆ°å¤„çŸ¥ä½•ä¼¼ï¼Œåº”ä¼¼é£é¸¿è¸é›ªæ³¥ã€‚â€ æœªæ¥ä¸å¯é¢„çŸ¥ï¼Œä½†é‡è¦çš„æ˜¯ï¼Œæˆ‘å¸Œæœ›èƒ½ç»§ç»­é™ªåœ¨ä½ èº«è¾¹ï¼Œå’Œä½ ä¸€èµ·é¢å¯¹è·¯ä¸Šçš„é£æ™¯ï¼Œæ— è®ºæ˜¯æ™´æ˜¯é›¨ã€‚æ„¿å¦‚æ­¤ç¼˜ï¼Œèƒ½ç»­ç»å¹´ã€‚</p>
        <p>ç”Ÿæ—¥å¿«ä¹ï¼Œæˆ‘æœ€çè§†çš„çŠçŠã€‚</p>
        <div class="signature">é‚£ä¸ªè¶Šæ¥è¶Šæ‡‚å¾—çæƒœä½ çš„â€œç™«å…¬â€ï¼Œå“¥å“¥æˆ–è€…å°‘çˆ·ï¼Œ<br>ç« å•¸å®‡</div>

            <div class="love-letter-buttons">
            <button id="font-toggle-button">åˆ‡æ¢å­—ä½“</button> 
            <button class="back-button">è¿”å›ç”Ÿæ—¥ä¸»é¡µé¢</button>
        </div>
    </div>

    <div id="audio-player-container">
        <audio id="audio-element" loop>
            <source src="https://123456-1327245719.cos.ap-guangzhou.myqcloud.com/zss/M5000044Nr9A4ZiFFQ.mp3" type="audio/mpeg">
            ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾éŸ³é¢‘ã€‚
        </audio>
        <button id="play-pause-button" aria-label="æ’­æ”¾"><span class="play-icon"></span></button>
        <div class="audio-controls-right">
            <div id="song-title">ç”Ÿæ—¥å¿«ä¹æ­Œ</div>
            <input type="range" id="seek-bar" value="0" aria-label="è¿›åº¦æ¡">
            <div class="time-display">
                <span id="current-time">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>
    </div>

    <script>
        // --- Existing Variables and Setup ---
        const birthdayView = document.getElementById('birthday-view');
        const loveLetterView = document.getElementById('love-letter-view');
        const cakeLink = document.getElementById('birthday-cake-link');
        const backButton = loveLetterView.querySelector('.back-button');
        const audioElement = document.getElementById('audio-element');
        const audioPlayerContainer = document.getElementById('audio-player-container');
        const playPauseButton = document.getElementById('play-pause-button');
        const playIcon = playPauseButton ? playPauseButton.querySelector('.play-icon') : null;
        const seekBar = document.getElementById('seek-bar');
        const currentTimeDisplay = document.getElementById('current-time');
        const durationDisplay = document.getElementById('duration');
        const slideshowContainer = document.getElementById('photo-slideshow-container');
        const catPendant = document.getElementById('cat-pendant');
        const catDialog = document.getElementById('cat-dialog');
        const fontToggleButton = document.getElementById('font-toggle-button'); // --- MODIFIED: è·å–æ–°æŒ‰é’® ---

        let birthdayIntervalId = null;
        let loveLetterIntervalId = null;
        const birthdayItems = ['ğŸ‚', 'ğŸŒ¸'];
        const loveLetterItems = ['â¤ï¸', 'ğŸ‚'];
        const BIRTHDAY_INTERVAL_TIME = 550;
        const LOVE_LETTER_INTERVAL_TIME = 500;

        const slideshow = document.getElementById('slideshow');
        const slides = document.querySelectorAll('.slide');
        const prevButton = document.querySelector('.slideshow-nav.prev');
        const nextButton = document.querySelector('.slideshow-nav.next');
        const dotsContainer = document.querySelector('.dots-container');
        const slideshowCaption = document.getElementById('slideshow-caption');
        let currentSlideIndex = 0;
        let slideInterval = null;
        const slideCount = slides.length;
        const SLIDESHOW_INTERVAL_TIME = 5000;

        let catDialogTimeout = null;
        const slideCaptions = ["å†¬æ—¥æš–æ„ï¼Œå›´å·¾å’Œä½ ã€‚ğŸ§£", "åœ¨é€ƒå…¬ä¸»ã®å©šç¤¼å®å½•ğŸ‘‘", "å…³äºä¸»æ’­ä¸Šæ’­åè¢«ç–¯ç‹‚æˆªå±è¿™ä»¶äº‹ğŸ“¸", "ä¸‰æœˆæ•æ‰åˆ°çš„â€˜æ£è›‹é¬¼â€™ï¼è¿™ä¸ªè°ƒçš®åˆå¯çˆ±çš„è¡¨æƒ…ï¼ŒçŠ¯è§„äº†å“¦~ğŸ˜‹", "æ›¿ç« è€æ¿å¥½å¥½é™ªç€å§å§å“¦ï¼Œå²è¿ªå¥‡ï¼ğŸ¤ª"];
        let firstCatClick = true;
        const initialDialog = ["ç½‘é¡µå¼€å‘æ—¥å¿—ï¼š1ä¸ªBUGä¿®äº†8å°æ—¶ğŸ™ƒ"];
        const randomDialogs = ["å–µ~ç« æ€»å’Œå¼ ç¾äººå¤´å‘+1æ ¹", "BUGä¿®å®Œäº†ï¼Ÿä¸ï¼Œæ˜¯å»æ’¸é“äº†ğŸ’ª", "ç‚¹å‡»10æ¬¡è§£é”çŠçŠç«¥å¹´ç…§ğŸ‘€"];
        const rateLimitDialog = "å–µçš„ï¼Œå¥³äººï¼Œåˆ«æ’¸äº†ï¼Œå¿«è¢«ä½ è€—æˆå’Œä½ ä¸€æ ·çš„ç§ƒå¤´çŒ«å’ªäº†ğŸ˜¡";
        let recentCatClicks = [];
        const CAT_CLICK_LIMIT = 20;
        const CAT_CLICK_WINDOW = 60000;

        let isSeeking = false;

        // --- å°è¯•æ’­æ”¾éŸ³ä¹çš„å‡½æ•° ---
        function tryPlayAudio() {
            if (audioElement && audioElement.paused) {
                audioElement.play().then(() => {
                    updatePlayPauseIcon();
                }).catch(error => {
                    console.error("å°è¯•æ’­æ”¾éŸ³é¢‘å¤±è´¥:", error);
                });
            }
        }

        // --- Falling Items Functions ---
        function createFallingItem(itemType, container) { if (!container || container.style.display === 'none') return; const item = document.createElement('div'); item.classList.add('falling-item'); item.style.left = Math.random() * 95 + 'vw'; item.innerText = itemType; item.style.fontSize = (Math.random() * 10 + 18) + 'px'; const fallDuration = Math.random() * 5 + 7; const delay = Math.random() * 4; item.style.setProperty('--random-rotate', (Math.random() * 80 - 40) || 0); item.style.animationDuration = `${fallDuration}s`; item.style.animationDelay = delay + 's'; container.appendChild(item); setTimeout(() => { if (item && item.parentNode) item.remove(); }, (fallDuration + delay) * 1000 + 500); }
        function startFallingItems(intervalId, itemArray, container, intervalTime) { if (intervalId) clearInterval(intervalId); if (!container) return null; const newIntervalId = setInterval(() => { if (container.style.display !== 'none') { const randomItem = itemArray[Math.floor(Math.random() * itemArray.length)]; createFallingItem(randomItem, container); } }, intervalTime); return newIntervalId; }
        function stopFallingItems(intervalId, container) { if (intervalId) clearInterval(intervalId); if (container) { const existingItems = container.querySelectorAll('.falling-item'); existingItems.forEach(item => item.remove()); } return null; }

        // --- View Switching Logic ---
        if (cakeLink) {
             cakeLink.addEventListener('click', (event) => {
                 event.preventDefault();
                 showLoveLetter();
                 tryPlayAudio(); // ç‚¹å‡»è›‹ç³•å°è¯•æ’­æ”¾
             });
         }
        if (backButton) { backButton.addEventListener('click', showBirthday); }
        function showLoveLetter() { birthdayIntervalId = stopFallingItems(birthdayIntervalId, birthdayView); if(birthdayView) birthdayView.style.display = 'none'; if(loveLetterView) loveLetterView.style.display = 'block'; loveLetterIntervalId = startFallingItems(loveLetterIntervalId, loveLetterItems, loveLetterView, LOVE_LETTER_INTERVAL_TIME); window.scrollTo(0, 0); updatePlayPauseIcon(); stopSlideshowAutoplay(); }
        function showBirthday() { loveLetterIntervalId = stopFallingItems(loveLetterIntervalId, loveLetterView); if(loveLetterView) loveLetterView.style.display = 'none'; if(birthdayView) birthdayView.style.display = 'block'; birthdayIntervalId = startFallingItems(birthdayIntervalId, birthdayItems, birthdayView, BIRTHDAY_INTERVAL_TIME); window.scrollTo(0, 0); updatePlayPauseIcon(); startSlideshowAutoplay(); }

        // --- Pointer Trail Heart Logic ---
        function throttle(func, limit) { let inThrottle; return function() { const args = arguments; const context = this; if (!inThrottle) { func.apply(context, args); inThrottle = true; setTimeout(() => inThrottle = false, limit); } } }
        function createPointerHeart(x, y) { if (!document.body) return; const heart = document.createElement('div'); heart.classList.add('pointer-heart'); heart.innerHTML = 'â¤ï¸'; heart.style.left = `${x}px`; heart.style.top = `${y}px`; document.body.appendChild(heart); setTimeout(() => { if (heart && heart.parentNode) { heart.remove(); } }, 600); }
        const throttledCreateHeart = throttle(createPointerHeart, 100);
        document.body.addEventListener('mousemove', (event) => { throttledCreateHeart(event.pageX, event.pageY); });
        document.body.addEventListener('touchmove', (event) => { if (event.touches.length > 0) { const touch = event.touches[0]; throttledCreateHeart(touch.pageX, touch.pageY); } }, { passive: true });
        document.body.addEventListener('touchstart', (event) => { if (event.touches.length > 0) { const touch = event.touches[0]; throttledCreateHeart(touch.pageX, touch.pageY); } }, { passive: true });

        // --- Custom Audio Player Logic ---
        function formatTime(seconds) {
            const secs = Math.floor(seconds || 0);
            const minutes = Math.floor(secs / 60);
            const remainingSeconds = secs % 60;
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
        function updatePlayPauseIcon() {
             if (!playIcon || !audioElement || !playPauseButton) return;
             playIcon.classList.remove('play-icon', 'pause-icon');
             if (audioElement.paused || audioElement.ended) {
                 playIcon.classList.add('play-icon');
                 playPauseButton.setAttribute('aria-label', 'æ’­æ”¾');
             } else {
                 playIcon.classList.add('pause-icon');
                 playPauseButton.setAttribute('aria-label', 'æš‚åœ');
             }
         }
        if (playPauseButton && audioElement) {
            playPauseButton.addEventListener('click', () => {
                if (audioElement.paused || audioElement.ended) {
                    audioElement.play().catch(e => console.error("Error playing audio:", e));
                } else {
                    audioElement.pause();
                }
            });
        }
        if (audioElement) {
            audioElement.addEventListener('timeupdate', () => {
                if (!isSeeking && !isNaN(audioElement.duration) && seekBar && currentTimeDisplay) {
                    try {
                        seekBar.value = audioElement.currentTime;
                        currentTimeDisplay.textContent = formatTime(audioElement.currentTime);
                    } catch (e) { console.error("Error updating time:", e) }
                }
            });
            audioElement.addEventListener('loadedmetadata', () => {
                if (!isNaN(audioElement.duration) && seekBar && durationDisplay) {
                    try {
                        seekBar.max = audioElement.duration;
                        durationDisplay.textContent = formatTime(audioElement.duration);
                        updatePlayPauseIcon();
                    } catch (e) { console.error("Error on loadedmetadata:", e) }
                }
            });
            audioElement.addEventListener('play', updatePlayPauseIcon);
            audioElement.addEventListener('pause', updatePlayPauseIcon);
            audioElement.addEventListener('ended', updatePlayPauseIcon);
        }
        if (seekBar && currentTimeDisplay && audioElement) {
            seekBar.addEventListener('input', () => {
                isSeeking = true;
                try {
                    currentTimeDisplay.textContent = formatTime(parseFloat(seekBar.value) || 0);
                } catch (e) { console.error("Error updating seek bar display:", e) }
            });
            seekBar.addEventListener('change', () => {
                if (!isNaN(audioElement.duration)) {
                    try {
                        audioElement.currentTime = parseFloat(seekBar.value) || 0;
                    } catch (e) { console.error("Error setting audio time:", e) }
                }
                isSeeking = false;
            });
        }

        // --- Slideshow Logic ---
        function updateDots() { if (!dotsContainer || dotsContainer.children.length !== slideCount) return; for (let i = 0; i < slideCount; i++) { dotsContainer.children[i].classList.toggle('active', i === currentSlideIndex); } }
        function showSlide(index) { if (slideCount <= 0 || !slideshow) return; if (index >= slideCount) { currentSlideIndex = 0; } else if (index < 0) { currentSlideIndex = slideCount - 1; } else { currentSlideIndex = index; } const offset = -currentSlideIndex * 100; slideshow.style.transform = `translateX(${offset}%)`; updateDots(); if (slideshowCaption && slideCaptions.length > currentSlideIndex) { slideshowCaption.textContent = slideCaptions[currentSlideIndex]; } else if (slideshowCaption) { slideshowCaption.textContent = ''; } }
        function nextSlide() { showSlide(currentSlideIndex + 1); }
        function startSlideshowAutoplay() { stopSlideshowAutoplay(); if (slideCount > 1) { slideInterval = setInterval(nextSlide, SLIDESHOW_INTERVAL_TIME); } }
        function stopSlideshowAutoplay() { clearInterval(slideInterval); slideInterval = null; }
        if (prevButton && nextButton) {
             prevButton.addEventListener('click', () => { stopSlideshowAutoplay(); showSlide(currentSlideIndex - 1); });
             nextButton.addEventListener('click', () => { stopSlideshowAutoplay(); showSlide(currentSlideIndex + 1); });
         }
        function createDots() { if (!dotsContainer || slideCount <= 0) return; dotsContainer.innerHTML = ''; for (let i = 0; i < slideCount; i++) { const dot = document.createElement('span'); dot.classList.add('dot'); dot.dataset.index = i; dot.setAttribute('aria-label', `è·³è½¬åˆ°ç…§ç‰‡ ${i + 1}`); dot.addEventListener('click', (e) => { stopSlideshowAutoplay(); const index = parseInt(e.target.dataset.index); showSlide(index); }); dotsContainer.appendChild(dot); } updateDots(); }
        if (slideshowContainer) {
            slideshowContainer.addEventListener('click', () => {
                tryPlayAudio(); // ç‚¹å‡»ç…§ç‰‡åŒºåŸŸå°è¯•æ’­æ”¾
            });
        }

        // --- Draggable Elements Logic ---
        let dragTarget = null; let isDragging = false; let offsetX, offsetY;
        function makeDraggable(element) { if (!element) return; element.style.cursor = 'move'; function dragStartHandler(event) { dragTarget = element; isDragging = true; dragTarget.style.transition = 'none'; let clientX, clientY; if (event.type === 'touchstart') { clientX = event.touches[0].clientX; clientY = event.touches[0].clientY; } else { clientX = event.clientX; clientY = event.clientY; event.preventDefault(); } const rect = dragTarget.getBoundingClientRect(); offsetX = clientX - rect.left; offsetY = clientY - rect.top; if (dragTarget.style.left === 'auto' || dragTarget.style.top === 'auto' || !dragTarget.style.left || !dragTarget.style.top) { dragTarget.style.left = `${rect.left}px`; dragTarget.style.top = `${rect.top}px`; dragTarget.style.right = 'auto'; dragTarget.style.bottom = 'auto'; dragTarget.style.transform = 'none'; } document.addEventListener('mousemove', draggingHandler); document.addEventListener('touchmove', draggingHandler, { passive: false }); document.addEventListener('mouseup', dragEndHandler); document.addEventListener('touchend', dragEndHandler); } function draggingHandler(event) { if (!isDragging || !dragTarget) return; let currentX, currentY; if (event.type === 'touchmove') { event.preventDefault(); currentX = event.touches[0].clientX; currentY = event.touches[0].clientY; } else { currentX = event.clientX; currentY = event.clientY; } let newLeft = currentX - offsetX; let newTop = currentY - offsetY; const containerWidth = dragTarget.offsetWidth; const containerHeight = dragTarget.offsetHeight; const viewportWidth = window.innerWidth; const viewportHeight = window.innerHeight; if (newLeft < 0) newLeft = 0; if (newTop < 0) newTop = 0; if (newLeft + containerWidth > viewportWidth) newLeft = viewportWidth - containerWidth; if (newTop + containerHeight > viewportHeight) newTop = viewportHeight - containerHeight; dragTarget.style.left = `${newLeft}px`; dragTarget.style.top = `${newTop}px`; dragTarget.style.right = 'auto'; dragTarget.style.bottom = 'auto'; } function dragEndHandler() { if (isDragging) { isDragging = false; if(dragTarget) dragTarget.style.transition = ''; dragTarget = null; document.removeEventListener('mousemove', draggingHandler); document.removeEventListener('touchmove', draggingHandler); document.removeEventListener('mouseup', dragEndHandler); document.removeEventListener('touchend', dragEndHandler); } } element.addEventListener('mousedown', dragStartHandler); element.addEventListener('touchstart', dragStartHandler, { passive: false }); }
        if (audioPlayerContainer) makeDraggable(audioPlayerContainer);
        if (catPendant) makeDraggable(catPendant);

        // --- Cat Pendant Logic ---
        if (catPendant && catDialog) {
             catPendant.addEventListener('click', () => {
                 try {
                     const now = Date.now();
                     recentCatClicks.push(now);
                     recentCatClicks = recentCatClicks.filter(timestamp => now - timestamp < CAT_CLICK_WINDOW);
                     let dialogText = "";
                     let isRateLimited = recentCatClicks.length >= CAT_CLICK_LIMIT;
                     let canShowDialog = false;

                     if (isRateLimited) {
                         dialogText = rateLimitDialog;
                         canShowDialog = true;
                     } else {
                          if (!firstCatClick && (catPendant.classList.contains('rolling') || catDialog.classList.contains('visible'))) {
                              return;
                          }
                          if (firstCatClick) {
                              dialogText = initialDialog[0];
                              firstCatClick = false;
                          } else {
                              const randomIndex = Math.floor(Math.random() * randomDialogs.length);
                              dialogText = randomDialogs[randomIndex];
                          }
                          canShowDialog = true;
                     }

                     tryPlayAudio(); // ç‚¹å‡»çŒ«å’ªå°è¯•æ’­æ”¾

                     if (canShowDialog && catDialog) {
                         catDialog.textContent = dialogText;
                         clearTimeout(catDialogTimeout);
                         catDialog.classList.remove('visible');
                         void catDialog.offsetWidth;
                         catDialog.classList.add('visible');
                         catDialogTimeout = setTimeout(() => {
                            if(catDialog) catDialog.classList.remove('visible');
                         }, 4000);

                         if (!isRateLimited && catPendant && !catPendant.classList.contains('rolling')) {
                            catPendant.classList.add('rolling');
                            catPendant.addEventListener('animationend', () => {
                                if(catPendant) catPendant.classList.remove('rolling');
                            }, { once: true });
                         } else if (isRateLimited && catPendant) {
                              catPendant.classList.remove('rolling');
                         }
                     } else if (!catDialog) {
                         console.error("Cat dialog element not found!");
                     }

                 } catch (error) {
                      console.error("Error in cat pendant click handler:", error);
                      if (catPendant) catPendant.classList.remove('rolling');
                      if (catDialog) catDialog.classList.remove('visible');
                      clearTimeout(catDialogTimeout);
                 }
             });
             const catImg = catPendant.querySelector('img');
             if(catImg) { catImg.onerror = () => { if (catPendant) catPendant.style.display = 'none'; }; }
             else { if (catPendant) catPendant.style.display = 'none'; }
        } else { if (catPendant) catPendant.style.display = 'none'; }


        // --- MODIFIED: å­—ä½“åˆ‡æ¢é€»è¾‘ ---
        if (fontToggleButton && loveLetterView) {
            fontToggleButton.addEventListener('click', () => {
                loveLetterView.classList.toggle('love-letter-default-font');
                // å¯é€‰ï¼šæ ¹æ®çŠ¶æ€æ›´æ–°æŒ‰é’®æ–‡å­—
                /*
                if (loveLetterView.classList.contains('love-letter-default-font')) {
                    fontToggleButton.textContent = 'åˆ‡æ¢ä¸ºè‡ªå®šä¹‰å­—ä½“';
                } else {
                    fontToggleButton.textContent = 'åˆ‡æ¢ä¸ºé»˜è®¤å­—ä½“';
                }
                */
            });
        }


        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                if (birthdayView) birthdayView.style.position = 'relative';
                if (loveLetterView) loveLetterView.style.position = 'relative';
                if (birthdayView) { birthdayIntervalId = startFallingItems(birthdayIntervalId, birthdayItems, birthdayView, BIRTHDAY_INTERVAL_TIME); }
                if (audioElement) { updatePlayPauseIcon(); }
                else { if (audioPlayerContainer) audioPlayerContainer.style.display = 'none'; }
                if (slideshow && slideCount > 0) { createDots(); showSlide(0); startSlideshowAutoplay(); }
                else { if (slideshowContainer) slideshowContainer.style.display = 'none'; }

            } catch (error) { console.error("Error during initial setup:", error); }
        });

    </script>

</body>
</html>